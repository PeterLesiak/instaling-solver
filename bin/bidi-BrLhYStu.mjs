import{$ as e,A as t,At as n,B as r,Bt as i,C as a,Ct as o,D as s,Dt as c,E as l,Et as u,F as d,Ft as f,G as p,H as m,I as h,It as g,J as _,K as v,L as y,Lt as b,M as x,Mt as S,N as C,Nt as w,O as T,Ot as E,P as ee,Pt as D,Q as te,R as ne,Rt as re,S as ie,St as O,T as ae,Tt as oe,U as se,V as ce,W as le,X as ue,Y as de,Z as k,_ as fe,_t as pe,a as me,at as he,b as A,bt as j,c as ge,ct as _e,d as ve,dt as ye,et as M,f as be,ft as xe,g as Se,gt as Ce,h as we,ht as Te,it as Ee,j as De,jt as N,k as Oe,kt as ke,l as Ae,lt as je,m as Me,mt as P,nt as Ne,o as Pe,ot as Fe,p as Ie,pt as Le,q as Re,rt as ze,s as Be,st as Ve,tt as He,u as Ue,ut as We,v as Ge,vt as F,w as Ke,wt as qe,x as Je,xt as I,y as Ye,yt as Xe,z as Ze,zt as Qe}from"./index.mjs";var $e=b({default:()=>et});function et(e){return{all:e||=new Map,on:function(t,n){var r=e.get(t);r?r.push(n):e.set(t,[n])},off:function(t,n){var r=e.get(t);r&&(n?r.splice(r.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var r=e.get(t);r&&r.slice().map(function(e){e(n)}),(r=e.get(`*`))&&r.slice().map(function(e){e(t,n)})}}}var tt=g((()=>{})),nt=f((e=>{var t=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,`__esModule`,{value:!0}),e.EventEmitter=void 0;let n=t((tt(),Qe($e)));e.EventEmitter=class{#e=(0,n.default)();on(e,t){return this.#e.on(e,t),this}once(e,t){let n=r=>{t(r),this.off(e,n)};return this.on(e,n)}off(e,t){return this.#e.off(e,t),this}emit(e,t){this.#e.emit(e,t)}removeAllListeners(e){return e?this.#e.all.delete(e):this.#e.all.clear(),this}}})),L=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.LogType=void 0;var t;(function(e){e.bidi=`bidi`,e.cdp=`cdp`,e.debug=`debug`,e.debugError=`debug:error`,e.debugInfo=`debug:info`,e.debugWarn=`debug:warn`})(t||(e.LogType=t={}))})),rt=f((e=>{var t;Object.defineProperty(e,`__esModule`,{value:!0}),e.ProcessingQueue=void 0;let n=L();var r=class{static LOGGER_PREFIX=`${n.LogType.debug}:queue`;#e;#t;#n=[];#r=!1;constructor(e,t){this.#t=e,this.#e=t}add(e,t){this.#n.push([e,t]),this.#i()}async#i(){if(!this.#r){for(this.#r=!0;this.#n.length>0;){let e=this.#n.shift();if(!e)continue;let[r,i]=e;this.#e?.(t.LOGGER_PREFIX,`Processing event:`,i),await r.then(e=>{if(e.kind===`error`){this.#e?.(n.LogType.debugError,`Event threw before sending:`,e.error.message,e.error.stack);return}return this.#t(e.value)}).catch(e=>{this.#e?.(n.LogType.debugError,`Event was not processed:`,e?.message)})}this.#r=!1}}};e.ProcessingQueue=r,t=r})),it=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),at=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.EVENT_NAMES=e.Speculation=e.Bluetooth=e.Network=e.Input=e.BrowsingContext=e.Log=e.Script=e.BiDiModule=void 0;var t;(function(e){e.Bluetooth=`bluetooth`,e.Browser=`browser`,e.BrowsingContext=`browsingContext`,e.Cdp=`goog:cdp`,e.Input=`input`,e.Log=`log`,e.Network=`network`,e.Script=`script`,e.Session=`session`,e.Speculation=`speculation`})(t||(e.BiDiModule=t={}));var n;(function(e){(function(e){e.Message=`script.message`,e.RealmCreated=`script.realmCreated`,e.RealmDestroyed=`script.realmDestroyed`})(e.EventNames||={})})(n||(e.Script=n={}));var r;(function(e){(function(e){e.LogEntryAdded=`log.entryAdded`})(e.EventNames||={})})(r||(e.Log=r={}));var i;(function(e){(function(e){e.ContextCreated=`browsingContext.contextCreated`,e.ContextDestroyed=`browsingContext.contextDestroyed`,e.DomContentLoaded=`browsingContext.domContentLoaded`,e.DownloadEnd=`browsingContext.downloadEnd`,e.DownloadWillBegin=`browsingContext.downloadWillBegin`,e.FragmentNavigated=`browsingContext.fragmentNavigated`,e.HistoryUpdated=`browsingContext.historyUpdated`,e.Load=`browsingContext.load`,e.NavigationAborted=`browsingContext.navigationAborted`,e.NavigationCommitted=`browsingContext.navigationCommitted`,e.NavigationFailed=`browsingContext.navigationFailed`,e.NavigationStarted=`browsingContext.navigationStarted`,e.UserPromptClosed=`browsingContext.userPromptClosed`,e.UserPromptOpened=`browsingContext.userPromptOpened`})(e.EventNames||={})})(i||(e.BrowsingContext=i={}));var a;(function(e){(function(e){e.FileDialogOpened=`input.fileDialogOpened`})(e.EventNames||={})})(a||(e.Input=a={}));var o;(function(e){(function(e){e.AuthRequired=`network.authRequired`,e.BeforeRequestSent=`network.beforeRequestSent`,e.FetchError=`network.fetchError`,e.ResponseCompleted=`network.responseCompleted`,e.ResponseStarted=`network.responseStarted`})(e.EventNames||={})})(o||(e.Network=o={}));var s;(function(e){(function(e){e.RequestDevicePromptUpdated=`bluetooth.requestDevicePromptUpdated`,e.GattConnectionAttempted=`bluetooth.gattConnectionAttempted`,e.CharacteristicEventGenerated=`bluetooth.characteristicEventGenerated`,e.DescriptorEventGenerated=`bluetooth.descriptorEventGenerated`})(e.EventNames||={})})(s||(e.Bluetooth=s={}));var c;(function(e){(function(e){e.PrefetchStatusUpdated=`speculation.prefetchStatusUpdated`})(e.EventNames||={})})(c||(e.Speculation=c={})),e.EVENT_NAMES=new Set([...Object.values(t),...Object.values(s.EventNames),...Object.values(i.EventNames),...Object.values(a.EventNames),...Object.values(r.EventNames),...Object.values(o.EventNames),...Object.values(n.EventNames),...Object.values(c.EventNames)])})),ot=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),R=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.UnavailableNetworkDataException=e.NoSuchNetworkDataException=e.NoSuchNetworkCollectorException=e.NoSuchWebExtensionException=e.InvalidWebExtensionException=e.UnderspecifiedStoragePartitionException=e.UnableToSetFileInputException=e.UnableToSetCookieException=e.NoSuchStoragePartitionException=e.UnsupportedOperationException=e.UnableToCloseBrowserException=e.UnableToCaptureScreenException=e.UnknownErrorException=e.UnknownCommandException=e.SessionNotCreatedException=e.NoSuchUserContextException=e.NoSuchScriptException=e.NoSuchRequestException=e.NoSuchNodeException=e.NoSuchInterceptException=e.NoSuchHistoryEntryException=e.NoSuchHandleException=e.NoSuchFrameException=e.NoSuchElementException=e.NoSuchAlertException=e.MoveTargetOutOfBoundsException=e.InvalidSessionIdException=e.InvalidSelectorException=e.InvalidArgumentException=e.Exception=void 0;var t=class extends Error{error;message;stacktrace;constructor(e,t,n){super(),this.error=e,this.message=t,this.stacktrace=n}toErrorResponse(e){return{type:`error`,id:e,error:this.error,message:this.message,stacktrace:this.stacktrace}}};e.Exception=t,e.InvalidArgumentException=class extends t{constructor(e,t){super(`invalid argument`,e,t)}},e.InvalidSelectorException=class extends t{constructor(e,t){super(`invalid selector`,e,t)}},e.InvalidSessionIdException=class extends t{constructor(e,t){super(`invalid session id`,e,t)}},e.MoveTargetOutOfBoundsException=class extends t{constructor(e,t){super(`move target out of bounds`,e,t)}},e.NoSuchAlertException=class extends t{constructor(e,t){super(`no such alert`,e,t)}},e.NoSuchElementException=class extends t{constructor(e,t){super(`no such element`,e,t)}},e.NoSuchFrameException=class extends t{constructor(e,t){super(`no such frame`,e,t)}},e.NoSuchHandleException=class extends t{constructor(e,t){super(`no such handle`,e,t)}},e.NoSuchHistoryEntryException=class extends t{constructor(e,t){super(`no such history entry`,e,t)}},e.NoSuchInterceptException=class extends t{constructor(e,t){super(`no such intercept`,e,t)}},e.NoSuchNodeException=class extends t{constructor(e,t){super(`no such node`,e,t)}},e.NoSuchRequestException=class extends t{constructor(e,t){super(`no such request`,e,t)}},e.NoSuchScriptException=class extends t{constructor(e,t){super(`no such script`,e,t)}},e.NoSuchUserContextException=class extends t{constructor(e,t){super(`no such user context`,e,t)}},e.SessionNotCreatedException=class extends t{constructor(e,t){super(`session not created`,e,t)}},e.UnknownCommandException=class extends t{constructor(e,t){super(`unknown command`,e,t)}},e.UnknownErrorException=class extends t{constructor(e,t=Error().stack){super(`unknown error`,e,t)}},e.UnableToCaptureScreenException=class extends t{constructor(e,t){super(`unable to capture screen`,e,t)}},e.UnableToCloseBrowserException=class extends t{constructor(e,t){super(`unable to close browser`,e,t)}},e.UnsupportedOperationException=class extends t{constructor(e,t){super(`unsupported operation`,e,t)}},e.NoSuchStoragePartitionException=class extends t{constructor(e,t){super(`no such storage partition`,e,t)}},e.UnableToSetCookieException=class extends t{constructor(e,t){super(`unable to set cookie`,e,t)}},e.UnableToSetFileInputException=class extends t{constructor(e,t){super(`unable to set file input`,e,t)}},e.UnderspecifiedStoragePartitionException=class extends t{constructor(e,t){super(`underspecified storage partition`,e,t)}},e.InvalidWebExtensionException=class extends t{constructor(e,t){super(`invalid web extension`,e,t)}},e.NoSuchWebExtensionException=class extends t{constructor(e,t){super(`no such web extension`,e,t)}},e.NoSuchNetworkCollectorException=class extends t{constructor(e,t){super(`no such network collector`,e,t)}},e.NoSuchNetworkDataException=class extends t{constructor(e,t){super(`no such network data`,e,t)}},e.UnavailableNetworkDataException=class extends t{constructor(e,t){super(`unavailable network data`,e,t)}}})),st=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),ct=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),lt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0})})),z=f((e=>{var t=e&&e.__createBinding||(Object.create?(function(e,t,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||(`get`in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}):(function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]})),n=e&&e.__setModuleDefault||(Object.create?(function(e,t){Object.defineProperty(e,`default`,{enumerable:!0,value:t})}):function(e,t){e.default=t}),r=e&&e.__importStar||(function(){var e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},e(t)};return function(r){if(r&&r.__esModule)return r;var i={};if(r!=null)for(var a=e(r),o=0;o<a.length;o++)a[o]!==`default`&&t(i,r,a[o]);return n(i,r),i}})(),i=e&&e.__exportStar||function(e,n){for(var r in e)r!==`default`&&!Object.prototype.hasOwnProperty.call(n,r)&&t(n,e,r)};Object.defineProperty(e,`__esModule`,{value:!0}),e.ChromiumBidi=e.Cdp=void 0,e.Cdp=r(it()),e.ChromiumBidi=r(at()),i(ot(),e),i(R(),e),i(st(),e),i(ct(),e),i(lt(),e)})),ut=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.BidiNoOpParser=void 0,e.BidiNoOpParser=class{parseDisableSimulationParameters(e){return e}parseHandleRequestDevicePromptParams(e){return e}parseSimulateAdapterParameters(e){return e}parseSimulateAdvertisementParameters(e){return e}parseSimulateCharacteristicParameters(e){return e}parseSimulateCharacteristicResponseParameters(e){return e}parseSimulateDescriptorParameters(e){return e}parseSimulateDescriptorResponseParameters(e){return e}parseSimulateGattConnectionResponseParameters(e){return e}parseSimulateGattDisconnectionParameters(e){return e}parseSimulatePreconnectedPeripheralParameters(e){return e}parseSimulateServiceParameters(e){return e}parseCreateUserContextParameters(e){return e}parseRemoveUserContextParameters(e){return e}parseSetClientWindowStateParameters(e){return e}parseSetDownloadBehaviorParameters(e){return e}parseActivateParams(e){return e}parseCaptureScreenshotParams(e){return e}parseCloseParams(e){return e}parseCreateParams(e){return e}parseGetTreeParams(e){return e}parseHandleUserPromptParams(e){return e}parseLocateNodesParams(e){return e}parseNavigateParams(e){return e}parsePrintParams(e){return e}parseReloadParams(e){return e}parseSetViewportParams(e){return e}parseTraverseHistoryParams(e){return e}parseGetSessionParams(e){return e}parseResolveRealmParams(e){return e}parseSendCommandParams(e){return e}parseSetForcedColorsModeThemeOverrideParams(e){return e}parseSetGeolocationOverrideParams(e){return e}parseSetLocaleOverrideParams(e){return e}parseSetNetworkConditionsParams(e){return e}parseSetScreenOrientationOverrideParams(e){return e}parseSetScriptingEnabledParams(e){return e}parseSetTimezoneOverrideParams(e){return e}parseSetUserAgentOverrideParams(e){return e}parseAddPreloadScriptParams(e){return e}parseCallFunctionParams(e){return e}parseDisownParams(e){return e}parseEvaluateParams(e){return e}parseGetRealmsParams(e){return e}parseRemovePreloadScriptParams(e){return e}parsePerformActionsParams(e){return e}parseReleaseActionsParams(e){return e}parseSetFilesParams(e){return e}parseAddDataCollectorParams(e){return e}parseAddInterceptParams(e){return e}parseContinueRequestParams(e){return e}parseContinueResponseParams(e){return e}parseContinueWithAuthParams(e){return e}parseDisownDataParams(e){return e}parseFailRequestParams(e){return e}parseGetDataParams(e){return e}parseProvideResponseParams(e){return e}parseRemoveDataCollectorParams(e){return e}parseRemoveInterceptParams(e){return e}parseSetCacheBehaviorParams(e){return e}parseSetExtraHeadersParams(e){return e}parseSetPermissionsParams(e){return e}parseSubscribeParams(e){return e}parseUnsubscribeParams(e){return e}parseDeleteCookiesParams(e){return e}parseGetCookiesParams(e){return e}parseSetCookieParams(e){return e}parseInstallParams(e){return e}parseUninstallParams(e){return e}}})),dt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.BrowserProcessor=void 0,e.getProxyStr=n;let t=z();e.BrowserProcessor=class{#e;#t;#n;#r;constructor(e,t,n,r){this.#e=e,this.#t=t,this.#n=n,this.#r=r}close(){return setTimeout(()=>this.#e.sendCommand(`Browser.close`),0),{}}async createUserContext(e){let r=e,i=this.#n.getGlobalConfig();if(r.acceptInsecureCerts!==void 0&&r.acceptInsecureCerts===!1&&i.acceptInsecureCerts===!0)throw new t.UnknownErrorException(`Cannot set user context's "acceptInsecureCerts" to false, when a capability "acceptInsecureCerts" is set to true`);let a={};if(r.proxy){let e=n(r.proxy);e&&(a.proxyServer=e),r.proxy.noProxy&&(a.proxyBypassList=r.proxy.noProxy.join(`,`))}else{e[`goog:proxyServer`]!==void 0&&(a.proxyServer=e[`goog:proxyServer`]);let t=e[`goog:proxyBypassList`]??void 0;t&&(a.proxyBypassList=t.join(`,`))}let o=await this.#e.sendCommand(`Target.createBrowserContext`,a);return await this.#o(i.downloadBehavior??null,o.browserContextId),this.#n.updateUserContextConfig(o.browserContextId,{acceptInsecureCerts:e.acceptInsecureCerts,userPromptHandler:e.unhandledPromptBehavior}),{userContext:o.browserContextId}}async removeUserContext(e){let n=e.userContext;if(n===`default`)throw new t.InvalidArgumentException("`default` user context cannot be removed");try{await this.#e.sendCommand(`Target.disposeBrowserContext`,{browserContextId:n})}catch(e){throw e.message.startsWith(`Failed to find context with id`)?new t.NoSuchUserContextException(e.message):e}return{}}async getUserContexts(){return{userContexts:await this.#r.getUserContexts()}}async#i(e){let t=await this.#e.sendCommand(`Browser.getWindowForTarget`,{targetId:e});return{active:!1,clientWindow:`${t.windowId}`,state:t.bounds.windowState??`normal`,height:t.bounds.height??0,width:t.bounds.width??0,x:t.bounds.left??0,y:t.bounds.top??0}}async getClientWindows(){let e=this.#t.getTopLevelContexts().map(e=>e.cdpTarget.id),t=await Promise.all(e.map(async e=>await this.#i(e))),n=new Set,r=[];for(let e of t)n.has(e.clientWindow)||(n.add(e.clientWindow),r.push(e));return{clientWindows:r}}#a(e){if(e===null)return{behavior:`default`};if(e?.type===`denied`)return{behavior:`deny`};if(e?.type===`allowed`)return{behavior:`allow`,downloadPath:e.destinationFolder};throw new t.UnknownErrorException(`Unexpected download behavior`)}async#o(e,t){await this.#e.sendCommand(`Browser.setDownloadBehavior`,{...this.#a(e),browserContextId:t===`default`?void 0:t,eventsEnabled:!0})}async setDownloadBehavior(e){let t;return t=e.userContexts===void 0?(await this.#r.getUserContexts()).map(e=>e.userContext):Array.from(await this.#r.verifyUserContextIdList(e.userContexts)),e.userContexts===void 0?this.#n.updateGlobalConfig({downloadBehavior:e.downloadBehavior}):e.userContexts.map(t=>this.#n.updateUserContextConfig(t,{downloadBehavior:e.downloadBehavior})),await Promise.all(t.map(async e=>{let t=this.#n.getActiveConfig(void 0,e).downloadBehavior??null;await this.#o(t,e)})),{}}};function n(e){if(!(e.proxyType===`direct`||e.proxyType===`system`)){if(e.proxyType===`pac`)throw new t.UnsupportedOperationException(`PAC proxy configuration is not supported per user context`);if(e.proxyType===`autodetect`)throw new t.UnsupportedOperationException(`Autodetect proxy is not supported per user context`);if(e.proxyType===`manual`){let n=[];if(e.httpProxy!==void 0&&n.push(`http=${e.httpProxy}`),e.sslProxy!==void 0&&n.push(`https=${e.sslProxy}`),e.socksProxy!==void 0||e.socksVersion!==void 0){if(e.socksProxy===void 0)throw new t.InvalidArgumentException(`'socksVersion' cannot be set without 'socksProxy'`);if(e.socksVersion===void 0||typeof e.socksVersion!=`number`||!Number.isInteger(e.socksVersion)||e.socksVersion<0||e.socksVersion>255)throw new t.InvalidArgumentException(`'socksVersion' must be between 0 and 255`);n.push(`socks=socks${e.socksVersion}://${e.socksProxy}`)}return n.length===0?void 0:n.join(`;`)}throw new t.UnknownErrorException(`Unknown proxy type`)}}})),ft=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.CdpProcessor=void 0;let t=z();e.CdpProcessor=class{#e;#t;#n;#r;constructor(e,t,n,r){this.#e=e,this.#t=t,this.#n=n,this.#r=r}getSession(e){let t=e.context,n=this.#e.getContext(t).cdpTarget.cdpSessionId;return n===void 0?{}:{session:n}}resolveRealm(e){let n=e.realm,r=this.#t.getRealm({realmId:n});if(r===void 0)throw new t.UnknownErrorException(`Could not find realm ${e.realm}`);return{executionContextId:r.executionContextId}}async sendCommand(e){return{result:await(e.session?this.#n.getCdpClient(e.session):this.#r).sendCommand(e.method,e.params),session:e.session}}}})),pt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.BrowsingContextProcessor=void 0;let t=z();e.BrowsingContextProcessor=class{#e;#t;#n;#r;#i;constructor(e,n,r,i,a){this.#n=i,this.#i=r,this.#e=e,this.#t=n,this.#r=a,this.#r.addSubscribeHook(t.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,this.#o.bind(this))}getTree(e){return{contexts:(e.root===void 0?this.#t.getTopLevelContexts():[this.#t.getContext(e.root)]).map(t=>t.serializeToBidiValue(e.maxDepth??Number.MAX_VALUE))}}async create(e){let n,r=`default`;if(e.referenceContext!==void 0){if(n=this.#t.getContext(e.referenceContext),!n.isTopLevelContext())throw new t.InvalidArgumentException(`referenceContext should be a top-level context`);r=n.userContext}e.userContext!==void 0&&(r=e.userContext);let i=this.#t.getAllContexts().filter(e=>e.userContext===r),a=!1;switch(e.type){case`tab`:a=!1;break;case`window`:a=!0;break}i.length||(a=!0);let o;try{o=await this.#e.sendCommand(`Target.createTarget`,{url:`about:blank`,newWindow:a,browserContextId:r===`default`?void 0:r,background:e.background===!0})}catch(e){throw e.message.startsWith(`Failed to find browser context with id`)||e.message===`browserContextId`?new t.NoSuchUserContextException(`The context ${r} was not found`):e}let s=await this.#t.waitForContext(o.targetId);return await s.lifecycleLoaded(),{context:s.id}}navigate(e){return this.#t.getContext(e.context).navigate(e.url,e.wait??`none`)}reload(e){return this.#t.getContext(e.context).reload(e.ignoreCache??!1,e.wait??`none`)}async activate(e){let n=this.#t.getContext(e.context);if(!n.isTopLevelContext())throw new t.InvalidArgumentException(`Activation is only supported on the top-level context`);return await n.activate(),{}}async captureScreenshot(e){return await this.#t.getContext(e.context).captureScreenshot(e)}async print(e){return await this.#t.getContext(e.context).print(e)}async setViewport(e){let t={};e.devicePixelRatio!==void 0&&(t.devicePixelRatio=e.devicePixelRatio),e.viewport!==void 0&&(t.viewport=e.viewport);let n=await this.#a(e.context,e.userContexts);for(let n of e.userContexts??[])this.#n.updateUserContextConfig(n,t);return e.context!==void 0&&this.#n.updateBrowsingContextConfig(e.context,t),await Promise.all(n.map(t=>t.setViewport(e.viewport,e.devicePixelRatio))),{}}async#a(e,n){if(e===void 0&&n===void 0)throw new t.InvalidArgumentException(`Either userContexts or context must be provided`);if(e!==void 0&&n!==void 0)throw new t.InvalidArgumentException(`userContexts and context are mutually exclusive`);if(e!==void 0){let n=this.#t.getContext(e);if(!n.isTopLevelContext())throw new t.InvalidArgumentException(`Emulating viewport is only supported on the top-level context`);return[n]}await this.#i.verifyUserContextIdList(n);let r=[];for(let e of n){let t=this.#t.getTopLevelContexts().filter(t=>t.userContext===e);r.push(...t)}return[...new Set(r).values()]}async traverseHistory(e){let n=this.#t.getContext(e.context);if(!n)throw new t.InvalidArgumentException(`No browsing context with id ${e.context}`);if(!n.isTopLevelContext())throw new t.InvalidArgumentException(`Traversing history is only supported on the top-level context`);return await n.traverseHistory(e.delta),{}}async handleUserPrompt(e){let n=this.#t.getContext(e.context);try{await n.handleUserPrompt(e.accept,e.userText)}catch(e){throw e.message?.includes(`No dialog is showing`)?new t.NoSuchAlertException(`No dialog is showing`):e}return{}}async close(e){let n=this.#t.getContext(e.context);if(!n.isTopLevelContext())throw new t.InvalidArgumentException(`Non top-level browsing context ${n.id} cannot be closed.`);let r=n.cdpTarget.parentCdpClient;try{let t=new Promise(t=>{let n=i=>{i.targetId===e.context&&(r.off(`Target.detachedFromTarget`,n),t())};r.on(`Target.detachedFromTarget`,n)});try{e.promptUnload?await n.close():await r.sendCommand(`Target.closeTarget`,{targetId:e.context})}catch(e){if(!r.isCloseError(e))throw e}await t}catch(e){if(!(e.code===-32e3&&e.message===`Not attached to an active page`))throw e}return{}}async locateNodes(e){return await this.#t.getContext(e.context).locateNodes(e)}#o(e){return[this.#t.getContext(e),...this.#t.getContext(e).allChildren].forEach(e=>{this.#r.registerEvent({type:`event`,method:t.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,params:e.serializeToBidiValue()},e.id)}),Promise.resolve()}}})),mt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.EmulationProcessor=void 0,e.isValidLocale=n,e.isValidTimezone=r,e.isTimeZoneOffsetString=i;let t=R();e.EmulationProcessor=class{#e;#t;#n;constructor(e,t,n){this.#e=t,this.#t=e,this.#n=n}async setGeolocationOverride(e){if(`coordinates`in e&&`error`in e)throw new t.InvalidArgumentException(`Coordinates and error cannot be set at the same time`);let n=null;if(`coordinates`in e){if((e.coordinates?.altitude??null)===null&&(e.coordinates?.altitudeAccuracy??null)!==null)throw new t.InvalidArgumentException(`Geolocation altitudeAccuracy can be set only with altitude`);n=e.coordinates}else if(`error`in e){if(e.error.type!==`positionUnavailable`)throw new t.InvalidArgumentException(`Unknown geolocation error ${e.error.type}`);n=e.error}else throw new t.InvalidArgumentException(`Coordinates or error should be set`);let r=await this.#r(e.contexts,e.userContexts);for(let t of e.contexts??[])this.#n.updateBrowsingContextConfig(t,{geolocation:n});for(let t of e.userContexts??[])this.#n.updateUserContextConfig(t,{geolocation:n});return await Promise.all(r.map(async e=>await e.setGeolocationOverride(n))),{}}async setLocaleOverride(e){let r=e.locale??null;if(r!==null&&!n(r))throw new t.InvalidArgumentException(`Invalid locale "${r}"`);let i=await this.#r(e.contexts,e.userContexts);for(let t of e.contexts??[])this.#n.updateBrowsingContextConfig(t,{locale:r});for(let t of e.userContexts??[])this.#n.updateUserContextConfig(t,{locale:r});return await Promise.all(i.map(async e=>await e.setLocaleOverride(r))),{}}async setScriptingEnabled(e){let t=e.enabled,n=await this.#r(e.contexts,e.userContexts);for(let n of e.contexts??[])this.#n.updateBrowsingContextConfig(n,{scriptingEnabled:t});for(let n of e.userContexts??[])this.#n.updateUserContextConfig(n,{scriptingEnabled:t});return await Promise.all(n.map(async e=>await e.setScriptingEnabled(t))),{}}async setScreenOrientationOverride(e){let t=await this.#r(e.contexts,e.userContexts);for(let t of e.contexts??[])this.#n.updateBrowsingContextConfig(t,{screenOrientation:e.screenOrientation});for(let t of e.userContexts??[])this.#n.updateUserContextConfig(t,{screenOrientation:e.screenOrientation});return await Promise.all(t.map(async t=>await t.setScreenOrientationOverride(e.screenOrientation))),{}}async#r(e,n,r=!1){if(e===void 0&&n===void 0){if(r)return this.#t.getTopLevelContexts();throw new t.InvalidArgumentException(`Either user contexts or browsing contexts must be provided`)}if(e!==void 0&&n!==void 0)throw new t.InvalidArgumentException(`User contexts and browsing contexts are mutually exclusive`);let i=[];if(e===void 0){if(n.length===0)throw new t.InvalidArgumentException(`user context should be provided`);await this.#e.verifyUserContextIdList(n);for(let e of n){let t=this.#t.getTopLevelContexts().filter(t=>t.userContext===e);i.push(...t)}}else{if(e.length===0)throw new t.InvalidArgumentException(`browsing context should be provided`);for(let n of e){let e=this.#t.getContext(n);if(!e.isTopLevelContext())throw new t.InvalidArgumentException(`The command is only supported on the top-level context`);i.push(e)}}return[...new Set(i).values()]}async setTimezoneOverride(e){let n=e.timezone??null;if(n!==null&&!r(n))throw new t.InvalidArgumentException(`Invalid timezone "${n}"`);n!==null&&i(n)&&(n=`GMT${n}`);let a=await this.#r(e.contexts,e.userContexts);for(let t of e.contexts??[])this.#n.updateBrowsingContextConfig(t,{timezone:n});for(let t of e.userContexts??[])this.#n.updateUserContextConfig(t,{timezone:n});return await Promise.all(a.map(async e=>await e.setTimezoneOverride(n))),{}}async setUserAgentOverrideParams(e){if(e.userAgent===``)throw new t.UnsupportedOperationException(`empty user agent string is not supported`);let n=await this.#r(e.contexts,e.userContexts,!0);for(let t of e.contexts??[])this.#n.updateBrowsingContextConfig(t,{userAgent:e.userAgent});for(let t of e.userContexts??[])this.#n.updateUserContextConfig(t,{userAgent:e.userAgent});return e.contexts===void 0&&e.userContexts===void 0&&this.#n.updateGlobalConfig({userAgent:e.userAgent}),await Promise.all(n.map(async t=>await t.setUserAgentOverride(e.userAgent))),{}}async setNetworkConditions(e){let n=await this.#r(e.contexts,e.userContexts,!0);for(let t of e.contexts??[])this.#n.updateBrowsingContextConfig(t,{emulatedNetworkConditions:e.networkConditions});for(let t of e.userContexts??[])this.#n.updateUserContextConfig(t,{emulatedNetworkConditions:e.networkConditions});if(e.contexts===void 0&&e.userContexts===void 0&&this.#n.updateGlobalConfig({emulatedNetworkConditions:e.networkConditions}),e.networkConditions!==null&&e.networkConditions.type!==`offline`)throw new t.UnsupportedOperationException(`Unsupported network conditions ${e.networkConditions.type}`);return await Promise.all(n.map(async e=>{let t=this.#n.getActiveConfig(e.id,e.userContext).emulatedNetworkConditions??null;await e.setEmulatedNetworkConditions(t)})),{}}};function n(e){try{return new Intl.Locale(e),!0}catch(e){if(e instanceof RangeError)return!1;throw e}}function r(e){try{return Intl.DateTimeFormat(void 0,{timeZone:e}),!0}catch(e){if(e instanceof RangeError)return!1;throw e}}function i(e){return/^[+-](?:2[0-3]|[01]\d)(?::[0-5]\d)?$/.test(e)}})),B=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.assert=t;function t(e,t){if(!e)throw Error(t??`Internal assertion failed.`)}})),ht=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.isSingleComplexGrapheme=t,e.isSingleGrapheme=n;function t(e){return n(e)&&e.length>1}function n(e){return[...new Intl.Segmenter(`en`,{granularity:`grapheme`}).segment(e)].length===1}})),gt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.WheelSource=e.PointerSource=e.KeySource=e.NoneSource=void 0,e.NoneSource=class{type=`none`},e.KeySource=class{type=`key`;pressed=new Set;#e=0;get modifiers(){return this.#e}get alt(){return(this.#e&1)==1}set alt(e){this.#t(e,1)}get ctrl(){return(this.#e&2)==2}set ctrl(e){this.#t(e,2)}get meta(){return(this.#e&4)==4}set meta(e){this.#t(e,4)}get shift(){return(this.#e&8)==8}set shift(e){this.#t(e,8)}#t(e,t){e?this.#e|=t:this.#e&=~t}},e.PointerSource=class{type=`pointer`;subtype;pointerId;pressed=new Set;x=0;y=0;radiusX;radiusY;force;constructor(e,t){this.pointerId=e,this.subtype=t}get buttons(){let e=0;for(let t of this.pressed)switch(t){case 0:e|=1;break;case 1:e|=4;break;case 2:e|=2;break;case 3:e|=8;break;case 4:e|=16;break}return e}static ClickContext=class e{static#t=500;static#n=2;count=0;#r;#i;#a;constructor(e,t,n){this.#r=e,this.#i=t,this.#a=n}compare(t){return t.#a-this.#a>e.#t||Math.abs(t.#r-this.#r)>e.#n||Math.abs(t.#i-this.#i)>e.#n}};#e=new Map;setClickCount(e,t){let n=this.#e.get(e);return(!n||n.compare(t))&&(n=t),++n.count,this.#e.set(e,n),n.count}getClickCount(e){return this.#e.get(e)?.count??0}resetClickCount(){this.#e=new Map}},e.WheelSource=class{type=`wheel`}})),_t=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.getNormalizedKey=t,e.getKeyCode=n,e.getKeyLocation=r;function t(e){switch(e){case`ÓÄÄ`:return`Unidentified`;case`ÓÄÅ`:return`Cancel`;case`ÓÄÇ`:return`Help`;case`ÓÄÉ`:return`Backspace`;case`ÓÄÑ`:return`Tab`;case`ÓÄÖ`:return`Clear`;case`ÓÄÜ`:case`ÓÄá`:return`Enter`;case`ÓÄà`:return`Shift`;case`ÓÄâ`:return`Control`;case`ÓÄä`:return`Alt`;case`ÓÄã`:return`Pause`;case`ÓÄå`:return`Escape`;case`ÓÄç`:return` `;case`ÓÄé`:return`PageUp`;case`ÓÄè`:return`PageDown`;case`ÓÄê`:return`End`;case`ÓÄë`:return`Home`;case`ÓÄí`:return`ArrowLeft`;case`ÓÄì`:return`ArrowUp`;case`ÓÄî`:return`ArrowRight`;case`ÓÄï`:return`ArrowDown`;case`ÓÄñ`:return`Insert`;case`ÓÄó`:return`Delete`;case`ÓÄò`:return`;`;case`ÓÄô`:return`=`;case`ÓÄö`:return`0`;case`ÓÄõ`:return`1`;case`ÓÄú`:return`2`;case`ÓÄù`:return`3`;case`ÓÄû`:return`4`;case`ÓÄü`:return`5`;case`ÓÄ†`:return`6`;case`ÓÄ°`:return`7`;case`ÓÄ¢`:return`8`;case`ÓÄ£`:return`9`;case`ÓÄ§`:return`*`;case`ÓÄ•`:return`+`;case`ÓÄ¶`:return`,`;case`ÓÄß`:return`-`;case`ÓÄ®`:return`.`;case`ÓÄ©`:return`/`;case`ÓÄ±`:return`F1`;case`ÓÄ≤`:return`F2`;case`ÓÄ≥`:return`F3`;case`ÓÄ¥`:return`F4`;case`ÓÄµ`:return`F5`;case`ÓÄ∂`:return`F6`;case`ÓÄ∑`:return`F7`;case`ÓÄ∏`:return`F8`;case`ÓÄπ`:return`F9`;case`ÓÄ∫`:return`F10`;case`ÓÄª`:return`F11`;case`ÓÄº`:return`F12`;case`ÓÄΩ`:return`Meta`;case`ÓÅÄ`:return`ZenkakuHankaku`;case`ÓÅê`:return`Shift`;case`ÓÅë`:return`Control`;case`ÓÅí`:return`Alt`;case`ÓÅì`:return`Meta`;case`ÓÅî`:return`PageUp`;case`ÓÅï`:return`PageDown`;case`ÓÅñ`:return`End`;case`ÓÅó`:return`Home`;case`ÓÅò`:return`ArrowLeft`;case`ÓÅô`:return`ArrowUp`;case`ÓÅö`:return`ArrowRight`;case`ÓÅõ`:return`ArrowDown`;case`ÓÅú`:return`Insert`;case`ÓÅù`:return`Delete`;default:return e}}function n(e){switch(e){case"`":case`~`:return`Backquote`;case`\\`:case`|`:return`Backslash`;case`ÓÄÉ`:return`Backspace`;case`[`:case`{`:return`BracketLeft`;case`]`:case`}`:return`BracketRight`;case`,`:case`<`:return`Comma`;case`0`:case`)`:return`Digit0`;case`1`:case`!`:return`Digit1`;case`2`:case`@`:return`Digit2`;case`3`:case`#`:return`Digit3`;case`4`:case`$`:return`Digit4`;case`5`:case`%`:return`Digit5`;case`6`:case`^`:return`Digit6`;case`7`:case`&`:return`Digit7`;case`8`:case`*`:return`Digit8`;case`9`:case`(`:return`Digit9`;case`=`:case`+`:return`Equal`;case`>`:return`IntlBackslash`;case`a`:case`A`:return`KeyA`;case`b`:case`B`:return`KeyB`;case`c`:case`C`:return`KeyC`;case`d`:case`D`:return`KeyD`;case`e`:case`E`:return`KeyE`;case`f`:case`F`:return`KeyF`;case`g`:case`G`:return`KeyG`;case`h`:case`H`:return`KeyH`;case`i`:case`I`:return`KeyI`;case`j`:case`J`:return`KeyJ`;case`k`:case`K`:return`KeyK`;case`l`:case`L`:return`KeyL`;case`m`:case`M`:return`KeyM`;case`n`:case`N`:return`KeyN`;case`o`:case`O`:return`KeyO`;case`p`:case`P`:return`KeyP`;case`q`:case`Q`:return`KeyQ`;case`r`:case`R`:return`KeyR`;case`s`:case`S`:return`KeyS`;case`t`:case`T`:return`KeyT`;case`u`:case`U`:return`KeyU`;case`v`:case`V`:return`KeyV`;case`w`:case`W`:return`KeyW`;case`x`:case`X`:return`KeyX`;case`y`:case`Y`:return`KeyY`;case`z`:case`Z`:return`KeyZ`;case`-`:case`_`:return`Minus`;case`.`:return`Period`;case`'`:case`"`:return`Quote`;case`;`:case`:`:return`Semicolon`;case`/`:case`?`:return`Slash`;case`ÓÄä`:return`AltLeft`;case`ÓÅí`:return`AltRight`;case`ÓÄâ`:return`ControlLeft`;case`ÓÅë`:return`ControlRight`;case`ÓÄÜ`:return`Enter`;case`ÓÄã`:return`Pause`;case`ÓÄΩ`:return`MetaLeft`;case`ÓÅì`:return`MetaRight`;case`ÓÄà`:return`ShiftLeft`;case`ÓÅê`:return`ShiftRight`;case` `:case`ÓÄç`:return`Space`;case`ÓÄÑ`:return`Tab`;case`ÓÄó`:return`Delete`;case`ÓÄê`:return`End`;case`ÓÄÇ`:return`Help`;case`ÓÄë`:return`Home`;case`ÓÄñ`:return`Insert`;case`ÓÄè`:return`PageDown`;case`ÓÄé`:return`PageUp`;case`ÓÄï`:return`ArrowDown`;case`ÓÄí`:return`ArrowLeft`;case`ÓÄî`:return`ArrowRight`;case`ÓÄì`:return`ArrowUp`;case`ÓÄå`:return`Escape`;case`ÓÄ±`:return`F1`;case`ÓÄ≤`:return`F2`;case`ÓÄ≥`:return`F3`;case`ÓÄ¥`:return`F4`;case`ÓÄµ`:return`F5`;case`ÓÄ∂`:return`F6`;case`ÓÄ∑`:return`F7`;case`ÓÄ∏`:return`F8`;case`ÓÄπ`:return`F9`;case`ÓÄ∫`:return`F10`;case`ÓÄª`:return`F11`;case`ÓÄº`:return`F12`;case`ÓÄô`:return`NumpadEqual`;case`ÓÄö`:case`ÓÅú`:return`Numpad0`;case`ÓÄõ`:case`ÓÅñ`:return`Numpad1`;case`ÓÄú`:case`ÓÅõ`:return`Numpad2`;case`ÓÄù`:case`ÓÅï`:return`Numpad3`;case`ÓÄû`:case`ÓÅò`:return`Numpad4`;case`ÓÄü`:return`Numpad5`;case`ÓÄ†`:case`ÓÅö`:return`Numpad6`;case`ÓÄ°`:case`ÓÅó`:return`Numpad7`;case`ÓÄ¢`:case`ÓÅô`:return`Numpad8`;case`ÓÄ£`:case`ÓÅî`:return`Numpad9`;case`ÓÄ•`:return`NumpadAdd`;case`ÓÄ¶`:return`NumpadComma`;case`ÓÄ®`:case`ÓÅù`:return`NumpadDecimal`;case`ÓÄ©`:return`NumpadDivide`;case`ÓÄá`:return`NumpadEnter`;case`ÓÄ§`:return`NumpadMultiply`;case`ÓÄß`:return`NumpadSubtract`;default:return}}function r(e){switch(e){case`ÓÄá`:case`ÓÄà`:case`ÓÄâ`:case`ÓÄä`:case`ÓÄΩ`:return 1;case`ÓÄô`:case`ÓÄö`:case`ÓÄõ`:case`ÓÄú`:case`ÓÄù`:case`ÓÄû`:case`ÓÄü`:case`ÓÄ†`:case`ÓÄ°`:case`ÓÄ¢`:case`ÓÄ£`:case`ÓÄ§`:case`ÓÄ•`:case`ÓÄ¶`:case`ÓÄß`:case`ÓÄ®`:case`ÓÄ©`:case`ÓÅî`:case`ÓÅï`:case`ÓÅñ`:case`ÓÅó`:case`ÓÅò`:case`ÓÅô`:case`ÓÅö`:case`ÓÅõ`:case`ÓÅú`:case`ÓÅù`:return 3;case`ÓÅê`:case`ÓÅë`:case`ÓÅí`:case`ÓÅì`:return 2;default:return 0}}})),vt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.KeyToKeyCode=void 0,e.KeyToKeyCode={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,Abort:3,Help:6,Backspace:8,Tab:9,Numpad5:12,NumpadEnter:13,Enter:13,"\\r":13,"\\n":13,ShiftLeft:16,ShiftRight:16,ControlLeft:17,ControlRight:17,AltLeft:18,AltRight:18,Pause:19,CapsLock:20,Escape:27,Convert:28,NonConvert:29,Space:32,Numpad9:33,PageUp:33,Numpad3:34,PageDown:34,End:35,Numpad1:35,Home:36,Numpad7:36,ArrowLeft:37,Numpad4:37,Numpad8:38,ArrowUp:38,ArrowRight:39,Numpad6:39,Numpad2:40,ArrowDown:40,Select:41,Open:43,PrintScreen:44,Insert:45,Numpad0:45,Delete:46,NumpadDecimal:46,Digit0:48,Digit1:49,Digit2:50,Digit3:51,Digit4:52,Digit5:53,Digit6:54,Digit7:55,Digit8:56,Digit9:57,KeyA:65,KeyB:66,KeyC:67,KeyD:68,KeyE:69,KeyF:70,KeyG:71,KeyH:72,KeyI:73,KeyJ:74,KeyK:75,KeyL:76,KeyM:77,KeyN:78,KeyO:79,KeyP:80,KeyQ:81,KeyR:82,KeyS:83,KeyT:84,KeyU:85,KeyV:86,KeyW:87,KeyX:88,KeyY:89,KeyZ:90,MetaLeft:91,MetaRight:92,ContextMenu:93,NumpadMultiply:106,NumpadAdd:107,NumpadSubtract:109,NumpadDivide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,NumLock:144,ScrollLock:145,AudioVolumeMute:173,AudioVolumeDown:174,AudioVolumeUp:175,MediaTrackNext:176,MediaTrackPrevious:177,MediaStop:178,MediaPlayPause:179,Semicolon:186,Equal:187,NumpadEqual:187,Comma:188,Minus:189,Period:190,Slash:191,Backquote:192,BracketLeft:219,Backslash:220,BracketRight:221,Quote:222,AltGraph:225,Props:247,Cancel:3,Clear:12,Shift:16,Control:17,Alt:18,Accept:30,ModeChange:31," ":32,Print:42,Execute:43,"\\u0000":46,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,Meta:91,"*":106,"+":107,"-":109,"/":111,";":186,"=":187,",":188,".":190,"`":192,"[":219,"\\\\":220,"]":221,"'":222,Attn:246,CrSel:247,ExSel:248,EraseEof:249,Play:250,ZoomOut:251,")":48,"!":49,"@":50,"#":51,$:52,"%":53,"^":54,"&":55,"(":57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,":":186,"<":188,_:189,">":190,"?":191,"~":192,"{":219,"|":220,"}":221,'"':222,Camera:44,EndCall:95,VolumeDown:182,VolumeUp:183}})),yt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ActionDispatcher=void 0;let t=z(),n=B(),r=ht(),i=gt(),a=_t(),o=vt(),s=(e=>{let t=e.getClientRects()[0],n=Math.max(0,Math.min(t.x,t.x+t.width)),r=Math.min(window.innerWidth,Math.max(t.x,t.x+t.width)),i=Math.max(0,Math.min(t.y,t.y+t.height)),a=Math.min(window.innerHeight,Math.max(t.y,t.y+t.height));return[n+(r-n>>1),i+(a-i>>1)]}).toString(),c=(()=>navigator.platform.toLowerCase().includes(`mac`)).toString();async function l(e,r){let i=await(await e.getOrCreateHiddenSandbox()).callFunction(s,!1,{type:`undefined`},[r]);if(i.type===`exception`)throw new t.NoSuchElementException(`Origin element ${r.sharedId} was not found`);(0,n.assert)(i.result.type===`array`),(0,n.assert)(i.result.value?.[0]?.type===`number`),(0,n.assert)(i.result.value?.[1]?.type===`number`);let{result:{value:[{value:a},{value:o}]}}=i;return{x:a,y:o}}e.ActionDispatcher=class{static isMacOS=async e=>{let t=await(await e.getOrCreateHiddenSandbox()).callFunction(c,!1);return(0,n.assert)(t.type!==`exception`),(0,n.assert)(t.result.type===`boolean`),t.result.value};#e;#t=0;#n=0;#r;#i;#a;constructor(e,t,n,r){this.#e=t,this.#r=e,this.#i=n,this.#a=r}get#o(){return this.#e.getContext(this.#i)}async dispatchActions(e){await this.#r.queue.run(async()=>{for(let t of e)await this.dispatchTickActions(t)})}async dispatchTickActions(e){this.#t=performance.now(),this.#n=0;for(let{action:t}of e)`duration`in t&&t.duration!==void 0&&(this.#n=Math.max(this.#n,t.duration));let t=[new Promise(e=>setTimeout(e,this.#n))];for(let n of e)t.push(this.#s(n));await Promise.all(t)}async#s({id:e,action:t}){let n=this.#r.get(e),r=this.#r.getGlobalKeyState();switch(t.type){case`keyDown`:await this.#m(n,t),this.#r.cancelList.push({id:e,action:{...t,type:`keyUp`}});break;case`keyUp`:await this.#h(n,t);break;case`pause`:break;case`pointerDown`:await this.#c(n,r,t),this.#r.cancelList.push({id:e,action:{...t,type:`pointerUp`}});break;case`pointerMove`:await this.#u(n,r,t);break;case`pointerUp`:await this.#l(n,r,t);break;case`scroll`:await this.#p(n,r,t);break}}async#c(e,t,n){let{button:r}=n;if(e.pressed.has(r))return;e.pressed.add(r);let{x:a,y:o,subtype:s}=e,{width:c,height:l,pressure:u,twist:d,tangentialPressure:h}=n,{tiltX:g,tiltY:_}=p(n),{modifiers:v}=t,{radiusX:y,radiusY:b}=m(c??1,l??1);switch(s){case`mouse`:case`pen`:await this.#o.cdpTarget.cdpClient.sendCommand(`Input.dispatchMouseEvent`,{type:`mousePressed`,x:a,y:o,modifiers:v,button:f(r),buttons:e.buttons,clickCount:e.setClickCount(r,new i.PointerSource.ClickContext(a,o,performance.now())),pointerType:s,tangentialPressure:h,tiltX:g,tiltY:_,twist:d,force:u});break;case`touch`:await this.#o.cdpTarget.cdpClient.sendCommand(`Input.dispatchTouchEvent`,{type:`touchStart`,touchPoints:[{x:a,y:o,radiusX:y,radiusY:b,tangentialPressure:h,tiltX:g,tiltY:_,twist:d,force:u,id:e.pointerId}],modifiers:v});break}e.radiusX=y,e.radiusY=b,e.force=u}#l(e,t,n){let{button:r}=n;if(!e.pressed.has(r))return;e.pressed.delete(r);let{x:i,y:a,force:o,radiusX:s,radiusY:c,subtype:l}=e,{modifiers:u}=t;switch(l){case`mouse`:case`pen`:return this.#o.cdpTarget.cdpClient.sendCommand(`Input.dispatchMouseEvent`,{type:`mouseReleased`,x:i,y:a,modifiers:u,button:f(r),buttons:e.buttons,clickCount:e.getClickCount(r),pointerType:l});case`touch`:return this.#o.cdpTarget.cdpClient.sendCommand(`Input.dispatchTouchEvent`,{type:`touchEnd`,touchPoints:[{x:i,y:a,id:e.pointerId,force:o,radiusX:s,radiusY:c}],modifiers:u})}}async#u(e,n,r){let{x:i,y:a,subtype:o}=e,{width:s,height:c,pressure:l,twist:u,tangentialPressure:d,x:h,y:g,origin:_=`viewport`,duration:v=this.#n}=r,{tiltX:y,tiltY:b}=p(r),{radiusX:x,radiusY:S}=m(s??1,c??1),{targetX:C,targetY:w}=await this.#f(_,h,g,i,a);if(C<0||w<0)throw new t.MoveTargetOutOfBoundsException(`Cannot move beyond viewport (x: ${C}, y: ${w})`);let T;do{let t=v>0?(performance.now()-this.#t)/v:1;T=t>=1;let r,s;if(T?(r=C,s=w):(r=Math.round(t*(C-i)+i),s=Math.round(t*(w-a)+a)),e.x!==r||e.y!==s){let{modifiers:t}=n;switch(o){case`mouse`:await this.#o.cdpTarget.cdpClient.sendCommand(`Input.dispatchMouseEvent`,{type:`mouseMoved`,x:r,y:s,modifiers:t,clickCount:0,button:f(e.pressed.values().next().value??5),buttons:e.buttons,pointerType:o,tangentialPressure:d,tiltX:y,tiltY:b,twist:u,force:l});break;case`pen`:e.pressed.size!==0&&await this.#o.cdpTarget.cdpClient.sendCommand(`Input.dispatchMouseEvent`,{type:`mouseMoved`,x:r,y:s,modifiers:t,clickCount:0,button:f(e.pressed.values().next().value??5),buttons:e.buttons,pointerType:o,tangentialPressure:d,tiltX:y,tiltY:b,twist:u,force:l??.5});break;case`touch`:e.pressed.size!==0&&await this.#o.cdpTarget.cdpClient.sendCommand(`Input.dispatchTouchEvent`,{type:`touchMove`,touchPoints:[{x:r,y:s,radiusX:x,radiusY:S,tangentialPressure:d,tiltX:y,tiltY:b,twist:u,force:l,id:e.pointerId}],modifiers:t});break}e.x=r,e.y=s,e.radiusX=x,e.radiusY=S,e.force=l}}while(!T)}async#d(){if(this.#o.id===this.#o.cdpTarget.id)return{x:0,y:0};let{backendNodeId:e}=await this.#o.cdpTarget.cdpClient.sendCommand(`DOM.getFrameOwner`,{frameId:this.#o.id}),{model:t}=await this.#o.cdpTarget.cdpClient.sendCommand(`DOM.getBoxModel`,{backendNodeId:e});return{x:t.content[0],y:t.content[1]}}async#f(e,t,n,r,i){let a,o,s=await this.#d();switch(e){case`viewport`:a=t+s.x,o=n+s.y;break;case`pointer`:a=r+t+s.x,o=i+n+s.y;break;default:{let{x:r,y:i}=await l(this.#o,e.element);a=r+t+s.x,o=i+n+s.y;break}}return{targetX:a,targetY:o}}async#p(e,n,r){let{deltaX:i,deltaY:a,x:o,y:s,origin:c=`viewport`,duration:l=this.#n}=r;if(c===`pointer`)throw new t.InvalidArgumentException(`"pointer" origin is invalid for scrolling.`);let{targetX:u,targetY:d}=await this.#f(c,o,s,0,0);if(u<0||d<0)throw new t.MoveTargetOutOfBoundsException(`Cannot move beyond viewport (x: ${u}, y: ${d})`);let f=0,p=0,m;do{let e=l>0?(performance.now()-this.#t)/l:1;m=e>=1;let t,r;if(m?(t=i-f,r=a-p):(t=Math.round(e*i-f),r=Math.round(e*a-p)),t!==0||r!==0){let{modifiers:e}=n;await this.#o.cdpTarget.cdpClient.sendCommand(`Input.dispatchMouseEvent`,{type:`mouseWheel`,deltaX:t,deltaY:r,x:u,y:d,modifiers:e}),f+=t,p+=r}}while(!m)}async#m(e,n){let i=n.value;if(!(0,r.isSingleGrapheme)(i))throw new t.InvalidArgumentException(`Invalid key value: ${i}`);let s=(0,r.isSingleComplexGrapheme)(i),c=(0,a.getNormalizedKey)(i),l=e.pressed.has(c),f=(0,a.getKeyCode)(i),p=(0,a.getKeyLocation)(i);switch(c){case`Alt`:e.alt=!0;break;case`Shift`:e.shift=!0;break;case`Control`:e.ctrl=!0;break;case`Meta`:e.meta=!0;break}e.pressed.add(c);let{modifiers:m}=e,h=u(c,e,s),g=d(f??``,e)??h,_;if(this.#a&&e.meta)switch(f){case`KeyA`:_=`SelectAll`;break;case`KeyC`:_=`Copy`;break;case`KeyV`:_=e.shift?`PasteAndMatchStyle`:`Paste`;break;case`KeyX`:_=`Cut`;break;case`KeyZ`:_=e.shift?`Redo`:`Undo`;break;default:}let v=[this.#o.cdpTarget.cdpClient.sendCommand(`Input.dispatchKeyEvent`,{type:g?`keyDown`:`rawKeyDown`,windowsVirtualKeyCode:o.KeyToKeyCode[c],key:c,code:f,text:g,unmodifiedText:h,autoRepeat:l,isSystemKey:e.alt||void 0,location:p<3?p:void 0,isKeypad:p===3,modifiers:m,commands:_?[_]:void 0})];c===`Escape`&&!e.alt&&(this.#a&&!e.ctrl&&!e.meta||!this.#a)&&v.push(this.#o.cdpTarget.cdpClient.sendCommand(`Input.cancelDragging`)),await Promise.all(v)}#h(e,n){let i=n.value;if(!(0,r.isSingleGrapheme)(i))throw new t.InvalidArgumentException(`Invalid key value: ${i}`);let s=(0,r.isSingleComplexGrapheme)(i),c=(0,a.getNormalizedKey)(i);if(!e.pressed.has(c))return;let l=(0,a.getKeyCode)(i),f=(0,a.getKeyLocation)(i);switch(c){case`Alt`:e.alt=!1;break;case`Shift`:e.shift=!1;break;case`Control`:e.ctrl=!1;break;case`Meta`:e.meta=!1;break}e.pressed.delete(c);let{modifiers:p}=e,m=u(c,e,s),h=d(l??``,e)??m;return this.#o.cdpTarget.cdpClient.sendCommand(`Input.dispatchKeyEvent`,{type:`keyUp`,windowsVirtualKeyCode:o.KeyToKeyCode[c],key:c,code:l,text:h,unmodifiedText:m,location:f<3?f:void 0,isSystemKey:e.alt||void 0,isKeypad:f===3,modifiers:p})}};let u=(e,t,n)=>n?e:e===`Enter`?`\r`:[...e].length===1?t.shift?e.toLocaleUpperCase(`en-US`):e:void 0,d=(e,t)=>{if(t.ctrl){switch(e){case`Digit2`:if(t.shift)return`\0`;break;case`KeyA`:return``;case`KeyB`:return``;case`KeyC`:return``;case`KeyD`:return``;case`KeyE`:return``;case`KeyF`:return``;case`KeyG`:return`\x07`;case`KeyH`:return`\b`;case`KeyI`:return`	`;case`KeyJ`:return`
`;case`KeyK`:return`\v`;case`KeyL`:return`\f`;case`KeyM`:return`\r`;case`KeyN`:return``;case`KeyO`:return``;case`KeyP`:return``;case`KeyQ`:return``;case`KeyR`:return``;case`KeyS`:return``;case`KeyT`:return``;case`KeyU`:return``;case`KeyV`:return``;case`KeyW`:return``;case`KeyX`:return``;case`KeyY`:return``;case`KeyZ`:return``;case`BracketLeft`:return`\x1B`;case`Backslash`:return``;case`BracketRight`:return``;case`Digit6`:if(t.shift)return``;break;case`Minus`:return``}return``}if(t.alt)return``};function f(e){switch(e){case 0:return`left`;case 1:return`middle`;case 2:return`right`;case 3:return`back`;case 4:return`forward`;default:return`none`}}function p(e){let t=e.altitudeAngle??Math.PI/2,n=e.azimuthAngle??0,r=0,i=0;if(t===0&&((n===0||n===2*Math.PI)&&(r=Math.PI/2),n===Math.PI/2&&(i=Math.PI/2),n===Math.PI&&(r=-Math.PI/2),n===3*Math.PI/2&&(i=-Math.PI/2),n>0&&n<Math.PI/2&&(r=Math.PI/2,i=Math.PI/2),n>Math.PI/2&&n<Math.PI&&(r=-Math.PI/2,i=Math.PI/2),n>Math.PI&&n<3*Math.PI/2&&(r=-Math.PI/2,i=-Math.PI/2),n>3*Math.PI/2&&n<2*Math.PI&&(r=Math.PI/2,i=-Math.PI/2)),t!==0){let e=Math.tan(t);r=Math.atan(Math.cos(n)/e),i=Math.atan(Math.sin(n)/e)}let a=180/Math.PI;return{tiltX:Math.round(r*a),tiltY:Math.round(i*a)}}function m(e,t){return{radiusX:e?e/2:.5,radiusY:t?t/2:.5}}})),bt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.Mutex=void 0,e.Mutex=class{#e=!1;#t=[];acquire(){let e={resolved:!1};return this.#e?new Promise(t=>{this.#t.push(()=>t(this.#n.bind(this,e)))}):(this.#e=!0,Promise.resolve(this.#n.bind(this,e)))}#n(e){if(e.resolved)throw Error(`Cannot release more than once.`);e.resolved=!0;let t=this.#t.shift();if(!t){this.#e=!1;return}t()}async run(e){let t=await this.acquire();try{return await e()}finally{t()}}}})),xt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.InputState=void 0;let t=z(),n=bt(),r=gt();e.InputState=class{cancelList=[];#e=new Map;#t=new n.Mutex;getOrCreate(e,n,i){let a=this.#e.get(e);if(!a){switch(n){case`none`:a=new r.NoneSource;break;case`key`:a=new r.KeySource;break;case`pointer`:{let e=i===`mouse`?0:2,t=new Set;for(let[,e]of this.#e)e.type===`pointer`&&t.add(e.pointerId);for(;t.has(e);)++e;a=new r.PointerSource(e,i);break}case`wheel`:a=new r.WheelSource;break;default:throw new t.InvalidArgumentException(`Expected "none", "key", "pointer", or "wheel". Found unknown source type ${n}.`)}return this.#e.set(e,a),a}if(a.type!==n)throw new t.InvalidArgumentException(`Input source type of ${e} is ${a.type}, but received ${n}.`);return a}get(e){let n=this.#e.get(e);if(!n)throw new t.UnknownErrorException(`Internal error.`);return n}getGlobalKeyState(){let e=new r.KeySource;for(let[,t]of this.#e)if(t.type===`key`){for(let n of t.pressed)e.pressed.add(n);e.alt||=t.alt,e.ctrl||=t.ctrl,e.meta||=t.meta,e.shift||=t.shift}return e}get queue(){return this.#t}}})),St=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.InputStateManager=void 0;let t=B(),n=xt();e.InputStateManager=class extends WeakMap{get(e){return(0,t.assert)(e.isTopLevelContext()),this.has(e)||this.set(e,new n.InputState),super.get(e)}}})),Ct=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.InputProcessor=void 0;let t=z(),n=B(),r=yt(),i=St();e.InputProcessor=class{#e;#t=new i.InputStateManager;constructor(e){this.#e=e}async performActions(e){let t=this.#e.getContext(e.context),n=this.#t.get(t.top),i=this.#n(e,n);return await new r.ActionDispatcher(n,this.#e,e.context,await r.ActionDispatcher.isMacOS(t).catch(()=>!1)).dispatchActions(i),{}}async releaseActions(e){let t=this.#e.getContext(e.context),n=t.top,i=this.#t.get(n);return await new r.ActionDispatcher(i,this.#e,e.context,await r.ActionDispatcher.isMacOS(t).catch(()=>!1)).dispatchTickActions(i.cancelList.reverse()),this.#t.delete(n),{}}async setFiles(e){let r=await this.#e.getContext(e.context).getOrCreateHiddenSandbox(),i;try{i=await r.callFunction(String(function(e){if(!(this instanceof HTMLInputElement))return this instanceof Element?1:0;if(this.type!==`file`)return 2;if(this.disabled)return 3;if(e>1&&!this.multiple)return 4}),!1,e.element,[{type:`number`,value:e.files.length}])}catch{throw new t.NoSuchNodeException(`Could not find element ${e.element.sharedId}`)}if((0,n.assert)(i.type===`success`),i.result.type===`number`)switch(i.result.value){case 0:throw new t.NoSuchElementException(`Could not find element ${e.element.sharedId}`);case 1:throw new t.UnableToSetFileInputException(`Element ${e.element.sharedId} is not a input`);case 2:throw new t.UnableToSetFileInputException(`Input element ${e.element.sharedId} is not a file type`);case 3:throw new t.UnableToSetFileInputException(`Input element ${e.element.sharedId} is disabled`);case 4:throw new t.UnableToSetFileInputException(`Cannot set multiple files on a non-multiple input element`)}if(e.files.length===0)return await r.callFunction(String(function(){if(this.files?.length===0){this.dispatchEvent(new Event(`cancel`,{bubbles:!0}));return}this.files=new DataTransfer().files,this.dispatchEvent(new Event(`input`,{bubbles:!0,composed:!0})),this.dispatchEvent(new Event(`change`,{bubbles:!0}))}),!1,e.element),{};let a=[];for(let t=0;t<e.files.length;++t){let t=await r.callFunction(String(function(e){return this.files?.item(e)}),!1,e.element,[{type:`number`,value:0}],`root`);if((0,n.assert)(t.type===`success`),t.result.type!==`object`)break;let{handle:i}=t.result;(0,n.assert)(i!==void 0);let{path:o}=await r.cdpClient.sendCommand(`DOM.getFileInfo`,{objectId:i});a.push(o),r.disown(i).catch(void 0)}a.sort();let o=[...e.files].sort();if(a.length!==e.files.length||o.some((e,t)=>a[t]!==e)){let{objectId:t}=await r.deserializeForCdp(e.element);(0,n.assert)(t!==void 0),await r.cdpClient.sendCommand(`DOM.setFileInputFiles`,{files:e.files,objectId:t})}else await r.callFunction(String(function(){this.dispatchEvent(new Event(`cancel`,{bubbles:!0}))}),!1,e.element);return{}}#n(e,n){let r=[];for(let i of e.actions){switch(i.type){case`pointer`:{i.parameters??={pointerType:`mouse`},i.parameters.pointerType??=`mouse`;let e=n.getOrCreate(i.id,`pointer`,i.parameters.pointerType);if(e.subtype!==i.parameters.pointerType)throw new t.InvalidArgumentException(`Expected input source ${i.id} to be ${e.subtype}; got ${i.parameters.pointerType}.`);e.resetClickCount();break}default:n.getOrCreate(i.id,i.type)}let e=i.actions.map(e=>({id:i.id,action:e}));for(let t=0;t<e.length;t++)r.length===t&&r.push([]),r[t].push(e[t])}return r}}})),wt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.base64ToString=t;function t(e){return`atob`in globalThis?globalThis.atob(e):Buffer.from(e,`base64`).toString(`ascii`)}})),Tt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.computeHeadersSize=r,e.stringToBase64=i,e.bidiNetworkHeadersFromCdpNetworkHeaders=o,e.bidiNetworkHeadersFromCdpNetworkHeadersEntries=s,e.cdpNetworkHeadersFromBidiNetworkHeaders=c,e.bidiNetworkHeadersFromCdpFetchHeaders=l,e.cdpFetchHeadersFromBidiNetworkHeaders=u,e.networkHeaderFromCookieHeaders=d,e.cdpAuthChallengeResponseFromBidiAuthContinueWithAuthAction=f,e.cdpToBiDiCookie=p,e.deserializeByteValue=m,e.bidiToCdpCookie=h,e.sameSiteBiDiToCdp=_,e.isSpecialScheme=v,e.matchUrlPattern=b,e.bidiBodySizeFromCdpPostDataEntries=x,e.getTiming=S;let t=R(),n=wt();function r(e){let t=e.reduce((e,t)=>`${e}${t.name}: ${t.value.value}\r\n`,``);return new TextEncoder().encode(t).length}function i(e){return a(new TextEncoder().encode(e))}function a(e){let t=65534,n=[];for(let r=0;r<e.length;r+=t){let i=e.subarray(r,r+t);n.push(String.fromCodePoint.apply(null,i))}let r=n.join(``);return btoa(r)}function o(e){return e?Object.entries(e).map(([e,t])=>({name:e,value:{type:`string`,value:t}})):[]}function s(e){return e?e.map(({name:e,value:t})=>({name:e,value:{type:`string`,value:t}})):[]}function c(e){if(e!==void 0)return e.reduce((e,t)=>(e[t.name]=t.value.value,e),{})}function l(e){return e?e.map(({name:e,value:t})=>({name:e,value:{type:`string`,value:t}})):[]}function u(e){if(e!==void 0)return e.map(({name:e,value:t})=>({name:e,value:t.value}))}function d(e){if(e!==void 0)return{name:`Cookie`,value:{type:`string`,value:e.reduce((e,t,n)=>{n>0&&(e+=`;`);let r=t.value.type===`base64`?btoa(t.value.value):t.value.value;return e+=`${t.name}=${r}`,e},``)}}}function f(e){switch(e){case`default`:return`Default`;case`cancel`:return`CancelAuth`;case`provideCredentials`:return`ProvideCredentials`}}function p(e){let t={name:e.name,value:{type:`string`,value:e.value},domain:e.domain,path:e.path,size:e.size,httpOnly:e.httpOnly,secure:e.secure,sameSite:e.sameSite===void 0?`none`:g(e.sameSite),...e.expires>=0?{expiry:e.expires}:void 0};return t[`goog:session`]=e.session,t[`goog:priority`]=e.priority,t[`goog:sameParty`]=e.sameParty,t[`goog:sourceScheme`]=e.sourceScheme,t[`goog:sourcePort`]=e.sourcePort,e.partitionKey!==void 0&&(t[`goog:partitionKey`]=e.partitionKey),e.partitionKeyOpaque!==void 0&&(t[`goog:partitionKeyOpaque`]=e.partitionKeyOpaque),t}function m(e){return e.type===`base64`?(0,n.base64ToString)(e.value):e.value}function h(e,t){let n=m(e.cookie.value),r={name:e.cookie.name,value:n,domain:e.cookie.domain,path:e.cookie.path??`/`,secure:e.cookie.secure??!1,httpOnly:e.cookie.httpOnly??!1,...t.sourceOrigin!==void 0&&{partitionKey:{hasCrossSiteAncestor:!1,topLevelSite:t.sourceOrigin}},...e.cookie.expiry!==void 0&&{expires:e.cookie.expiry},...e.cookie.sameSite!==void 0&&{sameSite:_(e.cookie.sameSite)}};return e.cookie[`goog:url`]!==void 0&&(r.url=e.cookie[`goog:url`]),e.cookie[`goog:priority`]!==void 0&&(r.priority=e.cookie[`goog:priority`]),e.cookie[`goog:sameParty`]!==void 0&&(r.sameParty=e.cookie[`goog:sameParty`]),e.cookie[`goog:sourceScheme`]!==void 0&&(r.sourceScheme=e.cookie[`goog:sourceScheme`]),e.cookie[`goog:sourcePort`]!==void 0&&(r.sourcePort=e.cookie[`goog:sourcePort`]),r}function g(e){switch(e){case`Strict`:return`strict`;case`None`:return`none`;case`Lax`:return`lax`;default:return`lax`}}function _(e){switch(e){case`none`:return`None`;case`strict`:return`Strict`;case`default`:case`lax`:return`Lax`}throw new t.InvalidArgumentException(`Unknown 'sameSite' value ${e}`)}function v(e){return[`ftp`,`file`,`http`,`https`,`ws`,`wss`].includes(e.replace(/:$/,``))}function y(e){return e.protocol.replace(/:$/,``)}function b(e,t){let n=new URL(t);return!(e.protocol!==void 0&&e.protocol!==y(n)||e.hostname!==void 0&&e.hostname!==n.hostname||e.port!==void 0&&e.port!==n.port||e.pathname!==void 0&&e.pathname!==n.pathname||e.search!==void 0&&e.search!==n.search)}function x(e){let t=0;for(let n of e)t+=atob(n.bytes??``).length;return t}function S(e,t=0){return!e||e<=0||e+t<=0?0:e+t}})),Et=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.NetworkProcessor=void 0,e.parseBiDiHeaders=s;let t=z(),n=Tt();e.NetworkProcessor=class e{#e;#t;#n;#r;constructor(e,t,n,r){this.#n=n,this.#e=e,this.#t=t,this.#r=r}async addIntercept(t){this.#e.verifyTopLevelContextsList(t.contexts);let n=t.urlPatterns??[],r=e.parseUrlPatterns(n),i=this.#t.addIntercept({urlPatterns:r,phases:t.phases,contexts:t.contexts});return await this.#i(),{intercept:i}}async continueRequest(n){if(n.url!==void 0&&e.parseUrlString(n.url),n.method!==void 0&&!e.isMethodValid(n.method))throw new t.InvalidArgumentException(`Method '${n.method}' is invalid.`);n.headers&&e.validateHeaders(n.headers);let r=this.#o(n.request,[`beforeRequestSent`]);try{await r.continueRequest(n)}catch(t){throw e.wrapInterceptionError(t)}return{}}async continueResponse(t){t.headers&&e.validateHeaders(t.headers);let n=this.#o(t.request,[`authRequired`,`responseStarted`]);try{await n.continueResponse(t)}catch(t){throw e.wrapInterceptionError(t)}return{}}async continueWithAuth(e){let t=e.request;return await this.#o(t,[`authRequired`]).continueWithAuth(e),{}}async failRequest({request:e}){let n=this.#a(e);if(n.interceptPhase===`authRequired`)throw new t.InvalidArgumentException(`Request '${e}' in 'authRequired' phase cannot be failed`);if(!n.interceptPhase)throw new t.NoSuchRequestException(`No blocked request found for network id '${e}'`);return await n.failRequest(`Failed`),{}}async provideResponse(t){t.headers&&e.validateHeaders(t.headers);let n=this.#o(t.request,[`beforeRequestSent`,`responseStarted`,`authRequired`]);try{await n.provideResponse(t)}catch(t){throw e.wrapInterceptionError(t)}return{}}async#i(){await Promise.all(this.#e.getAllContexts().map(e=>e.cdpTarget.toggleNetwork()))}async removeIntercept(e){return this.#t.removeIntercept(e.intercept),await this.#i(),{}}async setCacheBehavior(e){let t=this.#e.verifyTopLevelContextsList(e.contexts);if(t.size===0)return this.#t.defaultCacheBehavior=e.cacheBehavior,await Promise.all(this.#e.getAllContexts().map(e=>e.cdpTarget.toggleSetCacheDisabled())),{};let n=e.cacheBehavior===`bypass`;return await Promise.all([...t.values()].map(e=>e.cdpTarget.toggleSetCacheDisabled(n))),{}}#a(e){let n=this.#t.getRequestById(e);if(!n)throw new t.NoSuchRequestException(`Network request with ID '${e}' doesn't exist`);return n}#o(e,n){let r=this.#a(e);if(!r.interceptPhase)throw new t.NoSuchRequestException(`No blocked request found for network id '${e}'`);if(r.interceptPhase&&!n.includes(r.interceptPhase))throw new t.InvalidArgumentException(`Blocked request for network id '${e}' is in '${r.interceptPhase}' phase`);return r}static validateHeaders(e){for(let n of e){let e;if(e=n.value.type===`string`?n.value.value:atob(n.value.value),e!==e.trim()||e.includes(`
`)||e.includes(`\0`))throw new t.InvalidArgumentException(`Header value '${e}' is not acceptable value`)}}static isMethodValid(e){return/^[!#$%&'*+\-.^_`|~a-zA-Z\d]+$/.test(e)}static parseUrlString(e){try{return new URL(e)}catch(n){throw new t.InvalidArgumentException(`Invalid URL '${e}': ${n}`)}}static parseUrlPatterns(e){return e.map(e=>{let i=``,a=!0,o=!0,s=!0,c=!0,l=!0;switch(e.type){case`string`:i=r(e.pattern);break;case`pattern`:{if(e.protocol===void 0)a=!1,i+=`http`;else{if(e.protocol===``)throw new t.InvalidArgumentException(`URL pattern must specify a protocol`);if(e.protocol=r(e.protocol),!e.protocol.match(/^[a-zA-Z+-.]+$/))throw new t.InvalidArgumentException(`Forbidden characters`);i+=e.protocol}let u=i.toLocaleLowerCase();if(i+=`:`,(0,n.isSpecialScheme)(u)&&(i+=`//`),e.hostname===void 0)u!==`file`&&(i+=`placeholder`),o=!1;else{if(e.hostname===``)throw new t.InvalidArgumentException(`URL pattern must specify a hostname`);if(e.protocol===`file`)throw new t.InvalidArgumentException(`URL pattern protocol cannot be 'file'`);e.hostname=r(e.hostname);let n=!1;for(let r of e.hostname){if(r===`/`||r===`?`||r===`#`)throw new t.InvalidArgumentException(`'/', '?', '#' are forbidden in hostname`);if(!n&&r===`:`)throw new t.InvalidArgumentException(`':' is only allowed inside brackets in hostname`);r===`[`&&(n=!0),r===`]`&&(n=!1)}i+=e.hostname}if(e.port===void 0)s=!1;else{if(e.port===``)throw new t.InvalidArgumentException(`URL pattern must specify a port`);if(e.port=r(e.port),i+=`:`,!e.port.match(/^\d+$/))throw new t.InvalidArgumentException(`Forbidden characters`);i+=e.port}if(e.pathname===void 0)c=!1;else{if(e.pathname=r(e.pathname),e.pathname[0]!==`/`&&(i+=`/`),e.pathname.includes(`#`)||e.pathname.includes(`?`))throw new t.InvalidArgumentException(`Forbidden characters`);i+=e.pathname}if(e.search===void 0)l=!1;else{if(e.search=r(e.search),e.search[0]!==`?`&&(i+=`?`),e.search.includes(`#`))throw new t.InvalidArgumentException(`Forbidden characters`);i+=e.search}break}}let u=e=>{let t={"ftp:":21,"file:":null,"http:":80,"https:":443,"ws:":80,"wss:":443};if((0,n.isSpecialScheme)(e.protocol)&&t[e.protocol]!==null&&(!e.port||String(t[e.protocol])===e.port))return``;if(e.port)return e.port};try{let e=new URL(i);return{protocol:a?e.protocol.replace(/:$/,``):void 0,hostname:o?e.hostname:void 0,port:s?u(e):void 0,pathname:c&&e.pathname?e.pathname:void 0,search:l?e.search:void 0}}catch(e){throw new t.InvalidArgumentException(`${e.message} '${i}'`)}})}static wrapInterceptionError(e){return e?.message.includes(`Invalid header`)||e?.message.includes(`Unsafe header`)?new t.InvalidArgumentException(e.message):e}async addDataCollector(e){if(e.userContexts!==void 0&&e.contexts!==void 0)throw new t.InvalidArgumentException(`'contexts' and 'userContexts' are mutually exclusive`);if(e.userContexts!==void 0&&await this.#n.verifyUserContextIdList(e.userContexts),e.contexts!==void 0){for(let n of e.contexts)if(!this.#e.getContext(n).isTopLevelContext())throw new t.InvalidArgumentException(`Data collectors are available only on top-level browsing contexts`)}let n=this.#t.addDataCollector(e);return await this.#i(),{collector:n}}async getData(e){return await this.#t.getCollectedData(e)}async removeDataCollector(e){return this.#t.removeDataCollector(e),await this.#i(),{}}disownData(e){return this.#t.disownData(e),{}}async#s(e,n){if(e===void 0&&n===void 0)return this.#e.getTopLevelContexts();if(e!==void 0&&n!==void 0)throw new t.InvalidArgumentException(`User contexts and browsing contexts are mutually exclusive`);let r=[];if(n!==void 0){if(n.length===0)throw new t.InvalidArgumentException(`user context should be provided`);await this.#n.verifyUserContextIdList(n);for(let e of n){let t=this.#e.getTopLevelContexts().filter(t=>t.userContext===e);r.push(...t)}}if(e!==void 0){if(e.length===0)throw new t.InvalidArgumentException(`browsing context should be provided`);for(let n of e){let e=this.#e.getContext(n);if(!e.isTopLevelContext())throw new t.InvalidArgumentException(`The command is only supported on the top-level context`);r.push(e)}}return[...new Set(r).values()]}async setExtraHeaders(e){let t=await this.#s(e.contexts,e.userContexts),n=s(e.headers);return e.userContexts===void 0&&e.contexts===void 0&&this.#r.updateGlobalConfig({extraHeaders:n}),e.userContexts!==void 0&&e.userContexts.forEach(e=>{this.#r.updateUserContextConfig(e,{extraHeaders:n})}),e.contexts!==void 0&&e.contexts.forEach(e=>{this.#r.updateBrowsingContextConfig(e,{extraHeaders:n})}),await Promise.all(t.map(async e=>{let t=this.#r.getActiveConfig(e.id,e.userContext).extraHeaders??{};await e.setExtraHeaders(t)})),{}}};function r(e){let n=new Set([`(`,`)`,`*`,`{`,`}`]),r=``,i=!1;for(let a of e){if(!i){if(n.has(a))throw new t.InvalidArgumentException(`Forbidden characters`);if(a===`\\`){i=!0;continue}}r+=a,i=!1}return r}let i=new Set([` `,`	`,`
`,`"`,`(`,`)`,`,`,`/`,`:`,`;`,`<`,`=`,`>`,`?`,`@`,`[`,`\\`,`]`,`{`,`}`]),a=new Set([`\0`,`
`,`\r`]);function o(e,t){for(let n of e)if(t.has(n))return!0;return!1}function s(e){let n={};for(let r of e)if(r.value.type===`string`){let e=r.name,s=r.value.value;if(e.length===0)throw new t.InvalidArgumentException(`Empty header name is not allowed`);if(o(e,i))throw new t.InvalidArgumentException(`Header name '${e}' contains forbidden symbols`);if(o(s,a))throw new t.InvalidArgumentException(`Header value '${s}' contains forbidden symbols`);if(s.trim()!==s)throw new t.InvalidArgumentException(`Header value should not contain trailing or ending whitespaces`);n[r.name]===void 0?n[r.name]=r.value.value:n[r.name]=`${n[r.name]}, ${r.value.value}`}else throw new t.UnsupportedOperationException(`Only string headers values are supported`);return n}})),Dt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PermissionsProcessor=void 0;let t=z();e.PermissionsProcessor=class{#e;constructor(e){this.#e=e}async setPermissions(e){try{let t=e[`goog:userContext`]||e.userContext;await this.#e.sendCommand(`Browser.setPermission`,{origin:e.origin,embeddedOrigin:e.embeddedOrigin,browserContextId:t&&t!==`default`?t:void 0,permission:{name:e.descriptor.name},setting:e.state})}catch(e){if(e.message===`Permission can't be granted to opaque origins.`)return{};throw new t.InvalidArgumentException(e.message)}return{}}}})),V=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.uuidv4=n;function t(e){return e.reduce((e,t)=>e+t.toString(16).padStart(2,`0`),``)}function n(){if(`crypto`in globalThis&&`randomUUID`in globalThis.crypto)return globalThis.crypto.randomUUID();let e=new Uint8Array(16);return`crypto`in globalThis&&`getRandomValues`in globalThis.crypto?globalThis.crypto.getRandomValues(e):re(`crypto`).webcrypto.getRandomValues(e),e[6]=e[6]&15|64,e[8]=e[8]&63|128,[t(e.subarray(0,4)),t(e.subarray(4,6)),t(e.subarray(6,8)),t(e.subarray(8,10)),t(e.subarray(10,16))].join(`-`)}})),Ot=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ChannelProxy=void 0;let t=z(),n=L(),r=V();e.ChannelProxy=class e{#e;#t=(0,r.uuidv4)();#n;constructor(e,t){this.#e=e,this.#n=t}async init(t,n){let r=await e.#i(t),i=await e.#a(t,r);return this.#o(t,r,n),i}async startListenerFromWindow(e,t){try{let n=await this.#s(e);this.#o(e,n,t)}catch(e){this.#n?.(n.LogType.debugError,e)}}static#r(){return`(${String(()=>{let e=[],t=null;return{async getMessage(){return await(e.length>0?Promise.resolve():new Promise(e=>{t=e})),e.shift()},sendMessage(n){e.push(n),t!==null&&(t(),t=null)}}})})()`}static async#i(e){let t=await e.cdpClient.sendCommand(`Runtime.evaluate`,{expression:this.#r(),contextId:e.executionContextId,serializationOptions:{serialization:`idOnly`}});if(t.exceptionDetails||t.result.objectId===void 0)throw Error(`Cannot create channel`);return t.result.objectId}static async#a(e,t){return(await e.cdpClient.sendCommand(`Runtime.callFunctionOn`,{functionDeclaration:String(e=>e.sendMessage),arguments:[{objectId:t}],executionContextId:e.executionContextId,serializationOptions:{serialization:`idOnly`}})).result.objectId}async#o(e,r,i){for(;;)try{let n=await e.cdpClient.sendCommand(`Runtime.callFunctionOn`,{functionDeclaration:String(async e=>await e.getMessage()),arguments:[{objectId:r}],awaitPromise:!0,executionContextId:e.executionContextId,serializationOptions:{serialization:`deep`,maxDepth:this.#e.serializationOptions?.maxObjectDepth??void 0}});if(n.exceptionDetails)throw Error(`Runtime.callFunctionOn in ChannelProxy`,{cause:n.exceptionDetails});for(let r of e.associatedBrowsingContexts)i.registerEvent({type:`event`,method:t.ChromiumBidi.Script.EventNames.Message,params:{channel:this.#e.channel,data:e.cdpToBidiValue(n,this.#e.ownership??`none`),source:e.source}},r.id)}catch(e){this.#n?.(n.LogType.debugError,e);break}}async#s(e){let t=await e.cdpClient.sendCommand(`Runtime.callFunctionOn`,{functionDeclaration:String(e=>{let t=window;if(t[e]===void 0)return new Promise(n=>t[e]=n);let n=t[e];return delete t[e],n}),arguments:[{value:this.#t}],executionContextId:e.executionContextId,awaitPromise:!0,serializationOptions:{serialization:`idOnly`}});if(t.exceptionDetails!==void 0||t.result.objectId===void 0)throw Error(`ChannelHandle not found in window["${this.#t}"]`);return t.result.objectId}getEvalInWindowStr(){let t=String((e,t)=>{let n=window;return n[e]===void 0?n[e]=t:(n[e](t),delete n[e]),t.sendMessage}),n=e.#r();return`(${t})('${this.#t}',${n})`}}})),kt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PreloadScript=void 0;let t=V(),n=Ot();e.PreloadScript=class{#e=(0,t.uuidv4)();#t=[];#n;#r=new Set;#i;#a;#o;#s;get id(){return this.#e}get targetIds(){return this.#r}constructor(e,t){this.#i=e.arguments?.map(e=>new n.ChannelProxy(e.value,t))??[],this.#n=e.functionDeclaration,this.#a=e.sandbox,this.#o=e.contexts,this.#s=e.userContexts}get channels(){return this.#i}get contexts(){return this.#o}get userContexts(){return this.#s}#c(){let e=`[${this.channels.map(e=>e.getEvalInWindowStr()).join(`, `)}]`;return`(()=>{(${this.#n})(...${e})})()`}async initInTargets(e,t){await Promise.all(Array.from(e).map(e=>this.initInTarget(e,t)))}async initInTarget(e,t){let n=await e.cdpClient.sendCommand(`Page.addScriptToEvaluateOnNewDocument`,{source:this.#c(),worldName:this.#a,runImmediately:t});this.#t.push({target:e,preloadScriptId:n.identifier}),this.#r.add(e.id)}async remove(){await Promise.all([this.#t.map(async e=>{let t=e.target,n=e.preloadScriptId;return await t.cdpClient.sendCommand(`Page.removeScriptToEvaluateOnNewDocument`,{identifier:n})})])}dispose(e){this.#t=this.#t.filter(t=>t.target?.id!==e),this.#r.delete(e)}}})),At=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ScriptProcessor=void 0;let t=z(),n=kt();e.ScriptProcessor=class{#e;#t;#n;#r;#i;#a;constructor(e,n,r,i,a,o){this.#t=n,this.#n=r,this.#r=i,this.#i=a,this.#a=o,this.#e=e,this.#e.addSubscribeHook(t.ChromiumBidi.Script.EventNames.RealmCreated,this.#o.bind(this))}#o(e){let n=this.#t.getContext(e),r=[n,...this.#t.getContext(e).allChildren],i=new Set;for(let e of r){let t=this.#n.findRealms({browsingContextId:e.id});for(let e of t)i.add(e)}for(let e of i)this.#e.registerEvent({type:`event`,method:t.ChromiumBidi.Script.EventNames.RealmCreated,params:e.realmInfo},n.id);return Promise.resolve()}async addPreloadScript(e){if(e.userContexts?.length&&e.contexts?.length)throw new t.InvalidArgumentException(`Both userContexts and contexts cannot be specified.`);let r=await this.#i.verifyUserContextIdList(e.userContexts??[]),i=this.#t.verifyTopLevelContextsList(e.contexts),a=new n.PreloadScript(e,this.#a);this.#r.add(a);let o=[];o=r.size?this.#t.getTopLevelContexts().filter(e=>r.has(e.userContext)):i.size?[...i.values()]:this.#t.getTopLevelContexts();let s=new Set(o.map(e=>e.cdpTarget));return await a.initInTargets(s,!1),{script:a.id}}async removePreloadScript(e){let{script:t}=e;return await this.#r.getPreloadScript(t).remove(),this.#r.remove(t),{}}async callFunction(e){return await(await this.#s(e.target)).callFunction(e.functionDeclaration,e.awaitPromise,e.this,e.arguments,e.resultOwnership,e.serializationOptions,e.userActivation)}async evaluate(e){return await(await this.#s(e.target)).evaluate(e.expression,e.awaitPromise,e.resultOwnership,e.serializationOptions,e.userActivation)}async disown(e){let t=await this.#s(e.target);return await Promise.all(e.handles.map(async e=>await t.disown(e))),{}}getRealms(e){return e.context!==void 0&&this.#t.getContext(e.context),{realms:this.#n.findRealms({browsingContextId:e.context,type:e.type,isHidden:!1}).map(e=>e.realmInfo)}}async#s(e){return`context`in e?await this.#t.getContext(e.context).getOrCreateUserSandbox(e.sandbox):this.#n.getRealm({realmId:e.realm,isHidden:!1})}}})),jt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SessionProcessor=void 0;let t=z();e.SessionProcessor=class{#e;#t;#n;#r=!1;constructor(e,t,n){this.#e=e,this.#t=t,this.#n=n}status(){return{ready:!1,message:`already connected`}}#i(e){let n=[];for(let r of e.firstMatch??[{}]){let i={...e.alwaysMatch};for(let e of Object.keys(r)){if(i[e]!==void 0)throw new t.InvalidArgumentException(`Capability ${e} in firstMatch is already defined in alwaysMatch`);i[e]=r[e]}n.push(i)}let r=n.find(e=>e.browserName===`chrome`)??n[0]??{};return r.unhandledPromptBehavior=this.#a(r.unhandledPromptBehavior),r}#a(e){if(e!==void 0){if(typeof e==`object`)return e;if(typeof e!=`string`)throw new t.InvalidArgumentException(`Unexpected 'unhandledPromptBehavior' type: ${typeof e}`);switch(e){case`accept`:case`accept and notify`:return{default:`accept`,beforeUnload:`accept`};case`dismiss`:case`dismiss and notify`:return{default:`dismiss`,beforeUnload:`accept`};case`ignore`:return{default:`ignore`,beforeUnload:`accept`};default:throw new t.InvalidArgumentException(`Unexpected 'unhandledPromptBehavior' value: ${e}`)}}}async new(e){if(this.#r)throw Error(`Session has been already created.`);this.#r=!0;let t=this.#i(e.capabilities);await this.#n(t);let n=await this.#t.sendCommand(`Browser.getVersion`);return{sessionId:`unknown`,capabilities:{...t,acceptInsecureCerts:t.acceptInsecureCerts??!1,browserName:n.product,browserVersion:n.revision,platformName:``,setWindowRect:!1,webSocketUrl:``,userAgent:n.userAgent}}}async subscribe(e,t=null){return{subscription:await this.#e.subscribe(e.events,e.contexts??[],e.userContexts??[],t)}}async unsubscribe(e,t=null){return`subscriptions`in e?(await this.#e.unsubscribeByIds(e.subscriptions),{}):(await this.#e.unsubscribe(e.events,t),{})}}})),Mt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.StorageProcessor=void 0;let t=z(),n=B(),r=L(),i=Et(),a=Tt();e.StorageProcessor=class{#e;#t;#n;constructor(e,t,n){this.#t=t,this.#e=e,this.#n=n}async deleteCookies(e){let n=this.#s(e.partition),r;try{r=await this.#e.sendCommand(`Storage.getCookies`,{browserContextId:this.#i(n)})}catch(e){throw this.#r(e)?new t.NoSuchUserContextException(e.message):e}let i=r.cookies.filter(e=>n.sourceOrigin===void 0||e.partitionKey?.topLevelSite===n.sourceOrigin).filter(t=>{let n=(0,a.cdpToBiDiCookie)(t);return this.#c(n,e.filter)}).map(e=>({...e,expires:1}));return await this.#e.sendCommand(`Storage.setCookies`,{cookies:i,browserContextId:this.#i(n)}),{partitionKey:n}}async getCookies(e){let n=this.#s(e.partition),r;try{r=await this.#e.sendCommand(`Storage.getCookies`,{browserContextId:this.#i(n)})}catch(e){throw this.#r(e)?new t.NoSuchUserContextException(e.message):e}return{cookies:r.cookies.filter(e=>n.sourceOrigin===void 0||e.partitionKey?.topLevelSite===n.sourceOrigin).map(e=>(0,a.cdpToBiDiCookie)(e)).filter(t=>this.#c(t,e.filter)),partitionKey:n}}async setCookie(e){let n=this.#s(e.partition),i=(0,a.bidiToCdpCookie)(e,n);try{await this.#e.sendCommand(`Storage.setCookies`,{cookies:[i],browserContextId:this.#i(n)})}catch(e){throw this.#r(e)?new t.NoSuchUserContextException(e.message):(this.#n?.(r.LogType.debugError,e),new t.UnableToSetCookieException(e.toString()))}return{partitionKey:n}}#r(e){return e.message?.startsWith(`Failed to find browser context for id`)}#i(e){return e.userContext===`default`?void 0:e.userContext}#a(e){let t=e.context;return{userContext:this.#t.getContext(t).userContext}}#o(e){let t=new Map,n=e.sourceOrigin;if(n!==void 0){let e=i.NetworkProcessor.parseUrlString(n);n=e.origin===`null`?e.origin:`${e.protocol}//${e.hostname}`}for(let[n,r]of Object.entries(e))n!==void 0&&r!==void 0&&![`type`,`sourceOrigin`,`userContext`].includes(n)&&t.set(n,r);return t.size>0&&this.#n?.(r.LogType.debugInfo,`Unsupported partition keys: ${JSON.stringify(Object.fromEntries(t))}`),{userContext:e.userContext??`default`,...n===void 0?{}:{sourceOrigin:n}}}#s(e){return e===void 0?{userContext:`default`}:e.type===`context`?this.#a(e):((0,n.assert)(e.type===`storageKey`,`Unknown partition type`),this.#o(e))}#c(e,t){return t===void 0?!0:(t.domain===void 0||t.domain===e.domain)&&(t.name===void 0||t.name===e.name)&&(t.value===void 0||(0,a.deserializeByteValue)(t.value)===(0,a.deserializeByteValue)(e.value))&&(t.path===void 0||t.path===e.path)&&(t.size===void 0||t.size===e.size)&&(t.httpOnly===void 0||t.httpOnly===e.httpOnly)&&(t.secure===void 0||t.secure===e.secure)&&(t.sameSite===void 0||t.sameSite===e.sameSite)&&(t.expiry===void 0||t.expiry===e.expiry)}}})),Nt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.WebExtensionProcessor=void 0;let t=z();e.WebExtensionProcessor=class{#e;constructor(e){this.#e=e}async install(e){switch(e.extensionData.type){case`archivePath`:case`base64`:throw new t.UnsupportedOperationException(`Archived and Base64 extensions are not supported`);case`path`:break}try{return{extension:(await this.#e.sendCommand(`Extensions.loadUnpacked`,{path:e.extensionData.path})).id}}catch(e){throw e.message.startsWith(`invalid web extension`)?new t.InvalidWebExtensionException(e.message):e}}async uninstall(e){try{return await this.#e.sendCommand(`Extensions.uninstall`,{id:e.extension}),{}}catch(e){throw e.message===`Uninstall failed. Reason: could not find extension.`?new t.NoSuchWebExtensionException(`no such web extension`):e}}}})),Pt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.OutgoingMessage=void 0,e.OutgoingMessage=class e{#e;#t;constructor(e,t=null){this.#e=e,this.#t=t}static createFromPromise(t,n){return t.then(t=>t.kind===`success`?{kind:`success`,value:new e(t.value,n)}:t)}static createResolved(t,n=null){return Promise.resolve({kind:`success`,value:new e(t,n)})}get message(){return this.#e}get googChannel(){return this.#t}}})),Ft=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.CommandProcessor=void 0;let t=z(),n=nt(),r=L(),i=ut(),a=dt(),o=ft(),s=pt(),c=mt(),l=Ct(),u=Et(),d=Dt(),f=At(),p=jt(),m=Mt(),h=Nt(),g=Pt();e.CommandProcessor=class extends n.EventEmitter{#e;#t;#n;#r;#i;#a;#o;#s;#c;#l;#u;#d;#f;#p;#m;constructor(e,t,n,r,g,_,v,y,b,x,S=new i.BidiNoOpParser,C,w){super(),this.#t=t,this.#p=S,this.#m=w,this.#e=b,this.#n=new a.BrowserProcessor(t,r,y,x),this.#r=new s.BrowsingContextProcessor(t,r,x,y,n),this.#i=new o.CdpProcessor(r,g,e,t),this.#a=new c.EmulationProcessor(r,x,y),this.#o=new l.InputProcessor(r),this.#s=new u.NetworkProcessor(r,v,x,y),this.#c=new d.PermissionsProcessor(t),this.#l=new f.ScriptProcessor(n,r,g,_,x,w),this.#u=new p.SessionProcessor(n,t,C),this.#d=new m.StorageProcessor(t,r,w),this.#f=new h.WebExtensionProcessor(t)}async#h(e){switch(e.method){case`bluetooth.disableSimulation`:return await this.#e.disableSimulation(this.#p.parseDisableSimulationParameters(e.params));case`bluetooth.handleRequestDevicePrompt`:return await this.#e.handleRequestDevicePrompt(this.#p.parseHandleRequestDevicePromptParams(e.params));case`bluetooth.simulateAdapter`:return await this.#e.simulateAdapter(this.#p.parseSimulateAdapterParameters(e.params));case`bluetooth.simulateAdvertisement`:return await this.#e.simulateAdvertisement(this.#p.parseSimulateAdvertisementParameters(e.params));case`bluetooth.simulateCharacteristic`:return await this.#e.simulateCharacteristic(this.#p.parseSimulateCharacteristicParameters(e.params));case`bluetooth.simulateCharacteristicResponse`:return await this.#e.simulateCharacteristicResponse(this.#p.parseSimulateCharacteristicResponseParameters(e.params));case`bluetooth.simulateDescriptor`:return await this.#e.simulateDescriptor(this.#p.parseSimulateDescriptorParameters(e.params));case`bluetooth.simulateDescriptorResponse`:return await this.#e.simulateDescriptorResponse(this.#p.parseSimulateDescriptorResponseParameters(e.params));case`bluetooth.simulateGattConnectionResponse`:return await this.#e.simulateGattConnectionResponse(this.#p.parseSimulateGattConnectionResponseParameters(e.params));case`bluetooth.simulateGattDisconnection`:return await this.#e.simulateGattDisconnection(this.#p.parseSimulateGattDisconnectionParameters(e.params));case`bluetooth.simulatePreconnectedPeripheral`:return await this.#e.simulatePreconnectedPeripheral(this.#p.parseSimulatePreconnectedPeripheralParameters(e.params));case`bluetooth.simulateService`:return await this.#e.simulateService(this.#p.parseSimulateServiceParameters(e.params));case`browser.close`:return this.#n.close();case`browser.createUserContext`:return await this.#n.createUserContext(this.#p.parseCreateUserContextParameters(e.params));case`browser.getClientWindows`:return await this.#n.getClientWindows();case`browser.getUserContexts`:return await this.#n.getUserContexts();case`browser.removeUserContext`:return await this.#n.removeUserContext(this.#p.parseRemoveUserContextParameters(e.params));case`browser.setClientWindowState`:throw this.#p.parseSetClientWindowStateParameters(e.params),new t.UnsupportedOperationException(`Method ${e.method} is not implemented.`);case`browser.setDownloadBehavior`:return await this.#n.setDownloadBehavior(this.#p.parseSetDownloadBehaviorParameters(e.params));case`browsingContext.activate`:return await this.#r.activate(this.#p.parseActivateParams(e.params));case`browsingContext.captureScreenshot`:return await this.#r.captureScreenshot(this.#p.parseCaptureScreenshotParams(e.params));case`browsingContext.close`:return await this.#r.close(this.#p.parseCloseParams(e.params));case`browsingContext.create`:return await this.#r.create(this.#p.parseCreateParams(e.params));case`browsingContext.getTree`:return this.#r.getTree(this.#p.parseGetTreeParams(e.params));case`browsingContext.handleUserPrompt`:return await this.#r.handleUserPrompt(this.#p.parseHandleUserPromptParams(e.params));case`browsingContext.locateNodes`:return await this.#r.locateNodes(this.#p.parseLocateNodesParams(e.params));case`browsingContext.navigate`:return await this.#r.navigate(this.#p.parseNavigateParams(e.params));case`browsingContext.print`:return await this.#r.print(this.#p.parsePrintParams(e.params));case`browsingContext.reload`:return await this.#r.reload(this.#p.parseReloadParams(e.params));case`browsingContext.setViewport`:return await this.#r.setViewport(this.#p.parseSetViewportParams(e.params));case`browsingContext.traverseHistory`:return await this.#r.traverseHistory(this.#p.parseTraverseHistoryParams(e.params));case`goog:cdp.getSession`:return this.#i.getSession(this.#p.parseGetSessionParams(e.params));case`goog:cdp.resolveRealm`:return this.#i.resolveRealm(this.#p.parseResolveRealmParams(e.params));case`goog:cdp.sendCommand`:return await this.#i.sendCommand(this.#p.parseSendCommandParams(e.params));case`emulation.setForcedColorsModeThemeOverride`:throw this.#p.parseSetForcedColorsModeThemeOverrideParams(e.params),new t.UnsupportedOperationException(`Method ${e.method} is not implemented.`);case`emulation.setGeolocationOverride`:return await this.#a.setGeolocationOverride(this.#p.parseSetGeolocationOverrideParams(e.params));case`emulation.setLocaleOverride`:return await this.#a.setLocaleOverride(this.#p.parseSetLocaleOverrideParams(e.params));case`emulation.setNetworkConditions`:return await this.#a.setNetworkConditions(this.#p.parseSetNetworkConditionsParams(e.params));case`emulation.setScreenOrientationOverride`:return await this.#a.setScreenOrientationOverride(this.#p.parseSetScreenOrientationOverrideParams(e.params));case`emulation.setScriptingEnabled`:return await this.#a.setScriptingEnabled(this.#p.parseSetScriptingEnabledParams(e.params));case`emulation.setTimezoneOverride`:return await this.#a.setTimezoneOverride(this.#p.parseSetTimezoneOverrideParams(e.params));case`emulation.setUserAgentOverride`:return await this.#a.setUserAgentOverrideParams(this.#p.parseSetUserAgentOverrideParams(e.params));case`input.performActions`:return await this.#o.performActions(this.#p.parsePerformActionsParams(e.params));case`input.releaseActions`:return await this.#o.releaseActions(this.#p.parseReleaseActionsParams(e.params));case`input.setFiles`:return await this.#o.setFiles(this.#p.parseSetFilesParams(e.params));case`network.addDataCollector`:return await this.#s.addDataCollector(this.#p.parseAddDataCollectorParams(e.params));case`network.addIntercept`:return await this.#s.addIntercept(this.#p.parseAddInterceptParams(e.params));case`network.continueRequest`:return await this.#s.continueRequest(this.#p.parseContinueRequestParams(e.params));case`network.continueResponse`:return await this.#s.continueResponse(this.#p.parseContinueResponseParams(e.params));case`network.continueWithAuth`:return await this.#s.continueWithAuth(this.#p.parseContinueWithAuthParams(e.params));case`network.disownData`:return this.#s.disownData(this.#p.parseDisownDataParams(e.params));case`network.failRequest`:return await this.#s.failRequest(this.#p.parseFailRequestParams(e.params));case`network.getData`:return await this.#s.getData(this.#p.parseGetDataParams(e.params));case`network.provideResponse`:return await this.#s.provideResponse(this.#p.parseProvideResponseParams(e.params));case`network.removeDataCollector`:return await this.#s.removeDataCollector(this.#p.parseRemoveDataCollectorParams(e.params));case`network.removeIntercept`:return await this.#s.removeIntercept(this.#p.parseRemoveInterceptParams(e.params));case`network.setCacheBehavior`:return await this.#s.setCacheBehavior(this.#p.parseSetCacheBehaviorParams(e.params));case`network.setExtraHeaders`:return await this.#s.setExtraHeaders(this.#p.parseSetExtraHeadersParams(e.params));case`permissions.setPermission`:return await this.#c.setPermissions(this.#p.parseSetPermissionsParams(e.params));case`script.addPreloadScript`:return await this.#l.addPreloadScript(this.#p.parseAddPreloadScriptParams(e.params));case`script.callFunction`:return await this.#l.callFunction(this.#p.parseCallFunctionParams(this.#g(e.params)));case`script.disown`:return await this.#l.disown(this.#p.parseDisownParams(this.#g(e.params)));case`script.evaluate`:return await this.#l.evaluate(this.#p.parseEvaluateParams(this.#g(e.params)));case`script.getRealms`:return this.#l.getRealms(this.#p.parseGetRealmsParams(e.params));case`script.removePreloadScript`:return await this.#l.removePreloadScript(this.#p.parseRemovePreloadScriptParams(e.params));case`session.end`:throw new t.UnsupportedOperationException(`Method ${e.method} is not implemented.`);case`session.new`:return await this.#u.new(e.params);case`session.status`:return this.#u.status();case`session.subscribe`:return await this.#u.subscribe(this.#p.parseSubscribeParams(e.params),e[`goog:channel`]);case`session.unsubscribe`:return await this.#u.unsubscribe(this.#p.parseUnsubscribeParams(e.params),e[`goog:channel`]);case`storage.deleteCookies`:return await this.#d.deleteCookies(this.#p.parseDeleteCookiesParams(e.params));case`storage.getCookies`:return await this.#d.getCookies(this.#p.parseGetCookiesParams(e.params));case`storage.setCookie`:return await this.#d.setCookie(this.#p.parseSetCookieParams(e.params));case`webExtension.install`:return await this.#f.install(this.#p.parseInstallParams(e.params));case`webExtension.uninstall`:return await this.#f.uninstall(this.#p.parseUninstallParams(e.params))}throw new t.UnknownCommandException(`Unknown command '${e?.method}'.`)}#g(e){return typeof e==`object`&&e&&`target`in e&&typeof e.target==`object`&&e.target&&`context`in e.target&&delete e.target.realm,e}async processCommand(e){try{let t=await this.#h(e),n={type:`success`,id:e.id,result:t};this.emit(`response`,{message:g.OutgoingMessage.createResolved(n,e[`goog:channel`]),event:e.method})}catch(n){if(n instanceof t.Exception)this.emit(`response`,{message:g.OutgoingMessage.createResolved(n.toErrorResponse(e.id),e[`goog:channel`]),event:e.method});else{let i=n;this.#m?.(r.LogType.bidi,i);let a=this.#t.isCloseError(n)?new t.NoSuchFrameException(`Browsing context is gone`):new t.UnknownErrorException(i.message,i.stack);this.emit(`response`,{message:g.OutgoingMessage.createResolved(a.toErrorResponse(e.id),e[`goog:channel`]),event:e.method})}}}}})),It=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.BluetoothProcessor=void 0;let t=z();var n=class{id;uuid;constructor(e,t){this.id=e,this.uuid=t}},r=class extends n{characteristic;constructor(e,t,n){super(e,t),this.characteristic=n}},i=class extends n{descriptors=new Map;service;constructor(e,t,n){super(e,t),this.service=n}},a=class extends n{characteristics=new Map;device;constructor(e,t,n){super(e,t),this.device=n}},o=class{address;services=new Map;constructor(e){this.address=e}};e.BluetoothProcessor=class{#e;#t;#n=new Map;#r=new Map;#i=new Map;constructor(e,t){this.#e=e,this.#t=t}#a(e){let n=this.#n.get(e);if(!n)throw new t.InvalidArgumentException(`Bluetooth device with address ${e} does not exist`);return n}#o(e,n){let r=e.services.get(n);if(!r)throw new t.InvalidArgumentException(`Service with UUID ${n} on device ${e.address} does not exist`);return r}#s(e,n){let r=e.characteristics.get(n);if(!r)throw new t.InvalidArgumentException(`Characteristic with UUID ${n} does not exist for service ${e.uuid} on device ${e.device.address}`);return r}#c(e,n){let r=e.descriptors.get(n);if(!r)throw new t.InvalidArgumentException(`Descriptor with UUID ${n} does not exist for characteristic ${e.uuid} on service ${e.service.uuid} on device ${e.service.device.address}`);return r}async simulateAdapter(e){if(e.state===void 0)throw new t.InvalidArgumentException(`Parameter "state" is required for creating a Bluetooth adapter`);let n=this.#t.getContext(e.context);return await n.cdpTarget.browserCdpClient.sendCommand(`BluetoothEmulation.disable`),this.#n.clear(),this.#r.clear(),this.#i.clear(),await n.cdpTarget.browserCdpClient.sendCommand(`BluetoothEmulation.enable`,{state:e.state,leSupported:e.leSupported??!0}),{}}async disableSimulation(e){return await this.#t.getContext(e.context).cdpTarget.browserCdpClient.sendCommand(`BluetoothEmulation.disable`),this.#n.clear(),this.#r.clear(),this.#i.clear(),{}}async simulatePreconnectedPeripheral(e){if(this.#n.has(e.address))throw new t.InvalidArgumentException(`Bluetooth device with address ${e.address} already exists`);return await this.#t.getContext(e.context).cdpTarget.browserCdpClient.sendCommand(`BluetoothEmulation.simulatePreconnectedPeripheral`,{address:e.address,name:e.name,knownServiceUuids:e.knownServiceUuids,manufacturerData:e.manufacturerData}),this.#n.set(e.address,new o(e.address)),{}}async simulateAdvertisement(e){return await this.#t.getContext(e.context).cdpTarget.browserCdpClient.sendCommand(`BluetoothEmulation.simulateAdvertisement`,{entry:e.scanEntry}),{}}async simulateCharacteristic(e){let n=this.#a(e.address),r=this.#o(n,e.serviceUuid),a=this.#t.getContext(e.context);switch(e.type){case`add`:{if(e.characteristicProperties===void 0)throw new t.InvalidArgumentException(`Parameter "characteristicProperties" is required for adding a Bluetooth characteristic`);if(r.characteristics.has(e.characteristicUuid))throw new t.InvalidArgumentException(`Characteristic with UUID ${e.characteristicUuid} already exists`);let n=new i((await a.cdpTarget.browserCdpClient.sendCommand(`BluetoothEmulation.addCharacteristic`,{serviceId:r.id,characteristicUuid:e.characteristicUuid,properties:e.characteristicProperties})).characteristicId,e.characteristicUuid,r);return r.characteristics.set(e.characteristicUuid,n),this.#r.set(n.id,n),{}}case`remove`:{if(e.characteristicProperties!==void 0)throw new t.InvalidArgumentException(`Parameter "characteristicProperties" should not be provided for removing a Bluetooth characteristic`);let n=this.#s(r,e.characteristicUuid);return await a.cdpTarget.browserCdpClient.sendCommand(`BluetoothEmulation.removeCharacteristic`,{characteristicId:n.id}),r.characteristics.delete(e.characteristicUuid),this.#r.delete(n.id),{}}default:throw new t.InvalidArgumentException(`Parameter "type" of ${e.type} is not supported`)}}async simulateCharacteristicResponse(e){let t=this.#t.getContext(e.context),n=this.#a(e.address),r=this.#o(n,e.serviceUuid),i=this.#s(r,e.characteristicUuid);return await t.cdpTarget.browserCdpClient.sendCommand(`BluetoothEmulation.simulateCharacteristicOperationResponse`,{characteristicId:i.id,type:e.type,code:e.code,...e.data&&{data:btoa(String.fromCharCode(...e.data))}}),{}}async simulateDescriptor(e){let n=this.#a(e.address),i=this.#o(n,e.serviceUuid),a=this.#s(i,e.characteristicUuid),o=this.#t.getContext(e.context);switch(e.type){case`add`:{if(a.descriptors.has(e.descriptorUuid))throw new t.InvalidArgumentException(`Descriptor with UUID ${e.descriptorUuid} already exists`);let n=new r((await o.cdpTarget.browserCdpClient.sendCommand(`BluetoothEmulation.addDescriptor`,{characteristicId:a.id,descriptorUuid:e.descriptorUuid})).descriptorId,e.descriptorUuid,a);return a.descriptors.set(e.descriptorUuid,n),this.#i.set(n.id,n),{}}case`remove`:{let t=this.#c(a,e.descriptorUuid);return await o.cdpTarget.browserCdpClient.sendCommand(`BluetoothEmulation.removeDescriptor`,{descriptorId:t.id}),a.descriptors.delete(e.descriptorUuid),this.#i.delete(t.id),{}}default:throw new t.InvalidArgumentException(`Parameter "type" of ${e.type} is not supported`)}}async simulateDescriptorResponse(e){let t=this.#t.getContext(e.context),n=this.#a(e.address),r=this.#o(n,e.serviceUuid),i=this.#s(r,e.characteristicUuid),a=this.#c(i,e.descriptorUuid);return await t.cdpTarget.browserCdpClient.sendCommand(`BluetoothEmulation.simulateDescriptorOperationResponse`,{descriptorId:a.id,type:e.type,code:e.code,...e.data&&{data:btoa(String.fromCharCode(...e.data))}}),{}}async simulateGattConnectionResponse(e){return await this.#t.getContext(e.context).cdpTarget.browserCdpClient.sendCommand(`BluetoothEmulation.simulateGATTOperationResponse`,{address:e.address,type:`connection`,code:e.code}),{}}async simulateGattDisconnection(e){return await this.#t.getContext(e.context).cdpTarget.browserCdpClient.sendCommand(`BluetoothEmulation.simulateGATTDisconnection`,{address:e.address}),{}}async simulateService(e){let n=this.#a(e.address),r=this.#t.getContext(e.context);switch(e.type){case`add`:{if(n.services.has(e.uuid))throw new t.InvalidArgumentException(`Service with UUID ${e.uuid} already exists`);let i=await r.cdpTarget.browserCdpClient.sendCommand(`BluetoothEmulation.addService`,{address:e.address,serviceUuid:e.uuid});return n.services.set(e.uuid,new a(i.serviceId,e.uuid,n)),{}}case`remove`:{let t=this.#o(n,e.uuid);return await r.cdpTarget.browserCdpClient.sendCommand(`BluetoothEmulation.removeService`,{serviceId:t.id}),n.services.delete(e.uuid),{}}default:throw new t.InvalidArgumentException(`Parameter "type" of ${e.type} is not supported`)}}onCdpTargetCreated(e){e.cdpClient.on(`DeviceAccess.deviceRequestPrompted`,t=>{this.#e.registerEvent({type:`event`,method:`bluetooth.requestDevicePromptUpdated`,params:{context:e.id,prompt:t.id,devices:t.devices}},e.id)}),e.browserCdpClient.on(`BluetoothEmulation.gattOperationReceived`,async t=>{switch(t.type){case`connection`:this.#e.registerEvent({type:`event`,method:`bluetooth.gattConnectionAttempted`,params:{context:e.id,address:t.address}},e.id);return;case`discovery`:await e.browserCdpClient.sendCommand(`BluetoothEmulation.simulateGATTOperationResponse`,{address:t.address,type:`discovery`,code:0})}}),e.browserCdpClient.on(`BluetoothEmulation.characteristicOperationReceived`,t=>{if(!this.#r.has(t.characteristicId))return;let n;if(t.type===`write`){if(t.writeType===`write-default-deprecated`)return;n=t.writeType}else n=t.type;let r=this.#r.get(t.characteristicId);this.#e.registerEvent({type:`event`,method:`bluetooth.characteristicEventGenerated`,params:{context:e.id,address:r.service.device.address,serviceUuid:r.service.uuid,characteristicUuid:r.uuid,type:n,...t.data&&{data:Array.from(atob(t.data),e=>e.charCodeAt(0))}}},e.id)}),e.browserCdpClient.on(`BluetoothEmulation.descriptorOperationReceived`,t=>{if(!this.#i.has(t.descriptorId))return;let n=this.#i.get(t.descriptorId);this.#e.registerEvent({type:`event`,method:`bluetooth.descriptorEventGenerated`,params:{context:e.id,address:n.characteristic.service.device.address,serviceUuid:n.characteristic.service.uuid,characteristicUuid:n.characteristic.uuid,descriptorUuid:n.uuid,type:t.type,...t.data&&{data:Array.from(atob(t.data),e=>e.charCodeAt(0))}}},e.id)})}async handleRequestDevicePrompt(e){let t=this.#t.getContext(e.context);return e.accept?await t.cdpTarget.cdpClient.sendCommand(`DeviceAccess.selectPrompt`,{id:e.prompt,deviceId:e.device}):await t.cdpTarget.cdpClient.sendCommand(`DeviceAccess.cancelPrompt`,{id:e.prompt}),{}}}})),Lt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ContextConfig=void 0,e.ContextConfig=class e{acceptInsecureCerts;devicePixelRatio;disableNetworkDurableMessages;downloadBehavior;emulatedNetworkConditions;extraHeaders;geolocation;locale;prerenderingDisabled;screenOrientation;scriptingEnabled;timezone;userAgent;userPromptHandler;viewport;static merge(...t){let n=new e;for(let e of t)if(e)for(let t in e){let r=e[t];r===null?delete n[t]:r!==void 0&&(n[t]=r)}return n}}})),Rt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.ContextConfigStorage=void 0;let t=Lt();e.ContextConfigStorage=class{#e=new t.ContextConfig;#t=new Map;#n=new Map;updateGlobalConfig(e){this.#e=t.ContextConfig.merge(this.#e,e)}updateBrowsingContextConfig(e,n){this.#n.set(e,t.ContextConfig.merge(this.#n.get(e),n))}updateUserContextConfig(e,n){this.#t.set(e,t.ContextConfig.merge(this.#t.get(e),n))}getGlobalConfig(){return this.#e}#r(e,t){let n=this.#e.extraHeaders??{},r=this.#t.get(t)?.extraHeaders??{},i=e===void 0?{}:this.#n.get(e)?.extraHeaders??{};return{...n,...r,...i}}getActiveConfig(e,n){let r=t.ContextConfig.merge(this.#e,this.#t.get(n));e!==void 0&&(r=t.ContextConfig.merge(r,this.#n.get(e)));let i=this.#r(e,n);return r.extraHeaders=Object.keys(i).length>0?i:void 0,r}}})),zt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.UserContextStorage=void 0;let t=z();e.UserContextStorage=class{#e;constructor(e){this.#e=e}async getUserContexts(){return[{userContext:`default`},...(await this.#e.sendCommand(`Target.getBrowserContexts`)).browserContextIds.map(e=>({userContext:e}))]}async verifyUserContextIdList(e){let n=new Set;if(!e.length)return n;let r=await this.getUserContexts(),i=new Set(r.map(e=>e.userContext));for(let r of e){if(!i.has(r))throw new t.NoSuchUserContextException(`User context ${r} not found`);n.add(r)}return n}}})),Bt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.Deferred=void 0,e.Deferred=class{#e=!1;#t;#n;#r;#i;get isFinished(){return this.#e}get result(){if(!this.#e)throw Error(`Deferred is not finished yet`);return this.#n}constructor(){this.#t=new Promise((e,t)=>{this.#r=e,this.#i=t}),this.#t.catch(e=>{})}then(e,t){return this.#t.then(e,t)}catch(e){return this.#t.catch(e)}resolve(e){this.#n=e,this.#e||(this.#e=!0,this.#r(e))}reject(e){this.#e||(this.#e=!0,this.#i(e))}finally(e){return this.#t.finally(e)}[Symbol.toStringTag]=`Promise`}})),Vt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.getTimestamp=t;function t(){return new Date().getTime()}})),Ht=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.inchesFromCm=t;function t(e){return e/2.54}})),Ut=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.getSharedId=t,e.parseSharedId=r;function t(e,t,n){return`f.${e}.d.${t}.e.${n}`}function n(e){let t=e.match(RegExp(`(.*)_element_(.*)`));if(!t)return null;let n=t[1],r=t[2];if(n===void 0||r===void 0)return null;let i=parseInt(r??``);return isNaN(i)?null:{documentId:n,backendNodeId:i}}function r(e){let t=n(e);if(t!==null)return{...t,frameId:void 0};let r=e.match(/f\.(.*)\.d\.(.*)\.e\.([0-9]*)/);if(!r)return null;let i=r[1],a=r[2],o=r[3];if(i===void 0||a===void 0||o===void 0)return null;let s=parseInt(o??``);return isNaN(s)?null:{frameId:i,documentId:a,backendNodeId:s}}})),Wt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.Realm=void 0;let t=z(),n=L(),r=V(),i=Ot();e.Realm=class e{#e;#t;#n;#r;#i;#a;realmStorage;constructor(e,t,n,r,i,a,o){this.#e=e,this.#t=t,this.#n=n,this.#r=r,this.#i=i,this.#a=a,this.realmStorage=o,this.realmStorage.addRealm(this)}cdpToBidiValue(e,t){let r=this.serializeForBiDi(e.result.deepSerializedValue,new Map);if(e.result.objectId){let i=e.result.objectId;t===`root`?(r.handle=i,this.realmStorage.knownHandlesToRealmMap.set(i,this.realmId)):this.#h(i).catch(e=>this.#r?.(n.LogType.debugError,e))}return r}isHidden(){return!1}serializeForBiDi(e,t){if(Object.hasOwn(e,`weakLocalObjectReference`)){let n=e.weakLocalObjectReference;t.has(n)||t.set(n,(0,r.uuidv4)()),e.internalId=t.get(n),delete e.weakLocalObjectReference}if(e.type===`node`&&e.value&&Object.hasOwn(e.value,`frameId`)&&delete e.value.frameId,e.type===`platformobject`)return{type:`object`};let n=e.value;if(n===void 0)return e;if([`array`,`set`,`htmlcollection`,`nodelist`].includes(e.type))for(let e in n)n[e]=this.serializeForBiDi(n[e],t);if([`object`,`map`].includes(e.type))for(let e in n)n[e]=[this.serializeForBiDi(n[e][0],t),this.serializeForBiDi(n[e][1],t)];return e}get realmId(){return this.#a}get executionContextId(){return this.#n}get origin(){return this.#i}get source(){return{realm:this.realmId}}get cdpClient(){return this.#e}get baseInfo(){return{realm:this.realmId,origin:this.origin}}async evaluate(t,n,r=`none`,i={},a=!1,o=!1){let s=await this.cdpClient.sendCommand(`Runtime.evaluate`,{contextId:this.executionContextId,expression:t,awaitPromise:n,serializationOptions:e.#f(`deep`,i),userGesture:a,includeCommandLineAPI:o});return s.exceptionDetails?await this.#d(s.exceptionDetails,0,r):{realm:this.realmId,result:this.cdpToBidiValue(s,r),type:`success`}}#o(e){if(this.associatedBrowsingContexts.length===0)this.#t.registerGlobalEvent(e);else for(let t of this.associatedBrowsingContexts)this.#t.registerEvent(e,t.id)}initialize(){this.isHidden()||this.#o({type:`event`,method:t.ChromiumBidi.Script.EventNames.RealmCreated,params:this.realmInfo})}async serializeCdpObject(t,n){let r=e.#s(t),i=await this.cdpClient.sendCommand(`Runtime.callFunctionOn`,{functionDeclaration:String(e=>e),awaitPromise:!1,arguments:[r],serializationOptions:{serialization:`deep`},executionContextId:this.executionContextId});return this.cdpToBidiValue(i,n)}static#s(e){return e.objectId===void 0?e.unserializableValue===void 0?{value:e.value}:{unserializableValue:e.unserializableValue}:{objectId:e.objectId}}async stringifyObject(e){let{result:t}=await this.cdpClient.sendCommand(`Runtime.callFunctionOn`,{functionDeclaration:String(e=>String(e)),awaitPromise:!1,arguments:[e],returnByValue:!0,executionContextId:this.executionContextId});return t.value}async#c(e){return(await Promise.all(e.map(async([e,t])=>{let n;n=typeof e==`string`?{value:e}:await this.deserializeForCdp(e);let r=await this.deserializeForCdp(t);return[n,r]}))).flat()}async#l(e){return await Promise.all(e.map(e=>this.deserializeForCdp(e)))}async#u(e,t,n){let r=e.stackTrace?.callFrames.map(e=>({url:e.url,functionName:e.functionName,lineNumber:e.lineNumber-t,columnNumber:e.columnNumber}))??[],i=e.exception;return{exception:await this.serializeCdpObject(i,n),columnNumber:e.columnNumber,lineNumber:e.lineNumber-t,stackTrace:{callFrames:r},text:await this.stringifyObject(i)||e.text}}async callFunction(n,r,i={type:`undefined`},a=[],o=`none`,s={},c=!1){let l=`(...args) => {
      function callFunction(f, args) {
        const deserializedThis = args.shift();
        const deserializedArgs = args;
        return f.apply(deserializedThis, deserializedArgs);
      }
      return callFunction((
        ${n}
      ), args);
    }`,u=[await this.deserializeForCdp(i),...await Promise.all(a.map(async e=>await this.deserializeForCdp(e)))],d;try{d=await this.cdpClient.sendCommand(`Runtime.callFunctionOn`,{functionDeclaration:l,awaitPromise:r,arguments:u,serializationOptions:e.#f(`deep`,s),executionContextId:this.executionContextId,userGesture:c})}catch(e){throw e.code===-32e3&&[`Could not find object with given id`,`Argument should belong to the same JavaScript world as target object`,`Invalid remote object id`].includes(e.message)?new t.NoSuchHandleException(`Handle was not found.`):e}return d.exceptionDetails?await this.#d(d.exceptionDetails,1,o):{type:`success`,result:this.cdpToBidiValue(d,o),realm:this.realmId}}async deserializeForCdp(e){if(`handle`in e&&e.handle)return{objectId:e.handle};if(`handle`in e||`sharedId`in e)throw new t.NoSuchHandleException(`Handle was not found.`);switch(e.type){case`undefined`:return{unserializableValue:`undefined`};case`null`:return{unserializableValue:`null`};case`string`:return{value:e.value};case`number`:return e.value===`NaN`?{unserializableValue:`NaN`}:e.value===`-0`?{unserializableValue:`-0`}:e.value===`Infinity`?{unserializableValue:`Infinity`}:e.value===`-Infinity`?{unserializableValue:`-Infinity`}:{value:e.value};case`boolean`:return{value:!!e.value};case`bigint`:return{unserializableValue:`BigInt(${JSON.stringify(e.value)})`};case`date`:return{unserializableValue:`new Date(Date.parse(${JSON.stringify(e.value)}))`};case`regexp`:return{unserializableValue:`new RegExp(${JSON.stringify(e.value.pattern)}, ${JSON.stringify(e.value.flags)})`};case`map`:{let t=await this.#c(e.value),{result:n}=await this.cdpClient.sendCommand(`Runtime.callFunctionOn`,{functionDeclaration:String((...e)=>{let t=new Map;for(let n=0;n<e.length;n+=2)t.set(e[n],e[n+1]);return t}),awaitPromise:!1,arguments:t,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:n.objectId}}case`object`:{let t=await this.#c(e.value),{result:n}=await this.cdpClient.sendCommand(`Runtime.callFunctionOn`,{functionDeclaration:String((...e)=>{let t={};for(let n=0;n<e.length;n+=2){let r=e[n];t[r]=e[n+1]}return t}),awaitPromise:!1,arguments:t,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:n.objectId}}case`array`:{let t=await this.#l(e.value),{result:n}=await this.cdpClient.sendCommand(`Runtime.callFunctionOn`,{functionDeclaration:String((...e)=>e),awaitPromise:!1,arguments:t,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:n.objectId}}case`set`:{let t=await this.#l(e.value),{result:n}=await this.cdpClient.sendCommand(`Runtime.callFunctionOn`,{functionDeclaration:String((...e)=>new Set(e)),awaitPromise:!1,arguments:t,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:n.objectId}}case`channel`:return{objectId:await new i.ChannelProxy(e.value,this.#r).init(this,this.#t)}}throw Error(`Value ${JSON.stringify(e)} is not deserializable.`)}async#d(e,t,n){return{exceptionDetails:await this.#u(e,t,n),realm:this.realmId,type:`exception`}}static#f(t,n){return{serialization:t,additionalParameters:e.#p(n),...e.#m(n)}}static#p(e){let t={};return e.maxDomDepth!==void 0&&(t.maxNodeDepth=e.maxDomDepth===null?1e3:e.maxDomDepth),e.includeShadowTree!==void 0&&(t.includeShadowTree=e.includeShadowTree),t}static#m(e){return e.maxObjectDepth===void 0||e.maxObjectDepth===null?{}:{maxDepth:e.maxObjectDepth}}async#h(e){try{await this.cdpClient.sendCommand(`Runtime.releaseObject`,{objectId:e})}catch(e){if(!(e.code===-32e3&&e.message===`Invalid remote object id`))throw e}}async disown(e){this.realmStorage.knownHandlesToRealmMap.get(e)===this.realmId&&(await this.#h(e),this.realmStorage.knownHandlesToRealmMap.delete(e))}dispose(){this.#o({type:`event`,method:t.ChromiumBidi.Script.EventNames.RealmDestroyed,params:{realm:this.realmId}})}}})),Gt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.WindowRealm=void 0;let t=z(),n=Wt(),r=Ut();e.WindowRealm=class extends n.Realm{#e;#t;sandbox;constructor(e,t,n,r,i,a,o,s,c,l){super(n,r,i,a,o,s,c),this.#e=e,this.#t=t,this.sandbox=l,this.initialize()}#n(e){return this.#t.getAllContexts().find(t=>t.navigableId===e)?.id??`UNKNOWN`}get browsingContext(){return this.#t.getContext(this.#e)}isHidden(){return this.realmStorage.hiddenSandboxes.has(this.sandbox)}get associatedBrowsingContexts(){return[this.browsingContext]}get realmType(){return`window`}get realmInfo(){return{...this.baseInfo,type:this.realmType,context:this.#e,sandbox:this.sandbox}}get source(){return{realm:this.realmId,context:this.browsingContext.id}}serializeForBiDi(e,t){let n=e.value;if(e.type===`node`&&n!==void 0){if(Object.hasOwn(n,`backendNodeId`)){let t=this.browsingContext.navigableId??`UNKNOWN`;Object.hasOwn(n,`loaderId`)&&(t=n.loaderId,delete n.loaderId),e.sharedId=(0,r.getSharedId)(this.#n(t),t,n.backendNodeId),delete n.backendNodeId}if(Object.hasOwn(n,`children`))for(let e in n.children)n.children[e]=this.serializeForBiDi(n.children[e],t);Object.hasOwn(n,`shadowRoot`)&&n.shadowRoot!==null&&(n.shadowRoot=this.serializeForBiDi(n.shadowRoot,t)),n.namespaceURI===``&&(n.namespaceURI=null)}return super.serializeForBiDi(e,t)}async deserializeForCdp(e){if(`sharedId`in e&&e.sharedId){let n=(0,r.parseSharedId)(e.sharedId);if(n===null)throw new t.NoSuchNodeException(`SharedId "${e.sharedId}" was not found.`);let{documentId:i,backendNodeId:a}=n;if(this.browsingContext.navigableId!==i)throw new t.NoSuchNodeException(`SharedId "${e.sharedId}" belongs to different document. Current document is ${this.browsingContext.navigableId}.`);try{let{object:e}=await this.cdpClient.sendCommand(`DOM.resolveNode`,{backendNodeId:a,executionContextId:this.executionContextId});return{objectId:e.objectId}}catch(n){throw n.code===-32e3&&n.message===`No node with given id found`?new t.NoSuchNodeException(`SharedId "${e.sharedId}" was not found.`):new t.UnknownErrorException(n.message,n.stack)}}return await super.deserializeForCdp(e)}async evaluate(e,t,n,r,i,a){return await this.#t.getContext(this.#e).targetUnblockedOrThrow(),await super.evaluate(e,t,n,r,i,a)}async callFunction(e,t,n,r,i,a,o){return await this.#t.getContext(this.#e).targetUnblockedOrThrow(),await super.callFunction(e,t,n,r,i,a,o)}}})),Kt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.urlMatchesAboutBlank=t;function t(e){if(e===``)return!0;try{let t=new URL(e);return t.protocol.replace(/:$/,``).toLowerCase()===`about`&&t.pathname.toLowerCase()===`blank`&&t.username===``&&t.password===``&&t.host===``}catch(e){if(e instanceof TypeError)return!1;throw e}}})),qt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.NavigationTracker=e.NavigationState=e.NavigationResult=void 0;let t=z(),n=Bt(),r=L(),i=Vt(),a=Kt(),o=V();var s=class{eventName;message;constructor(e,t){this.eventName=e,this.message=t}};e.NavigationResult=s;var c=class{navigationId=(0,o.uuidv4)();#e;#t=!1;#n=new n.Deferred;url;loaderId;#r;#i;committed=new n.Deferred;isFragmentNavigation;get finished(){return this.#n}constructor(e,t,n,r){this.#e=t,this.url=e,this.#r=n,this.#i=r}navigationInfo(){return{context:this.#e,navigation:this.navigationId,timestamp:(0,i.getTimestamp)(),url:this.url}}start(){!this.#r&&!this.#t&&!this.isFragmentNavigation&&this.#i.registerEvent({type:`event`,method:t.ChromiumBidi.BrowsingContext.EventNames.NavigationStarted,params:this.navigationInfo()},this.#e),this.#t=!0}#a(e){this.#t=!0,!this.#r&&!this.#n.isFinished&&e.eventName!==`browsingContext.load`&&this.#i.registerEvent({type:`event`,method:e.eventName,params:this.navigationInfo()},this.#e),this.#n.resolve(e)}frameNavigated(){this.committed.resolve(),this.#r||this.#i.registerEvent({type:`event`,method:t.ChromiumBidi.BrowsingContext.EventNames.NavigationCommitted,params:this.navigationInfo()},this.#e)}fragmentNavigated(){this.committed.resolve(),this.#a(new s(`browsingContext.fragmentNavigated`))}load(){this.#a(new s(`browsingContext.load`))}fail(e){this.#a(new s(this.committed.isFinished?`browsingContext.navigationAborted`:`browsingContext.navigationFailed`,e))}};e.NavigationState=c,e.NavigationTracker=class e{#e;#t;#n=new Map;#r;#i;#a;#o=!0;constructor(e,t,n,r){this.#r=t,this.#e=n,this.#t=r,this.#o=!0,this.#i=new c(e,t,(0,a.urlMatchesAboutBlank)(e),this.#e)}get currentNavigationId(){return this.#a?.isFragmentNavigation===!1?this.#a.navigationId:this.#i.navigationId}get isInitialNavigation(){return this.#o}get url(){return this.#i.url}createPendingNavigation(e,t=!1){this.#t?.(r.LogType.debug,`createCommandNavigation`),this.#o=t&&this.#o&&(0,a.urlMatchesAboutBlank)(e),this.#a?.fail(`navigation canceled by concurrent navigation`);let n=new c(e,this.#r,this.#o,this.#e);return this.#a=n,n}dispose(){this.#a?.fail(`navigation canceled by context disposal`),this.#i.fail(`navigation canceled by context disposal`)}onTargetInfoChanged(e){this.#t?.(r.LogType.debug,`onTargetInfoChanged ${e}`),this.#i.url=e}#s(e,t){return this.#n.has(t)?this.#n.get(t):this.#a!==void 0&&this.#a.loaderId===void 0?this.#a:this.createPendingNavigation(e,!0)}frameNavigated(e,t,n){if(this.#t?.(r.LogType.debug,`frameNavigated ${e}`),n!==void 0){let e=this.#n.get(t)??this.#a??this.createPendingNavigation(n,!0);e.url=n,e.start(),e.fail(`the requested url is unreachable`);return}let i=this.#s(e,t);i!==this.#i&&this.#i.fail(`navigation canceled by concurrent navigation`),i.url=e,i.loaderId=t,this.#n.set(t,i),i.start(),i.frameNavigated(),this.#i=i,this.#a===i&&(this.#a=void 0)}navigatedWithinDocument(e,t){if(this.#t?.(r.LogType.debug,`navigatedWithinDocument ${e}, ${t}`),this.#i.url=e,t!==`fragment`)return;let n=this.#a?.isFragmentNavigation===!0?this.#a:new c(e,this.#r,!1,this.#e);n.fragmentNavigated(),n===this.#a&&(this.#a=void 0)}loadPageEvent(e){this.#t?.(r.LogType.debug,`loadPageEvent`),this.#o=!1,this.#n.get(e)?.load()}failNavigation(e,t){this.#t?.(r.LogType.debug,`failCommandNavigation`),e.fail(t)}navigationCommandFinished(e,t){this.#t?.(r.LogType.debug,`finishCommandNavigation ${e.navigationId}, ${t}`),t!==void 0&&(e.loaderId=t,this.#n.set(t,e)),e.isFragmentNavigation=t===void 0}frameStartedNavigating(t,n,i){if(this.#t?.(r.LogType.debug,`frameStartedNavigating ${t}, ${n}`),this.#a&&this.#a?.loaderId!==void 0&&this.#a?.loaderId!==n&&(this.#a?.fail(`navigation canceled by concurrent navigation`),this.#a=void 0),this.#n.has(n)){let t=this.#n.get(n);t.isFragmentNavigation=e.#c(i),this.#a=t;return}let a=this.#a??this.createPendingNavigation(t,!0);this.#n.set(n,a),a.isFragmentNavigation=e.#c(i),a.url=t,a.loaderId=n,a.start()}static#c(e){return[`historySameDocument`,`sameDocument`].includes(e)}networkLoadingFailed(e,t){this.#n.get(e)?.fail(t)}}})),Jt=f((e=>{var t;Object.defineProperty(e,`__esModule`,{value:!0}),e.BrowsingContextImpl=void 0,e.serializeOrigin=p;let n=z(),r=B(),i=Bt(),a=L(),o=Vt(),s=Ht(),c=V(),l=Ut(),u=Gt(),d=qt();var f=class{static LOGGER_PREFIX=`${a.LogType.debug}:browsingContext`;#e=new Set;#t;userContext;#n=(0,c.uuidv4)();#r=new Map;#i;#a=null;#o;#s={DOMContentLoaded:new i.Deferred,load:new i.Deferred};#c;#l=new i.Deferred;#u;#d;#f;#p;#m;#h;#g;constructor(e,t,n,r,i,a,o,s,c,l,u){this.#c=r,this.#t=e,this.#a=t,this.userContext=n,this.#d=i,this.#u=a,this.#m=o,this.#h=s,this.#f=u,this.#o=l,this.#m.hiddenSandboxes.add(this.#n),this.#p=new d.NavigationTracker(c,e,i,u)}static create(e,r,i,a,o,s,c,l,u,d,f){let p=new t(e,r,i,a,o,s,c,l,u,d,f);return p.#y(),s.addContext(p),p.isTopLevelContext()||p.parent.addChild(p.id),o.registerPromiseEvent(p.targetUnblockedOrThrow().then(()=>({kind:`success`,value:{type:`event`,method:n.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,params:{...p.serializeToBidiValue(),url:u}}}),e=>({kind:`error`,error:e})),p.id,n.ChromiumBidi.BrowsingContext.EventNames.ContextCreated),p}get navigableId(){return this.#i}get navigationId(){return this.#p.currentNavigationId}dispose(e){this.#p.dispose(),this.#m.deleteRealms({browsingContextId:this.id}),this.isTopLevelContext()||this.parent.#e.delete(this.id),this.#w(),e&&this.#d.registerEvent({type:`event`,method:n.ChromiumBidi.BrowsingContext.EventNames.ContextDestroyed,params:this.serializeToBidiValue(null)},this.id),this.#_(),this.#d.clearBufferedEvents(this.id),this.#u.deleteContextById(this.id)}get id(){return this.#t}get parentId(){return this.#a}set parentId(e){if(this.#a!==null){this.#f?.(a.LogType.debugError,`Parent context already set`);return}this.#a=e,this.isTopLevelContext()||this.parent.addChild(this.id)}get parent(){return this.parentId===null?null:this.#u.getContext(this.parentId)}get directChildren(){return[...this.#e].map(e=>this.#u.getContext(e))}get allChildren(){let e=this.directChildren;return e.concat(...e.map(e=>e.allChildren))}isTopLevelContext(){return this.#a===null}get top(){let e=this,t=e.parent;for(;t;)e=t,t=e.parent;return e}addChild(e){this.#e.add(e)}#_(e=!1){this.directChildren.map(t=>t.dispose(e))}get cdpTarget(){return this.#c}updateCdpTarget(e){this.#c=e,this.#y()}get url(){return this.#p.url}async lifecycleLoaded(){await this.#s.load}async targetUnblockedOrThrow(){let e=await this.#c.unblocked;if(e.kind===`error`)throw e.error}async getOrCreateHiddenSandbox(){return await this.#v(this.#n)}async getOrCreateUserSandbox(e){let t=await this.#v(e);if(t.isHidden())throw new n.NoSuchFrameException(`Realm "${e}" not found`);return t}async#v(e){if(e===void 0||e===``)return await this.#l;let t=this.#m.findRealms({browsingContextId:this.id,sandbox:e});return t.length===0&&(await this.#c.cdpClient.sendCommand(`Page.createIsolatedWorld`,{frameId:this.id,worldName:e}),t=this.#m.findRealms({browsingContextId:this.id,sandbox:e}),(0,r.assert)(t.length!==0)),t[0]}serializeToBidiValue(e=0,t=!0){return{context:this.#t,url:this.url,userContext:this.userContext,originalOpener:this.#o??null,clientWindow:`${this.cdpTarget.windowId}`,children:e===null||e>0?this.directChildren.map(t=>t.serializeToBidiValue(e===null?e:e-1,!1)):null,...t?{parent:this.#a}:{}}}onTargetInfoChanged(e){this.#p.onTargetInfoChanged(e.targetInfo.url)}#y(){this.#c.cdpClient.on(`Network.loadingFailed`,e=>{this.#p.networkLoadingFailed(e.requestId,e.errorText)}),this.#c.cdpClient.on(`Page.fileChooserOpened`,e=>{if(this.id!==e.frameId)return;if(this.#i===void 0){this.#f?.(a.LogType.debugError,`LoaderId should be defined when file upload is shown`,e);return}let t=e.backendNodeId===void 0?void 0:{sharedId:(0,l.getSharedId)(this.id,this.#i,e.backendNodeId)};this.#d.registerEvent({type:`event`,method:n.ChromiumBidi.Input.EventNames.FileDialogOpened,params:{context:this.id,multiple:e.mode===`selectMultiple`,element:t}},this.id)}),this.#c.cdpClient.on(`Page.frameNavigated`,e=>{this.id===e.frame.id&&(this.#p.frameNavigated(e.frame.url+(e.frame.urlFragment??``),e.frame.loaderId,e.frame.unreachableUrl),this.#_(),this.#S(e.frame.loaderId))}),this.#c.cdpClient.on(`Page.frameStartedNavigating`,e=>{this.id===e.frameId&&this.#p.frameStartedNavigating(e.url,e.loaderId,e.navigationType)}),this.#c.cdpClient.on(`Page.navigatedWithinDocument`,e=>{if(this.id===e.frameId&&(this.#p.navigatedWithinDocument(e.url,e.navigationType),e.navigationType===`historyApi`)){this.#d.registerEvent({type:`event`,method:`browsingContext.historyUpdated`,params:{context:this.id,timestamp:(0,o.getTimestamp)(),url:this.#p.url}},this.id);return}}),this.#c.cdpClient.on(`Page.lifecycleEvent`,e=>{if(this.id===e.frameId){if(e.name===`init`){this.#S(e.loaderId);return}if(e.name===`commit`){this.#i=e.loaderId;return}if(this.#i||=e.loaderId,e.loaderId===this.#i)switch(e.name){case`DOMContentLoaded`:this.#p.isInitialNavigation||this.#d.registerEvent({type:`event`,method:n.ChromiumBidi.BrowsingContext.EventNames.DomContentLoaded,params:{context:this.id,navigation:this.#p.currentNavigationId,timestamp:(0,o.getTimestamp)(),url:this.#p.url}},this.id),this.#s.DOMContentLoaded.resolve();break;case`load`:this.#p.isInitialNavigation||this.#d.registerEvent({type:`event`,method:n.ChromiumBidi.BrowsingContext.EventNames.Load,params:{context:this.id,navigation:this.#p.currentNavigationId,timestamp:(0,o.getTimestamp)(),url:this.#p.url}},this.id),this.#p.loadPageEvent(e.loaderId),this.#s.load.resolve();break}}}),this.#c.cdpClient.on(`Runtime.executionContextCreated`,e=>{let{auxData:t,name:n,uniqueId:r,id:i}=e.context;if(!t||t.frameId!==this.id)return;let o,s;switch(t.type){case`isolated`:s=n,this.#l.isFinished||this.#f?.(a.LogType.debugError,`Unexpectedly, isolated realm created before the default one`),o=this.#l.isFinished?this.#l.result.origin:``;break;case`default`:o=p(e.context.origin);break;default:return}let c=new u.WindowRealm(this.id,this.#u,this.#c.cdpClient,this.#d,i,this.#f,o,r,this.#m,s);t.isDefault&&(this.#l.resolve(c),Promise.all(this.#c.getChannels().map(e=>e.startListenerFromWindow(c,this.#d))))}),this.#c.cdpClient.on(`Runtime.executionContextDestroyed`,e=>{this.#l.isFinished&&this.#l.result.executionContextId===e.executionContextId&&(this.#l=new i.Deferred),this.#m.deleteRealms({cdpSessionId:this.#c.cdpSessionId,executionContextId:e.executionContextId})}),this.#c.cdpClient.on(`Runtime.executionContextsCleared`,()=>{this.#l.isFinished||this.#l.reject(new n.UnknownErrorException(`execution contexts cleared`)),this.#l=new i.Deferred,this.#m.deleteRealms({cdpSessionId:this.#c.cdpSessionId})}),this.#c.cdpClient.on(`Page.javascriptDialogClosed`,e=>{if(e.frameId&&this.id!==e.frameId||!e.frameId&&this.#a&&this.#c.cdpClient!==this.#u.getContext(this.#a)?.cdpTarget.cdpClient)return;let t=e.result;this.#g===void 0&&this.#f?.(a.LogType.debugError,`Unexpectedly no opening prompt event before closing one`),this.#d.registerEvent({type:`event`,method:n.ChromiumBidi.BrowsingContext.EventNames.UserPromptClosed,params:{context:this.id,accepted:t,type:this.#g??`UNKNOWN`,userText:t&&e.userInput?e.userInput:void 0}},this.id),this.#g=void 0}),this.#c.cdpClient.on(`Page.javascriptDialogOpening`,e=>{if(e.frameId&&this.id!==e.frameId||!e.frameId&&this.#a&&this.#c.cdpClient!==this.#u.getContext(this.#a)?.cdpTarget.cdpClient)return;let r=t.#b(e.type);this.#g=r;let i=this.#x(r);switch(this.#d.registerEvent({type:`event`,method:n.ChromiumBidi.BrowsingContext.EventNames.UserPromptOpened,params:{context:this.id,handler:i,type:r,message:e.message,...e.type===`prompt`?{defaultValue:e.defaultPrompt}:{}}},this.id),i){case`accept`:this.handleUserPrompt(!0);break;case`dismiss`:this.handleUserPrompt(!1);break;case`ignore`:break}}),this.#c.browserCdpClient.on(`Browser.downloadWillBegin`,e=>{this.id===e.frameId&&(this.#r.set(e.guid,e.url),this.#d.registerEvent({type:`event`,method:n.ChromiumBidi.BrowsingContext.EventNames.DownloadWillBegin,params:{context:this.id,suggestedFilename:e.suggestedFilename,navigation:e.guid,timestamp:(0,o.getTimestamp)(),url:e.url}},this.id))}),this.#c.browserCdpClient.on(`Browser.downloadProgress`,e=>{if(!this.#r.has(e.guid)||e.state===`inProgress`)return;let t=this.#r.get(e.guid);switch(e.state){case`canceled`:this.#d.registerEvent({type:`event`,method:n.ChromiumBidi.BrowsingContext.EventNames.DownloadEnd,params:{status:`canceled`,context:this.id,navigation:e.guid,timestamp:(0,o.getTimestamp)(),url:t}},this.id);break;case`completed`:this.#d.registerEvent({type:`event`,method:n.ChromiumBidi.BrowsingContext.EventNames.DownloadEnd,params:{filepath:e.filePath??null,status:`complete`,context:this.id,navigation:e.guid,timestamp:(0,o.getTimestamp)(),url:t}},this.id);break;default:throw new n.UnknownErrorException(`Unknown download state: ${e.state}`)}})}static#b(e){switch(e){case`alert`:return`alert`;case`beforeunload`:return`beforeunload`;case`confirm`:return`confirm`;case`prompt`:return`prompt`}}#x(e){let t=`dismiss`,n=this.#h.getActiveConfig(this.top.id,this.userContext);switch(e){case`alert`:return n.userPromptHandler?.alert??n.userPromptHandler?.default??t;case`beforeunload`:return n.userPromptHandler?.beforeUnload??n.userPromptHandler?.default??`accept`;case`confirm`:return n.userPromptHandler?.confirm??n.userPromptHandler?.default??t;case`prompt`:return n.userPromptHandler?.prompt??n.userPromptHandler?.default??t}}#S(e){e===void 0||this.#i===e||(this.#C(),this.#i=e,this.#_(!0))}#C(){this.#s.DOMContentLoaded.isFinished?this.#s.DOMContentLoaded=new i.Deferred:this.#f?.(t.LOGGER_PREFIX,`Document changed (DOMContentLoaded)`),this.#s.load.isFinished?this.#s.load=new i.Deferred:this.#f?.(t.LOGGER_PREFIX,`Document changed (load)`)}#w(){this.#s.DOMContentLoaded.isFinished||this.#s.DOMContentLoaded.reject(new n.UnknownErrorException(`navigation canceled`)),this.#s.load.isFinished||this.#s.load.reject(new n.UnknownErrorException(`navigation canceled`))}async navigate(e,t){try{new URL(e)}catch{throw new n.InvalidArgumentException(`Invalid URL: ${e}`)}let r=this.#p.createPendingNavigation(e),i=(async()=>{let t=await this.#c.cdpClient.sendCommand(`Page.navigate`,{url:e,frameId:this.id});if(t.errorText)throw this.#p.failNavigation(r,t.errorText),new n.UnknownErrorException(t.errorText);this.#p.navigationCommandFinished(r,t.loaderId),this.#S(t.loaderId)})(),a=await Promise.race([this.#T(t,i,r),r.finished]);if(a instanceof d.NavigationResult&&(a.eventName===`browsingContext.navigationAborted`||a.eventName===`browsingContext.navigationFailed`))throw new n.UnknownErrorException(a.message??`unknown exception`);return{navigation:r.navigationId,url:r.url}}async#T(e,t,r){if(await Promise.all([r.committed,t]),e!==`none`){if(r.isFragmentNavigation===!0){await r.finished;return}if(e===`interactive`){await this.#s.DOMContentLoaded;return}if(e===`complete`){await this.#s.load;return}throw new n.InvalidArgumentException(`Wait condition ${e} is not supported`)}}async reload(e,t){await this.targetUnblockedOrThrow(),this.#C();let r=this.#p.createPendingNavigation(this.#p.url),i=this.#c.cdpClient.sendCommand(`Page.reload`,{ignoreCache:e}),a=await Promise.race([this.#T(t,i,r),r.finished]);if(a instanceof d.NavigationResult&&(a.eventName===`browsingContext.navigationAborted`||a.eventName===`browsingContext.navigationFailed`))throw new n.UnknownErrorException(a.message??`unknown exception`);return{navigation:r.navigationId,url:r.url}}async setViewport(e,t){await this.cdpTarget.setViewport(e,t)}async handleUserPrompt(e,t){await this.top.#c.cdpClient.sendCommand(`Page.handleJavaScriptDialog`,{accept:e??!0,promptText:t})}async activate(){await this.#c.cdpClient.sendCommand(`Page.bringToFront`)}async captureScreenshot(e){if(!this.isTopLevelContext())throw new n.UnsupportedOperationException(`Non-top-level 'context' (${e.context}) is currently not supported`);let t=m(e),i=!1,a;switch(e.origin??=`viewport`,e.origin){case`document`:a=String(()=>{let e=document.documentElement;return{x:0,y:0,width:e.scrollWidth,height:e.scrollHeight}}),i=!0;break;case`viewport`:a=String(()=>{let e=window.visualViewport;return{x:e.pageLeft,y:e.pageTop,width:e.width,height:e.height}});break}let o=await(await this.getOrCreateHiddenSandbox()).callFunction(a,!1);(0,r.assert)(o.type===`success`);let s=h(o.result);(0,r.assert)(s);let c=s;if(e.clip){let t=e.clip;e.origin===`viewport`&&t.type===`box`&&(t.x+=s.x,t.y+=s.y),c=_(await this.#E(t),s)}if(c.width===0||c.height===0)throw new n.UnableToCaptureScreenException(`Unable to capture screenshot with zero dimensions: width=${c.width}, height=${c.height}`);return await this.#c.cdpClient.sendCommand(`Page.captureScreenshot`,{clip:{...c,scale:1},...t,captureBeyondViewport:i})}async print(e){if(!this.isTopLevelContext())throw new n.UnsupportedOperationException(`Printing of non-top level contexts is not supported`);let t={};if(e.background!==void 0&&(t.printBackground=e.background),e.margin?.bottom!==void 0&&(t.marginBottom=(0,s.inchesFromCm)(e.margin.bottom)),e.margin?.left!==void 0&&(t.marginLeft=(0,s.inchesFromCm)(e.margin.left)),e.margin?.right!==void 0&&(t.marginRight=(0,s.inchesFromCm)(e.margin.right)),e.margin?.top!==void 0&&(t.marginTop=(0,s.inchesFromCm)(e.margin.top)),e.orientation!==void 0&&(t.landscape=e.orientation===`landscape`),e.page?.height!==void 0&&(t.paperHeight=(0,s.inchesFromCm)(e.page.height)),e.page?.width!==void 0&&(t.paperWidth=(0,s.inchesFromCm)(e.page.width)),e.pageRanges!==void 0){for(let t of e.pageRanges){if(typeof t==`number`)continue;let e=t.split(`-`);if(e.length<1||e.length>2)throw new n.InvalidArgumentException(`Invalid page range: ${t} is not a valid integer range.`);if(e.length===1){v(e[0]??``);continue}let r,i,[a=``,o=``]=e;if(r=a===``?1:v(a),i=o===``?2**53-1:v(o),r>i)throw new n.InvalidArgumentException(`Invalid page range: ${a} > ${o}`)}t.pageRanges=e.pageRanges.join(`,`)}e.scale!==void 0&&(t.scale=e.scale),e.shrinkToFit!==void 0&&(t.preferCSSPageSize=!e.shrinkToFit);try{return{data:(await this.#c.cdpClient.sendCommand(`Page.printToPDF`,t)).data}}catch(e){throw e.message===`invalid print parameters: content area is empty`?new n.UnsupportedOperationException(e.message):e}}async#E(e){switch(e.type){case`box`:return{x:e.x,y:e.y,width:e.width,height:e.height};case`element`:{let t=await this.getOrCreateHiddenSandbox(),i=await t.callFunction(String(e=>e instanceof Element),!1,{type:`undefined`},[e.element]);if(i.type===`exception`)throw new n.NoSuchElementException(`Element '${e.element.sharedId}' was not found`);if((0,r.assert)(i.result.type===`boolean`),!i.result.value)throw new n.NoSuchElementException(`Node '${e.element.sharedId}' is not an Element`);{let i=await t.callFunction(String(e=>{let t=e.getBoundingClientRect();return{x:t.x,y:t.y,height:t.height,width:t.width}}),!1,{type:`undefined`},[e.element]);(0,r.assert)(i.type===`success`);let a=h(i.result);if(!a)throw new n.UnableToCaptureScreenException(`Could not get bounding box for Element '${e.element.sharedId}'`);return a}}}}async close(){await this.#c.cdpClient.sendCommand(`Page.close`)}async traverseHistory(e){if(e===0)return;let t=await this.#c.cdpClient.sendCommand(`Page.getNavigationHistory`),r=t.entries[t.currentIndex+e];if(!r)throw new n.NoSuchHistoryEntryException(`No history entry at delta ${e}`);await this.#c.cdpClient.sendCommand(`Page.navigateToHistoryEntry`,{entryId:r.id})}async toggleModulesIfNeeded(){await Promise.all([this.#c.toggleNetworkIfNeeded(),this.#c.toggleDeviceAccessIfNeeded(),this.#c.togglePreloadIfNeeded()])}async locateNodes(e){return await this.#O(await this.#l,e.locator,e.startNodes??[],e.maxNodeCount,e.serializationOptions)}async#D(e,t,r,i){switch(t.type){case`context`:throw Error(`Unreachable`);case`css`:return{functionDeclaration:String((e,t,...n)=>{let r=t=>{if(!(t instanceof HTMLElement||t instanceof Document||t instanceof DocumentFragment||t instanceof SVGElement))throw Error(`startNodes in css selector should be HTMLElement, SVGElement or Document or DocumentFragment`);return[...t.querySelectorAll(e)]};n=n.length>0?n:[document];let i=n.map(e=>r(e)).flat(1);return t===0?i:i.slice(0,t)}),argumentsLocalValues:[{type:`string`,value:t.value},{type:`number`,value:r??0},...i]};case`xpath`:return{functionDeclaration:String((e,t,...n)=>{let r=new XPathEvaluator().createExpression(e),i=e=>{let t=r.evaluate(e,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE),n=[];for(let e=0;e<t.snapshotLength;e++)n.push(t.snapshotItem(e));return n};n=n.length>0?n:[document];let a=n.map(e=>i(e)).flat(1);return t===0?a:a.slice(0,t)}),argumentsLocalValues:[{type:`string`,value:t.value},{type:`number`,value:r??0},...i]};case`innerText`:if(t.value===``)throw new n.InvalidSelectorException(`innerText locator cannot be empty`);return{functionDeclaration:String((e,t,n,r,i,...a)=>{let o=n?e.toUpperCase():e,s=(e,r)=>{let i=[];if(e instanceof DocumentFragment||e instanceof Document)return[...e.children].forEach(e=>i.push(...s(e,r))),i;if(!(e instanceof HTMLElement))return[];let a=e,c=n?a.innerText?.toUpperCase():a.innerText;if(!c.includes(o))return[];let l=[];for(let e of a.children)e instanceof HTMLElement&&l.push(e);if(l.length===0)t&&c===o?i.push(a):t||i.push(a);else{let e=r<=0?[]:l.map(e=>s(e,r-1)).flat(1);e.length===0?(!t||c===o)&&i.push(a):i.push(...e)}return i};a=a.length>0?a:[document];let c=a.map(e=>s(e,i)).flat(1);return r===0?c:c.slice(0,r)}),argumentsLocalValues:[{type:`string`,value:t.value},{type:`boolean`,value:t.matchType!==`partial`},{type:`boolean`,value:t.ignoreCase===!0},{type:`number`,value:r??0},{type:`number`,value:t.maxDepth??1e3},...i]};case`accessibility`:{if(!t.value.name&&!t.value.role)throw new n.InvalidSelectorException(`Either name or role has to be specified`);await Promise.all([this.#c.cdpClient.sendCommand(`Accessibility.enable`),this.#c.cdpClient.sendCommand(`Accessibility.getRootAXNode`)]);let a=await e.evaluate(`({getAccessibleName, getAccessibleRole})`,!1,`root`,void 0,!1,!0);if(a.type!==`success`||a.result.type!==`object`)throw Error(`Could not get bindings`);return{functionDeclaration:String((e,t,n,r,...i)=>{let a=[],o=!1;function s(e,t){if(!o)for(let i of e){let e=!0;if(t.role){let r=n.getAccessibleRole(i);t.role!==r&&(e=!1)}if(t.name){let r=n.getAccessibleName(i);t.name!==r&&(e=!1)}if(e){if(r!==0&&a.length===r){o=!0;break}a.push(i)}let c=[];for(let e of i.children)e instanceof HTMLElement&&c.push(e);s(c,t)}}return i=i.length>0?i:Array.from(document.documentElement.children).filter(e=>e instanceof HTMLElement),s(i,{role:t,name:e}),a}),argumentsLocalValues:[{type:`string`,value:t.value.name||``},{type:`string`,value:t.value.role||``},{handle:a.result.handle},{type:`number`,value:r??0},...i]}}}}async#O(e,r,i,a,o){if(r.type===`context`){if(i.length!==0)throw new n.InvalidArgumentException(`Start nodes are not supported`);let t=r.value.context;if(!t)throw new n.InvalidSelectorException(`Invalid context`);let a=this.#u.getContext(t).parent;if(!a)throw new n.InvalidArgumentException(`This context has no container`);try{let{backendNodeId:n}=await a.#c.cdpClient.sendCommand(`DOM.getFrameOwner`,{frameId:t}),{object:r}=await a.#c.cdpClient.sendCommand(`DOM.resolveNode`,{backendNodeId:n}),i=await e.callFunction(`function () { return this; }`,!1,{handle:r.objectId},[],`none`,o);if(i.type===`exception`)throw Error(`Unknown exception`);return{nodes:[i.result]}}catch{throw new n.InvalidArgumentException(`Context does not exist`)}}let s=await this.#D(e,r,a,i);o={...o,maxObjectDepth:1};let c=await e.callFunction(s.functionDeclaration,!1,{type:`undefined`},s.argumentsLocalValues,`none`,o);if(c.type!==`success`)throw this.#f?.(t.LOGGER_PREFIX,`Failed locateNodesByLocator`,c),c.exceptionDetails.text?.endsWith(`is not a valid selector.`)||c.exceptionDetails.text?.endsWith(`is not a valid XPath expression.`)?new n.InvalidSelectorException(`Not valid selector ${typeof r.value==`string`?r.value:JSON.stringify(r.value)}`):c.exceptionDetails.text===`Error: startNodes in css selector should be HTMLElement, SVGElement or Document or DocumentFragment`?new n.InvalidArgumentException(`startNodes in css selector should be HTMLElement, SVGElement or Document or DocumentFragment`):new n.UnknownErrorException(`Unexpected error in selector script: ${c.exceptionDetails.text}`);if(c.result.type!==`array`)throw new n.UnknownErrorException(`Unexpected selector script result type: ${c.result.type}`);return{nodes:c.result.value.map(e=>{if(e.type!==`node`)throw new n.UnknownErrorException(`Unexpected selector script result element: ${e.type}`);return e})}}#k(){let e=new Set;return e.add(this.cdpTarget),this.allChildren.forEach(t=>e.add(t.cdpTarget)),Array.from(e)}async setTimezoneOverride(e){await Promise.all(this.#k().map(async t=>await t.setTimezoneOverride(e)))}async setLocaleOverride(e){await Promise.all(this.#k().map(async t=>await t.setLocaleOverride(e)))}async setGeolocationOverride(e){await Promise.all(this.#k().map(async t=>await t.setGeolocationOverride(e)))}async setScreenOrientationOverride(e){await this.#c.setScreenOrientationOverride(e)}async setScriptingEnabled(e){await Promise.all(this.#k().map(async t=>await t.setScriptingEnabled(e)))}async setUserAgentOverride(e){await Promise.all(this.#k().map(async t=>await t.setUserAgent(e)))}async setEmulatedNetworkConditions(e){await Promise.all(this.#k().map(async t=>await t.setEmulatedNetworkConditions(e)))}async setExtraHeaders(e){await Promise.all(this.#k().map(async t=>await t.setExtraHeaders(e)))}};e.BrowsingContextImpl=f,t=f;function p(e){return[`://`,``].includes(e)&&(e=`null`),e}function m(e){let{quality:t,type:r}=e.format??{type:`image/png`};switch(r){case`image/png`:return{format:`png`};case`image/jpeg`:return{format:`jpeg`,...t===void 0?{}:{quality:Math.round(t*100)}};case`image/webp`:return{format:`webp`,...t===void 0?{}:{quality:Math.round(t*100)}}}throw new n.InvalidArgumentException(`Image format '${r}' is not a supported format`)}function h(e){if(e.type!==`object`||e.value===void 0)return;let t=e.value.find(([e])=>e===`x`)?.[1],n=e.value.find(([e])=>e===`y`)?.[1],r=e.value.find(([e])=>e===`height`)?.[1],i=e.value.find(([e])=>e===`width`)?.[1];if(!(t?.type!==`number`||n?.type!==`number`||r?.type!==`number`||i?.type!==`number`))return{x:t.value,y:n.value,width:i.value,height:r.value}}function g(e){return{...e.width<0?{x:e.x+e.width,width:-e.width}:{x:e.x,width:e.width},...e.height<0?{y:e.y+e.height,height:-e.height}:{y:e.y,height:e.height}}}function _(e,t){e=g(e),t=g(t);let n=Math.max(e.x,t.x),r=Math.max(e.y,t.y);return{x:n,y:r,width:Math.max(Math.min(e.x+e.width,t.x+t.width)-n,0),height:Math.max(Math.min(e.y+e.height,t.y+t.height)-r,0)}}function v(e){if(e=e.trim(),!/^[0-9]+$/.test(e))throw new n.InvalidArgumentException(`Invalid integer: ${e}`);return parseInt(e)}})),Yt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.WorkerRealm=void 0;let t=Wt();e.WorkerRealm=class extends t.Realm{#e;#t;constructor(e,t,n,r,i,a,o,s,c){super(e,t,n,r,i,o,s),this.#t=a,this.#e=c,this.initialize()}get associatedBrowsingContexts(){return this.#t.flatMap(e=>e.associatedBrowsingContexts)}get realmType(){return this.#e}get source(){return{realm:this.realmId,context:this.associatedBrowsingContexts[0]?.id}}get realmInfo(){let e=this.#t.map(e=>e.realmId),{realmType:t}=this;switch(t){case`dedicated-worker`:{let n=e[0];if(n===void 0||e.length!==1)throw Error(`Dedicated worker must have exactly one owner`);return{...this.baseInfo,type:t,owners:[n]}}case`service-worker`:case`shared-worker`:return{...this.baseInfo,type:t}}}}})),Xt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.logMessageFormatter=i,e.getRemoteValuesText=s;let t=B(),n=[`%s`,`%d`,`%i`,`%f`,`%o`,`%O`,`%c`];function r(e){return n.some(t=>e.includes(t))}function i(e){let i=``,c=e[0].value.toString(),l=e.slice(1,void 0),u=c.split(new RegExp(n.map(e=>`(${e})`).join(`|`),`g`));for(let n of u)if(!(n===void 0||n===``))if(r(n)){let r=l.shift();(0,t.assert)(r,`Less value is provided: "${s(e,!1)}"`),n===`%s`?i+=o(r):n===`%d`||n===`%i`?r.type===`bigint`||r.type===`number`||r.type===`string`?i+=parseInt(r.value.toString(),10):i+=`NaN`:n===`%f`?r.type===`bigint`||r.type===`number`||r.type===`string`?i+=parseFloat(r.value.toString()):i+=`NaN`:i+=a(r)}else i+=n;if(l.length>0)throw Error(`More value is provided: "${s(e,!1)}"`);return i}function a(e){if(e.type!==`array`&&e.type!==`bigint`&&e.type!==`date`&&e.type!==`number`&&e.type!==`object`&&e.type!==`string`)return o(e);if(e.type===`bigint`)return`${e.value.toString()}n`;if(e.type===`number`)return e.value.toString();if([`date`,`string`].includes(e.type))return JSON.stringify(e.value);if(e.type===`object`)return`{${e.value.map(e=>`${JSON.stringify(e[0])}:${a(e[1])}`).join(`,`)}}`;if(e.type===`array`)return`[${e.value?.map(e=>a(e)).join(`,`)??``}]`;throw Error(`Invalid value type: ${e}`)}function o(e){if(!Object.hasOwn(e,`value`))return e.type;switch(e.type){case`string`:case`number`:case`boolean`:case`bigint`:return String(e.value);case`regexp`:return`/${e.value.pattern}/${e.value.flags??``}`;case`date`:return new Date(e.value).toString();case`object`:return`Object(${e.value?.length??``})`;case`array`:return`Array(${e.value?.length??``})`;case`map`:return`Map(${e.value?.length})`;case`set`:return`Set(${e.value?.length})`;default:return e.type}}function s(e,t){let n=e[0];return n?n.type===`string`&&r(n.value.toString())&&t?i(e):e.map(e=>o(e)).join(` `):``}})),Zt=f((e=>{var t;Object.defineProperty(e,`__esModule`,{value:!0}),e.LogManager=void 0;let n=z(),r=L(),i=Xt();function a(e){let t=e?.callFrames.map(e=>({columnNumber:e.columnNumber,functionName:e.functionName,lineNumber:e.lineNumber,url:e.url}));return t?{callFrames:t}:void 0}function o(e){return[`error`,`assert`].includes(e)?`error`:[`debug`,`trace`].includes(e)?`debug`:[`warn`,`warning`].includes(e)?`warn`:`info`}function s(e){switch(e){case`warning`:return`warn`;case`startGroup`:return`group`;case`startGroupCollapsed`:return`groupCollapsed`;case`endGroup`:return`groupEnd`}return e}var c=class{#e;#t;#n;#r;constructor(e,t,n,r){this.#n=e,this.#t=t,this.#e=n,this.#r=r}static create(e,n,r,i){let a=new t(e,n,r,i);return a.#a(),a}async#i(e,t){switch(e.type){case`undefined`:return{type:`undefined`};case`boolean`:return{type:`boolean`,value:e.value};case`string`:return{type:`string`,value:e.value};case`number`:return{type:`number`,value:e.unserializableValue??e.value};case`bigint`:if(e.unserializableValue!==void 0&&e.unserializableValue[e.unserializableValue.length-1]===`n`)return{type:e.type,value:e.unserializableValue.slice(0,-1)};break;case`object`:if(e.subtype===`null`)return{type:`null`};break;default:break}return await t.serializeCdpObject(e,`none`)}#a(){this.#n.cdpClient.on(`Runtime.consoleAPICalled`,e=>{let t=this.#t.findRealm({cdpSessionId:this.#n.cdpSessionId,executionContextId:e.executionContextId});if(t===void 0){this.#r?.(r.LogType.cdp,e);return}let c=Promise.all(e.args.map(e=>this.#i(e,t)));for(let r of t.associatedBrowsingContexts)this.#e.registerPromiseEvent(c.then(r=>({kind:`success`,value:{type:`event`,method:n.ChromiumBidi.Log.EventNames.LogEntryAdded,params:{level:o(e.type),source:t.source,text:(0,i.getRemoteValuesText)(r,!0),timestamp:Math.round(e.timestamp),stackTrace:a(e.stackTrace),type:`console`,method:s(e.type),args:r}}}),e=>({kind:`error`,error:e})),r.id,n.ChromiumBidi.Log.EventNames.LogEntryAdded)}),this.#n.cdpClient.on(`Runtime.exceptionThrown`,e=>{let i=this.#t.findRealm({cdpSessionId:this.#n.cdpSessionId,executionContextId:e.exceptionDetails.executionContextId});if(i===void 0){this.#r?.(r.LogType.cdp,e);return}for(let r of i.associatedBrowsingContexts)this.#e.registerPromiseEvent(t.#o(e,i).then(t=>({kind:`success`,value:{type:`event`,method:n.ChromiumBidi.Log.EventNames.LogEntryAdded,params:{level:`error`,source:i.source,text:t,timestamp:Math.round(e.timestamp),stackTrace:a(e.exceptionDetails.stackTrace),type:`javascript`}}}),e=>({kind:`error`,error:e})),r.id,n.ChromiumBidi.Log.EventNames.LogEntryAdded)})}static async#o(e,t){return e.exceptionDetails.exception?t===void 0?JSON.stringify(e.exceptionDetails.exception):await t.stringifyObject(e.exceptionDetails.exception):e.exceptionDetails.text}};e.LogManager=c,t=c})),Qt=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.CollectorsStorage=void 0;let t=R(),n=L(),r=V();e.CollectorsStorage=class{#e=new Map;#t=new Map;#n=new Map;#r;#i;constructor(e,t){this.#r=e,this.#i=t}addDataCollector(e){if(e.maxEncodedDataSize<1||e.maxEncodedDataSize>this.#r)throw new t.InvalidArgumentException(`Max encoded data size should be between 1 and ${this.#r}`);let n=(0,r.uuidv4)();return this.#e.set(n,e),n}isCollected(e,n,r){if(r!==void 0&&!this.#e.has(r))throw new t.NoSuchNetworkCollectorException(`Unknown collector ${r}`);if(n===void 0)return this.isCollected(e,`response`,r)||this.isCollected(e,`request`,r);let i=this.#a(n).get(e);return i===void 0||i.size===0?!1:r===void 0?!0:!!i.has(r)}#a(e){switch(e){case`response`:return this.#t;case`request`:return this.#n;default:throw new t.UnsupportedOperationException(`Unsupported data type ${e}`)}}disownData(e,t,n){let r=this.#a(t);n!==void 0&&r.get(e)?.delete(n),(n===void 0||r.get(e)?.size===0)&&r.delete(e)}#o(e,r,i,a,o){let s=this.#e.get(e);if(s===void 0)throw new t.NoSuchNetworkCollectorException(`Unknown collector ${e}`);return s.userContexts&&!s.userContexts.includes(o)||s.contexts&&!s.contexts.includes(a)||!s.dataTypes.includes(i)?!1:i===`request`&&r.bodySize>s.maxEncodedDataSize?(this.#i?.(n.LogType.debug,`Request's ${r.id} body size is too big for the collector ${e}`),!1):i===`response`&&r.bytesReceived>s.maxEncodedDataSize?(this.#i?.(n.LogType.debug,`Request's ${r.id} response is too big for the collector ${e}`),!1):(this.#i?.(n.LogType.debug,`Collector ${e} collected ${i} of ${r.id}`),!0)}collectIfNeeded(e,t,n,r){let i=[...this.#e.keys()].filter(i=>this.#o(i,e,t,n,r));i.length>0&&this.#a(t).set(e.id,new Set(i))}removeDataCollector(e){if(!this.#e.has(e))throw new t.NoSuchNetworkCollectorException(`Collector ${e} does not exist`);this.#e.delete(e);let n=[];for(let[t,r]of this.#t)r.has(e)&&(r.delete(e),r.size===0&&(this.#t.delete(t),n.push(t)));for(let[t,r]of this.#n)r.has(e)&&(r.delete(e),r.size===0&&(this.#n.delete(t),n.push(t)));return n}}})),$t=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.DefaultMap=void 0,e.DefaultMap=class extends Map{#e;constructor(e,t){super(t),this.#e=e}get(e){return this.has(e)||this.set(e,this.#e(e)),super.get(e)}}})),en=f((e=>{var t;Object.defineProperty(e,`__esModule`,{value:!0}),e.NetworkRequest=void 0;let n=z(),r=B(),i=$t(),a=Bt(),o=L(),s=Tt(),c=/(?<=realm=").*(?=")/;var l=class{static unknownParameter=`UNKNOWN`;#e;#t;#n;#r=!1;#i;#a={};#o;#s;#c={};#l;#u;#d;#f;#p={[n.ChromiumBidi.Network.EventNames.AuthRequired]:!1,[n.ChromiumBidi.Network.EventNames.BeforeRequestSent]:!1,[n.ChromiumBidi.Network.EventNames.FetchError]:!1,[n.ChromiumBidi.Network.EventNames.ResponseCompleted]:!1,[n.ChromiumBidi.Network.EventNames.ResponseStarted]:!1};waitNextPhase=new a.Deferred;constructor(e,t,n,r,i=0,a){this.#e=e,this.#l=t,this.#u=n,this.#d=r,this.#i=i,this.#f=a}get id(){return this.#e}get fetchId(){return this.#t}get interceptPhase(){return this.#n}get url(){let e=this.#a.info?.request.urlFragment??this.#a.paused?.request.urlFragment??``;return`${this.#c.paused?.request.url??this.#o?.url??this.#c.info?.url??this.#a.auth?.request.url??this.#a.info?.request.url??this.#a.paused?.request.url??t.unknownParameter}${e}`}get redirectCount(){return this.#i}get cdpTarget(){return this.#d}updateCdpTarget(e){e!==this.#d&&(this.#f?.(o.LogType.debugInfo,`Request ${this.id} was moved from ${this.#d.id} to ${e.id}`),this.#d=e)}get cdpClient(){return this.#d.cdpClient}isRedirecting(){return!!this.#a.info}#m(){return this.url.startsWith(`data:`)}#h(){return this.#m()||this.#r}get#g(){return this.#o?.method??this.#a.info?.request.method??this.#a.paused?.request.method??this.#a.auth?.request.method??this.#c.paused?.request.method}get#_(){return!this.#a.info||!this.#a.info.loaderId||this.#a.info.loaderId!==this.#a.info.requestId?null:this.#u.getNavigationId(this.#b??void 0)}get#v(){let e=[];return this.#a.extraInfo&&(e=this.#a.extraInfo.associatedCookies.filter(({blockedReasons:e})=>!Array.isArray(e)||e.length===0).map(({cookie:e})=>(0,s.cdpToBiDiCookie)(e))),e}#y(e){if(e!==void 0&&e[`Content-Length`]!==void 0){let t=Number.parseInt(e[`Content-Length`]);if(Number.isInteger(t))return t;this.#f?.(o.LogType.debugError,`Unexpected non-integer 'Content-Length' header`)}}get bodySize(){return typeof this.#o?.bodySize==`number`?this.#o.bodySize:this.#a.info?.request.postDataEntries===void 0?this.#y(this.#a.info?.request.headers)??this.#y(this.#a.extraInfo?.headers)??0:(0,s.bidiBodySizeFromCdpPostDataEntries)(this.#a.info?.request.postDataEntries)}get#b(){let e=this.#c.paused?.frameId??this.#a.info?.frameId??this.#a.paused?.frameId??this.#a.auth?.frameId;if(e!==void 0)return e;if(this.#a?.info?.initiator.type===`preflight`&&this.#a?.info?.initiator.requestId!==void 0){let e=this.#u.getRequestById(this.#a?.info?.initiator.requestId);if(e!==void 0)return e.#a.info?.frameId??null}return null}get#x(){return this.#s?.statusCode??this.#c.paused?.responseStatusCode??this.#c.extraInfo?.statusCode??this.#c.info?.status}get#S(){let e=[];if(this.#o?.headers){let t=new i.DefaultMap(()=>[]);for(let e of this.#o.headers)t.get(e.name).push(e.value.value);for(let[n,r]of t.entries())e.push({name:n,value:{type:`string`,value:r.join(`
`).trimEnd()}})}else e=[...(0,s.bidiNetworkHeadersFromCdpNetworkHeaders)(this.#a.info?.request.headers),...(0,s.bidiNetworkHeadersFromCdpNetworkHeaders)(this.#a.extraInfo?.headers)];return e}get#C(){if(!this.#c.info||!(this.#x===401||this.#x===407))return;let e=this.#x===401?`WWW-Authenticate`:`Proxy-Authenticate`,t=[];for(let[n,r]of Object.entries(this.#c.info.headers))n.localeCompare(e,void 0,{sensitivity:`base`})===0&&t.push({scheme:r.split(` `).at(0)??``,realm:r.match(c)?.at(0)??``});return t}get#w(){let e=(0,s.getTiming)((0,s.getTiming)(this.#c.info?.timing?.requestTime)-(0,s.getTiming)(this.#a.info?.timestamp));return{timeOrigin:Math.round((0,s.getTiming)(this.#a.info?.wallTime)*1e3),requestTime:0,redirectStart:0,redirectEnd:0,fetchStart:(0,s.getTiming)(this.#c.info?.timing?.workerFetchStart,e),dnsStart:(0,s.getTiming)(this.#c.info?.timing?.dnsStart,e),dnsEnd:(0,s.getTiming)(this.#c.info?.timing?.dnsEnd,e),connectStart:(0,s.getTiming)(this.#c.info?.timing?.connectStart,e),connectEnd:(0,s.getTiming)(this.#c.info?.timing?.connectEnd,e),tlsStart:(0,s.getTiming)(this.#c.info?.timing?.sslStart,e),requestStart:(0,s.getTiming)(this.#c.info?.timing?.sendStart,e),responseStart:(0,s.getTiming)(this.#c.info?.timing?.receiveHeadersStart,e),responseEnd:(0,s.getTiming)(this.#c.info?.timing?.receiveHeadersEnd,e)}}#T(){this.waitNextPhase.resolve(),this.waitNextPhase=new a.Deferred}#E(e){return this.#h()||!this.#d.isSubscribedTo(`network.${e}`)?new Set:this.#u.getInterceptsForPhase(this,e)}#D(e){return this.#E(e).size>0}handleRedirect(e){this.#c.hasExtraInfo=!1,this.#c.info=e.redirectResponse,this.#O({wasRedirected:!0})}#O(e={}){let t=e.wasRedirected||e.hasFailed||this.#m()||!!this.#a.extraInfo||this.#r||!!(this.#c.info&&!this.#c.hasExtraInfo),n=this.#h(),r=!n&&this.#D(`beforeRequestSent`),i=!r||r&&!!this.#a.paused;this.#a.info&&(r?i:t)&&this.#M(this.#R.bind(this));let a=!!this.#c.extraInfo||this.#r||!!(this.#c.info&&!this.#c.hasExtraInfo),o=!n&&this.#D(`responseStarted`);(this.#c.info||o&&this.#c.paused)&&this.#M(this.#z.bind(this));let s=!o||o&&!!this.#c.paused;this.#c.info&&a&&s&&(this.#M(this.#B.bind(this)),this.#u.disposeRequest(this.id))}onRequestWillBeSentEvent(e){this.#a.info=e,this.#u.collectIfNeeded(this,`request`),this.#O()}onRequestWillBeSentExtraInfoEvent(e){this.#a.extraInfo=e,this.#O()}onResponseReceivedExtraInfoEvent(e){e.statusCode>=300&&e.statusCode<=399&&this.#a.info&&e.headers.location===this.#a.info.request.url||(this.#c.extraInfo=e,this.#O())}onResponseReceivedEvent(e){this.#c.hasExtraInfo=e.hasExtraInfo,this.#c.info=e.response,this.#u.collectIfNeeded(this,`response`),this.#O()}onServedFromCache(){this.#r=!0,this.#O()}onLoadingFailedEvent(e){this.#O({hasFailed:!0}),this.#M(()=>({method:n.ChromiumBidi.Network.EventNames.FetchError,params:{...this.#N(),errorText:e.errorText}}))}async failRequest(e){(0,r.assert)(this.#t,`Network Interception not set-up.`),await this.cdpClient.sendCommand(`Fetch.failRequest`,{requestId:this.#t,errorReason:e}),this.#n=void 0}onRequestPaused(e){this.#t=e.requestId,e.responseStatusCode||e.responseErrorReason?(this.#c.paused=e,this.#D(`responseStarted`)&&!this.#p[n.ChromiumBidi.Network.EventNames.ResponseStarted]&&this.#t!==this.id?this.#n=`responseStarted`:this.#A()):(this.#a.paused=e,this.#D(`beforeRequestSent`)&&!this.#p[n.ChromiumBidi.Network.EventNames.BeforeRequestSent]&&this.#t!==this.id?this.#n=`beforeRequestSent`:this.#k()),this.#O()}onAuthRequired(e){this.#t=e.requestId,this.#a.auth=e,this.#D(`authRequired`)&&this.#t!==this.id?this.#n=`authRequired`:this.#j({response:`Default`}),this.#M(()=>({method:n.ChromiumBidi.Network.EventNames.AuthRequired,params:{...this.#N(`authRequired`),response:this.#P()}}))}async continueRequest(e={}){let t=this.#H(e.headers,e.cookies),n=(0,s.cdpFetchHeadersFromBidiNetworkHeaders)(t),r=u(e.body);await this.#k({url:e.url,method:e.method,headers:n,postData:r}),this.#o={url:e.url,method:e.method,headers:e.headers,cookies:e.cookies,bodySize:d(e.body)}}async#k(e={}){(0,r.assert)(this.#t,`Network Interception not set-up.`),await this.cdpClient.sendCommand(`Fetch.continueRequest`,{requestId:this.#t,url:e.url,method:e.method,headers:e.headers,postData:e.postData}),this.#n=void 0}async continueResponse(e={}){if(this.interceptPhase===`authRequired`)if(e.credentials)await Promise.all([this.waitNextPhase,await this.#j({response:`ProvideCredentials`,username:e.credentials.username,password:e.credentials.password})]);else return await this.#j({response:`ProvideCredentials`});if(this.#n===`responseStarted`){let t=this.#H(e.headers,e.cookies),n=(0,s.cdpFetchHeadersFromBidiNetworkHeaders)(t);await this.#A({responseCode:e.statusCode??this.#c.paused?.responseStatusCode,responsePhrase:e.reasonPhrase??this.#c.paused?.responseStatusText,responseHeaders:n??this.#c.paused?.responseHeaders}),this.#s={statusCode:e.statusCode,headers:t}}}async#A({responseCode:e,responsePhrase:t,responseHeaders:n}={}){(0,r.assert)(this.#t,`Network Interception not set-up.`),await this.cdpClient.sendCommand(`Fetch.continueResponse`,{requestId:this.#t,responseCode:e,responsePhrase:t,responseHeaders:n}),this.#n=void 0}async continueWithAuth(e){let t,n;if(e.action===`provideCredentials`){let{credentials:r}=e;t=r.username,n=r.password}let r=(0,s.cdpAuthChallengeResponseFromBidiAuthContinueWithAuthAction)(e.action);await this.#j({response:r,username:t,password:n})}async provideResponse(e){if((0,r.assert)(this.#t,`Network Interception not set-up.`),this.interceptPhase===`authRequired`)return await this.#j({response:`ProvideCredentials`});if(!e.body&&!e.headers)return await this.#k();let t=this.#H(e.headers,e.cookies),n=(0,s.cdpFetchHeadersFromBidiNetworkHeaders)(t),i=e.statusCode??this.#x??200;await this.cdpClient.sendCommand(`Fetch.fulfillRequest`,{requestId:this.#t,responseCode:i,responsePhrase:e.reasonPhrase,responseHeaders:n,body:u(e.body)}),this.#n=void 0}dispose(){this.waitNextPhase.reject(Error(`waitNextPhase disposed`))}async#j(e){(0,r.assert)(this.#t,`Network Interception not set-up.`),await this.cdpClient.sendCommand(`Fetch.continueWithAuth`,{requestId:this.#t,authChallengeResponse:e}),this.#n=void 0}#M(e){let t;try{t=e()}catch(e){this.#f?.(o.LogType.debugError,e);return}this.#V()||this.#p[t.method]&&t.method!==n.ChromiumBidi.Network.EventNames.AuthRequired||(this.#T(),this.#p[t.method]=!0,this.#b?this.#l.registerEvent(Object.assign(t,{type:`event`}),this.#b):this.#l.registerGlobalEvent(Object.assign(t,{type:`event`})))}#N(e){let t={isBlocked:!1};if(e){let n=this.#E(e);t.isBlocked=n.size>0,t.isBlocked&&(t.intercepts=[...n])}return{context:this.#b,navigation:this.#_,redirectCount:this.#i,request:this.#F(),timestamp:Math.round((0,s.getTiming)(this.#a.info?.wallTime)*1e3),...t}}#P(){this.#c.info?.fromDiskCache&&(this.#c.extraInfo=void 0);let e=this.#c.info?.headers??{},t=this.#c.extraInfo?.headers??{};for(let[n,r]of Object.entries(t))e[n]=r;let n=(0,s.bidiNetworkHeadersFromCdpNetworkHeaders)(e),r=this.#C;return{url:this.url,protocol:this.#c.info?.protocol??``,status:this.#x??-1,statusText:this.#c.info?.statusText||this.#c.paused?.responseStatusText||``,fromCache:this.#c.info?.fromDiskCache||this.#c.info?.fromPrefetchCache||this.#r,headers:this.#s?.headers??n,mimeType:this.#c.info?.mimeType||``,bytesReceived:this.bytesReceived,headersSize:(0,s.computeHeadersSize)(n),bodySize:0,content:{size:0},...r?{authChallenges:r}:{},"goog:securityDetails":this.#c.info?.securityDetails}}get bytesReceived(){return this.#c.info?.encodedDataLength||0}#F(){let e=this.#S;return{request:this.#e,url:this.url,method:this.#g??t.unknownParameter,headers:e,cookies:this.#v,headersSize:(0,s.computeHeadersSize)(e),bodySize:this.bodySize,destination:this.#I(),initiatorType:this.#L(),timings:this.#w,"goog:postData":this.#a.info?.request?.postData,"goog:hasPostData":this.#a.info?.request?.hasPostData,"goog:resourceType":this.#a.info?.type,"goog:resourceInitiator":this.#a.info?.initiator}}#I(){switch(this.#a.info?.type){case`Script`:return`script`;case`Stylesheet`:return`style`;case`Image`:return`image`;case`Document`:return this.#a.info?.initiator.type===`parser`?`iframe`:``;default:return``}}#L(){if(this.#a.info?.initiator.type===`parser`)switch(this.#a.info?.type){case`Document`:return`iframe`;case`Font`:return this.#a.info?.initiator?.url===this.#a.info?.documentURL?`font`:`css`;case`Image`:return this.#a.info?.initiator?.url===this.#a.info?.documentURL?`img`:`css`;case`Script`:return`script`;case`Stylesheet`:return`link`;default:return null}return this.#a?.info?.type===`Fetch`?`fetch`:null}#R(){return(0,r.assert)(this.#a.info,`RequestWillBeSentEvent is not set`),{method:n.ChromiumBidi.Network.EventNames.BeforeRequestSent,params:{...this.#N(`beforeRequestSent`),initiator:{type:t.#U(this.#a.info.initiator.type),columnNumber:this.#a.info.initiator.columnNumber,lineNumber:this.#a.info.initiator.lineNumber,stackTrace:this.#a.info.initiator.stack,request:this.#a.info.initiator.requestId}}}}#z(){return{method:n.ChromiumBidi.Network.EventNames.ResponseStarted,params:{...this.#N(`responseStarted`),response:this.#P()}}}#B(){return{method:n.ChromiumBidi.Network.EventNames.ResponseCompleted,params:{...this.#N(),response:this.#P()}}}#V(){let e=`/favicon.ico`;return this.#a.paused?.request.url.endsWith(e)??this.#a.info?.request.url.endsWith(e)??!1}#H(e,t){if(!e&&!t)return;let n=e,r=(0,s.networkHeaderFromCookieHeaders)(t);return r&&!n&&(n=this.#S),r&&n&&(n.filter(e=>e.name.localeCompare(`cookie`,void 0,{sensitivity:`base`})!==0),n.push(r)),n}static#U(e){switch(e){case`parser`:case`script`:case`preflight`:return e;default:return`other`}}};e.NetworkRequest=l,t=l;function u(e){let t;return e?.type===`string`?t=(0,s.stringToBase64)(e.value):e?.type===`base64`&&(t=e.value),t}function d(e){return e?.type===`string`?e.value.length:e?.type===`base64`?atob(e.value).length:0}})),tn=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.NetworkStorage=e.MAX_TOTAL_COLLECTED_SIZE=void 0;let t=z(),n=V(),r=Qt(),i=en(),a=Tt();e.MAX_TOTAL_COLLECTED_SIZE=2e8,e.NetworkStorage=class{#e;#t;#n;#r;#i=new Map;#a=new Map;#o=`default`;constructor(t,n,i,a){this.#e=n,this.#t=t,this.#n=new r.CollectorsStorage(e.MAX_TOTAL_COLLECTED_SIZE,a),i.on(`Target.detachedFromTarget`,({sessionId:e})=>{this.disposeRequestMap(e)}),this.#r=a}#s(e,t,n){let r=this.getRequestById(e);return n===void 0&&r?r:(r=new i.NetworkRequest(e,this.#t,this,t,n,this.#r),this.addRequest(r),r)}onCdpTargetCreated(e){let t=e.cdpClient,n=[[`Network.requestWillBeSent`,t=>{let n=this.getRequestById(t.requestId);n?.updateCdpTarget(e),n&&n.isRedirecting()?(n.handleRedirect(t),this.disposeRequest(t.requestId),this.#s(t.requestId,e,n.redirectCount+1).onRequestWillBeSentEvent(t)):this.#s(t.requestId,e).onRequestWillBeSentEvent(t)}],[`Network.requestWillBeSentExtraInfo`,t=>{let n=this.#s(t.requestId,e);n.updateCdpTarget(e),n.onRequestWillBeSentExtraInfoEvent(t)}],[`Network.responseReceived`,t=>{let n=this.#s(t.requestId,e);n.updateCdpTarget(e),n.onResponseReceivedEvent(t)}],[`Network.responseReceivedExtraInfo`,t=>{let n=this.#s(t.requestId,e);n.updateCdpTarget(e),n.onResponseReceivedExtraInfoEvent(t)}],[`Network.requestServedFromCache`,t=>{let n=this.#s(t.requestId,e);n.updateCdpTarget(e),n.onServedFromCache()}],[`Network.loadingFailed`,t=>{let n=this.#s(t.requestId,e);n.updateCdpTarget(e),n.onLoadingFailedEvent(t)}],[`Fetch.requestPaused`,t=>{let n=this.#s(t.networkId??t.requestId,e);n.updateCdpTarget(e),n.onRequestPaused(t)}],[`Fetch.authRequired`,t=>{let n=this.getRequestByFetchId(t.requestId);n||=this.#s(t.requestId,e),n.updateCdpTarget(e),n.onAuthRequired(t)}],[`Network.dataReceived`,t=>{this.getRequestById(t.requestId)?.updateCdpTarget(e)}],[`Network.loadingFinished`,t=>{this.getRequestById(t.requestId)?.updateCdpTarget(e)}]];for(let[e,r]of n)t.on(e,r)}async getCollectedData(e){if(!this.#n.isCollected(e.request,e.dataType,e.collector))throw new t.NoSuchNetworkDataException(e.collector===void 0?`No collected ${e.dataType} data`:`Collector ${e.collector} didn't collect ${e.dataType} data`);if(e.disown&&e.collector===void 0)throw new t.InvalidArgumentException(`Cannot disown collected data without collector ID`);let n=this.getRequestById(e.request);if(n===void 0)throw new t.NoSuchNetworkDataException(`No data for ${e.request}`);let r;switch(e.dataType){case`response`:r=await this.#c(n);break;case`request`:r=await this.#l(n);break;default:throw new t.UnsupportedOperationException(`Unsupported data type ${e.dataType}`)}return e.disown&&e.collector!==void 0&&(this.#n.disownData(n.id,e.dataType,e.collector),this.disposeRequest(n.id)),r}async#c(e){try{let t=await e.cdpClient.sendCommand(`Network.getResponseBody`,{requestId:e.id});return{bytes:{type:t.base64Encoded?`base64`:`string`,value:t.body}}}catch(e){throw e.code===-32e3&&e.message===`No resource with given identifier found`?new t.NoSuchNetworkDataException(`Response data was disposed`):e.code===-32001?new t.NoSuchNetworkDataException(`Response data is disposed after the related page`):e}}async#l(e){return{bytes:{type:`string`,value:(await e.cdpClient.sendCommand(`Network.getRequestPostData`,{requestId:e.id})).postData}}}collectIfNeeded(e,t){this.#n.collectIfNeeded(e,t,e.cdpTarget.topLevelId,e.cdpTarget.userContext)}getInterceptionStages(e){let t={request:!1,response:!1,auth:!1};for(let n of this.#a.values())n.contexts&&!n.contexts.includes(e)||(t.request||=n.phases.includes(`beforeRequestSent`),t.response||=n.phases.includes(`responseStarted`),t.auth||=n.phases.includes(`authRequired`));return t}getInterceptsForPhase(e,t){if(e.url===i.NetworkRequest.unknownParameter)return new Set;let n=new Set;for(let[r,i]of this.#a.entries())if(!(!i.phases.includes(t)||i.contexts&&!i.contexts.includes(e.cdpTarget.topLevelId))){if(i.urlPatterns.length===0){n.add(r);continue}for(let t of i.urlPatterns)if((0,a.matchUrlPattern)(t,e.url)){n.add(r);break}}return n}disposeRequestMap(e){for(let t of this.#i.values())t.cdpClient.sessionId===e&&(this.#i.delete(t.id),t.dispose())}addIntercept(e){let t=(0,n.uuidv4)();return this.#a.set(t,e),t}removeIntercept(e){if(!this.#a.has(e))throw new t.NoSuchInterceptException(`Intercept '${e}' does not exist.`);this.#a.delete(e)}getRequestsByTarget(e){let t=[];for(let n of this.#i.values())n.cdpTarget===e&&t.push(n);return t}getRequestById(e){return this.#i.get(e)}getRequestByFetchId(e){for(let t of this.#i.values())if(t.fetchId===e)return t}addRequest(e){this.#i.set(e.id,e)}disposeRequest(e){this.#n.isCollected(e)||this.#i.delete(e)}getNavigationId(e){return e===void 0?null:this.#e.findContext(e)?.navigationId??null}set defaultCacheBehavior(e){this.#o=e}get defaultCacheBehavior(){return this.#o}addDataCollector(e){return this.#n.addDataCollector(e)}removeDataCollector(e){this.#n.removeDataCollector(e.collector).map(e=>this.disposeRequest(e))}disownData(e){if(!this.#n.isCollected(e.request,e.dataType,e.collector))throw new t.NoSuchNetworkDataException(`Collector ${e.collector} didn't collect ${e.dataType} data`);this.#n.disownData(e.request,e.dataType,e.collector),this.disposeRequest(e.request)}}})),nn=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.CdpTarget=void 0;let t=at(),n=z(),r=Bt(),i=L(),a=Jt(),o=Zt(),s=tn();e.CdpTarget=class e{#e;userContext;#t;#n;#r;#i;#a;#o;#s;#c;contextConfigStorage;#l=new r.Deferred;#u;#d={width:0,height:0,deviceScaleFactor:0,mobile:!1,dontSetVisibleSize:!0};#f;#p=!1;#m=!1;#h=!1;#g={request:!1,response:!1,auth:!1};static create(t,n,r,i,a,s,c,l,u,d,f,p){let m=new e(t,n,r,i,s,a,c,l,d,u,f,p);return o.LogManager.create(m,a,s,p),m.#b(),m.#_(),m}constructor(e,t,n,r,i,a,o,s,c,l,u,d){this.userContext=u,this.#e=e,this.#t=t,this.#n=n,this.#r=r,this.#a=i,this.#i=a,this.#o=o,this.#c=l,this.#s=s,this.contextConfigStorage=c,this.#u=d}get unblocked(){return this.#l}get id(){return this.#e}get cdpClient(){return this.#t}get parentCdpClient(){return this.#r}get browserCdpClient(){return this.#n}get cdpSessionId(){return this.#t.sessionId}get windowId(){return this.#f===void 0&&this.#u?.(i.LogType.debugError,`Getting windowId before it was set, returning 0`),this.#f??0}async#_(){let e=this.contextConfigStorage.getActiveConfig(this.topLevelId,this.userContext),t=await Promise.allSettled([this.#t.sendCommand(`Page.enable`,{enableFileChooserOpenedEvent:!0}),...this.#E()?[]:[this.#t.sendCommand(`Page.setInterceptFileChooserDialog`,{enabled:!0,cancel:!0})],this.#t.sendCommand(`Page.getFrameTree`).then(e=>this.#v(e.frameTree)),this.#t.sendCommand(`Runtime.enable`),this.#t.sendCommand(`Page.setLifecycleEventsEnabled`,{enabled:!0}),this.#t.sendCommand(`Network.enable`,{enableDurableMessages:e.disableNetworkDurableMessages!==!0,maxTotalBufferSize:s.MAX_TOTAL_COLLECTED_SIZE}).then(()=>this.toggleNetworkIfNeeded()),this.#t.sendCommand(`Target.setAutoAttach`,{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0}),this.#C(),this.#T(e),this.#w(),this.#t.sendCommand(`Runtime.runIfWaitingForDebugger`),this.#r.sendCommand(`Runtime.runIfWaitingForDebugger`),this.toggleDeviceAccessIfNeeded(),this.togglePreloadIfNeeded()]);for(let e of t)e instanceof Error&&this.#u?.(i.LogType.debugError,`Error happened when configuring a new target`,e);this.#l.resolve({kind:`success`,value:void 0})}#v(e){let t=e.frame,n=this.#s.findContext(t.id);if(n!==void 0&&n.parentId===null&&t.parentId!==null&&t.parentId!==void 0&&(n.parentId=t.parentId),n===void 0&&t.parentId!==void 0){let e=this.#s.getContext(t.parentId);a.BrowsingContextImpl.create(t.id,t.parentId,this.userContext,e.cdpTarget,this.#a,this.#s,this.#i,this.contextConfigStorage,t.url,void 0,this.#u)}e.childFrames?.map(e=>this.#v(e))}async toggleFetchIfNeeded(){let e=this.#c.getInterceptionStages(this.topLevelId);if(this.#g.request===e.request&&this.#g.response===e.response&&this.#g.auth===e.auth)return;let t=[];if(this.#g=e,(e.request||e.auth)&&t.push({urlPattern:`*`,requestStage:`Request`}),e.response&&t.push({urlPattern:`*`,requestStage:`Response`}),t.length)await this.#t.sendCommand(`Fetch.enable`,{patterns:t,handleAuthRequests:e.auth});else{let e=this.#c.getRequestsByTarget(this).filter(e=>e.interceptPhase);Promise.allSettled(e.map(e=>e.waitNextPhase)).then(async()=>this.#c.getRequestsByTarget(this).filter(e=>e.interceptPhase).length?await this.toggleFetchIfNeeded():await this.#t.sendCommand(`Fetch.disable`)).catch(e=>{this.#u?.(i.LogType.bidi,`Disable failed`,e)})}}async toggleNetworkIfNeeded(){try{await Promise.all([this.toggleSetCacheDisabled(),this.toggleFetchIfNeeded()])}catch(e){if(this.#u?.(i.LogType.debugError,e),!this.#y(e))throw e}}async toggleSetCacheDisabled(e){let t=this.#c.defaultCacheBehavior===`bypass`,n=e??t;if(this.#m!==n){this.#m=n;try{await this.#t.sendCommand(`Network.setCacheDisabled`,{cacheDisabled:n})}catch(e){if(this.#u?.(i.LogType.debugError,e),this.#m=!n,!this.#y(e))throw e}}}async toggleDeviceAccessIfNeeded(){let e=this.isSubscribedTo(t.Bluetooth.EventNames.RequestDevicePromptUpdated);if(this.#p!==e){this.#p=e;try{await this.#t.sendCommand(e?`DeviceAccess.enable`:`DeviceAccess.disable`)}catch(t){if(this.#u?.(i.LogType.debugError,t),this.#p=!e,!this.#y(t))throw t}}}async togglePreloadIfNeeded(){let e=this.isSubscribedTo(t.Speculation.EventNames.PrefetchStatusUpdated);if(this.#h!==e){this.#h=e;try{await this.#t.sendCommand(e?`Preload.enable`:`Preload.disable`)}catch(t){if(this.#u?.(i.LogType.debugError,t),this.#h=!e,!this.#y(t))throw t}}}#y(e){let t=e;return t.code===-32001&&t.message===`Session with given id not found.`||this.#t.isCloseError(e)}#b(){this.#t.on(`*`,(e,t)=>{typeof e==`string`&&this.#a.registerEvent({type:`event`,method:`goog:cdp.${e}`,params:{event:e,params:t,session:this.cdpSessionId}},this.id)})}async#x(e){let t=[];if((e.request||e.auth)&&t.push({urlPattern:`*`,requestStage:`Request`}),e.response&&t.push({urlPattern:`*`,requestStage:`Response`}),t.length){let n=this.#g;this.#g=e;try{await this.#t.sendCommand(`Fetch.enable`,{patterns:t,handleAuthRequests:e.auth})}catch{this.#g=n}}}async#S(){this.#c.getRequestsByTarget(this).filter(e=>e.interceptPhase).length===0&&(this.#g={request:!1,response:!1,auth:!1},await this.#t.sendCommand(`Fetch.disable`))}async toggleNetwork(){let e=this.#c.getInterceptionStages(this.topLevelId),t=Object.values(e).some(e=>e),n=this.#g.request!==e.request||this.#g.response!==e.response||this.#g.auth!==e.auth;this.#u?.(i.LogType.debugInfo,`Toggle Network`,`Fetch (${t}) ${n}`),t&&n&&await this.#x(e),!t&&n&&await this.#S()}getChannels(){return this.#o.find().flatMap(e=>e.channels)}async#C(){let{windowId:e}=await this.#n.sendCommand(`Browser.getWindowForTarget`,{targetId:this.id});this.#f=e}async#w(){await Promise.all(this.#o.find({targetId:this.topLevelId}).map(e=>e.initInTarget(this,!0)))}async setViewport(e,t){if(e===null&&t===null){await this.cdpClient.sendCommand(`Emulation.clearDeviceMetricsOverride`);return}let r={...this.#d};e===null?(r.width=0,r.height=0):e!==void 0&&(r.width=e.width,r.height=e.height),t===null?r.deviceScaleFactor=0:t!==void 0&&(r.deviceScaleFactor=t);try{await this.cdpClient.sendCommand(`Emulation.setDeviceMetricsOverride`,r),this.#d=r}catch(e){throw e.message.startsWith(`Width and height values must be positive`)?new n.UnsupportedOperationException(`Provided viewport dimensions are not supported`):e}}async#T(e){let t=[];t.push(this.#t.sendCommand(`Page.setPrerenderingAllowed`,{isAllowed:!e.prerenderingDisabled}).catch(()=>{})),(e.viewport!==void 0||e.devicePixelRatio!==void 0)&&t.push(this.setViewport(e.viewport,e.devicePixelRatio).catch(()=>{})),e.screenOrientation!==void 0&&e.screenOrientation!==null&&t.push(this.setScreenOrientationOverride(e.screenOrientation).catch(()=>{})),e.geolocation!==void 0&&e.geolocation!==null&&t.push(this.setGeolocationOverride(e.geolocation)),e.locale!==void 0&&t.push(this.setLocaleOverride(e.locale)),e.timezone!==void 0&&t.push(this.setTimezoneOverride(e.timezone)),e.extraHeaders!==void 0&&t.push(this.setExtraHeaders(e.extraHeaders)),e.userAgent!==void 0&&t.push(this.setUserAgent(e.userAgent)),e.scriptingEnabled!==void 0&&t.push(this.setScriptingEnabled(e.scriptingEnabled)),e.acceptInsecureCerts!==void 0&&t.push(this.cdpClient.sendCommand(`Security.setIgnoreCertificateErrors`,{ignore:e.acceptInsecureCerts})),e.emulatedNetworkConditions!==void 0&&t.push(this.setEmulatedNetworkConditions(e.emulatedNetworkConditions)),await Promise.all(t)}get topLevelId(){return this.#s.findTopLevelContextId(this.id)??this.id}isSubscribedTo(e){return this.#a.subscriptionManager.isSubscribedTo(e,this.topLevelId)}#E(){let e=this.contextConfigStorage.getActiveConfig(this.topLevelId,this.userContext);return(e.userPromptHandler?.file??e.userPromptHandler?.default??`ignore`)===`ignore`}async setGeolocationOverride(e){if(e===null)await this.cdpClient.sendCommand(`Emulation.clearGeolocationOverride`);else if(`type`in e){if(e.type!==`positionUnavailable`)throw new n.UnknownErrorException(`Unknown geolocation error ${e.type}`);await this.cdpClient.sendCommand(`Emulation.setGeolocationOverride`,{})}else if(`latitude`in e)await this.cdpClient.sendCommand(`Emulation.setGeolocationOverride`,{latitude:e.latitude,longitude:e.longitude,accuracy:e.accuracy??1,altitude:e.altitude??void 0,altitudeAccuracy:e.altitudeAccuracy??void 0,heading:e.heading??void 0,speed:e.speed??void 0});else throw new n.UnknownErrorException(`Unexpected geolocation coordinates value`)}async setScreenOrientationOverride(e){let t={...this.#d};e===null?delete t.screenOrientation:t.screenOrientation=this.#D(e),await this.cdpClient.sendCommand(`Emulation.setDeviceMetricsOverride`,t),this.#d=t}#D(e){if(e.natural===`portrait`)switch(e.type){case`portrait-primary`:return{angle:0,type:`portraitPrimary`};case`landscape-primary`:return{angle:90,type:`landscapePrimary`};case`portrait-secondary`:return{angle:180,type:`portraitSecondary`};case`landscape-secondary`:return{angle:270,type:`landscapeSecondary`};default:throw new n.UnknownErrorException(`Unexpected screen orientation type ${e.type}`)}if(e.natural===`landscape`)switch(e.type){case`landscape-primary`:return{angle:0,type:`landscapePrimary`};case`portrait-primary`:return{angle:90,type:`portraitPrimary`};case`landscape-secondary`:return{angle:180,type:`landscapeSecondary`};case`portrait-secondary`:return{angle:270,type:`portraitSecondary`};default:throw new n.UnknownErrorException(`Unexpected screen orientation type ${e.type}`)}throw new n.UnknownErrorException(`Unexpected orientation natural ${e.natural}`)}async setLocaleOverride(e){e===null?await this.cdpClient.sendCommand(`Emulation.setLocaleOverride`,{}):await this.cdpClient.sendCommand(`Emulation.setLocaleOverride`,{locale:e})}async setScriptingEnabled(e){await this.cdpClient.sendCommand(`Emulation.setScriptExecutionDisabled`,{value:e===!1})}async setTimezoneOverride(e){e===null?await this.cdpClient.sendCommand(`Emulation.setTimezoneOverride`,{timezoneId:``}):await this.cdpClient.sendCommand(`Emulation.setTimezoneOverride`,{timezoneId:e})}async setExtraHeaders(e){await this.cdpClient.sendCommand(`Network.setExtraHTTPHeaders`,{headers:e})}async setUserAgent(e){await this.cdpClient.sendCommand(`Emulation.setUserAgentOverride`,{userAgent:e??``})}async setEmulatedNetworkConditions(e){if(e!==null&&e.type!==`offline`)throw new n.UnsupportedOperationException(`Unsupported network conditions ${e.type}`);await Promise.all([this.cdpClient.sendCommand(`Network.emulateNetworkConditionsByRule`,{offline:e?.type===`offline`,matchedNetworkConditions:[{urlPattern:``,latency:0,downloadThroughput:-1,uploadThroughput:-1}]}),this.cdpClient.sendCommand(`Network.overrideNetworkState`,{offline:e?.type===`offline`,latency:0,downloadThroughput:-1,uploadThroughput:-1})])}}})),rn=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.CdpTargetManager=void 0;let t=L(),n=Jt(),r=Yt(),i=nn(),a={service_worker:`service-worker`,shared_worker:`shared-worker`,worker:`dedicated-worker`};e.CdpTargetManager=class{#e;#t;#n=new Set;#r;#i;#a;#o;#s;#c;#l;#u;#d;#f;#p;constructor(e,t,n,r,i,a,o,s,c,l,u,d,f){this.#t=e,this.#e=t,this.#n.add(n),this.#r=n,this.#i=r,this.#a=i,this.#c=u,this.#o=o,this.#u=s,this.#s=c,this.#d=l,this.#l=a,this.#f=d,this.#p=f,this.#m(t)}#m(e){e.on(`Target.attachedToTarget`,t=>{this.#_(t,e)}),e.on(`Target.detachedFromTarget`,this.#S.bind(this)),e.on(`Target.targetInfoChanged`,this.#C.bind(this)),e.on(`Inspector.targetCrashed`,()=>{this.#w(e)}),e.on(`Page.frameAttached`,this.#h.bind(this)),e.on(`Page.frameSubtreeWillBeDetached`,this.#g.bind(this))}#h(e){let t=this.#a.findContext(e.parentFrameId);t!==void 0&&n.BrowsingContextImpl.create(e.frameId,e.parentFrameId,t.userContext,t.cdpTarget,this.#i,this.#a,this.#l,this.#u,`about:blank`,void 0,this.#p)}#g(e){this.#a.findContext(e.frameId)?.dispose(!0)}#_(e,r){let{sessionId:i,targetInfo:o}=e,s=this.#t.getCdpClient(i),c=async()=>{await s.sendCommand(`Runtime.runIfWaitingForDebugger`).then(()=>r.sendCommand(`Target.detachFromTarget`,e)).catch(e=>this.#p?.(t.LogType.debugError,e))};if(this.#r===o.targetId){c();return}let l=o.type===`service_worker`?`${r.sessionId}_${o.targetId}`:o.targetId;if(this.#n.has(l))return;this.#n.add(l);let u=o.browserContextId&&o.browserContextId!==this.#f?o.browserContextId:`default`;switch(o.type){case`tab`:this.#m(s),(async()=>{await s.sendCommand(`Target.setAutoAttach`,{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0})})();return;case`page`:case`iframe`:{let e=this.#y(s,r,o,u),t=this.#a.findContext(o.targetId);if(t&&o.type===`iframe`)t.updateCdpTarget(e);else{let t=this.#v(o,r.sessionId);n.BrowsingContextImpl.create(o.targetId,t,u,e,this.#i,this.#a,this.#l,this.#u,o.url===``?`about:blank`:o.url,o.openerFrameId??o.openerId,this.#p)}return}case`service_worker`:case`worker`:{let e=this.#l.findRealm({cdpSessionId:r.sessionId,sandbox:null});if(!e){c();return}let t=this.#y(s,r,o,u);this.#x(a[o.type],t,e);return}case`shared_worker`:{let e=this.#y(s,r,o,u);this.#x(a[o.type],e);return}}c()}#v(e,t){if(e.type!==`iframe`)return null;let n=e.openerFrameId??e.openerId;return n===void 0?t===void 0?null:this.#a.findContextBySession(t)?.id??null:n}#y(e,t,n,r){this.#m(e),this.#c.onCdpTargetCreated(n.targetId,r);let a=i.CdpTarget.create(n.targetId,e,this.#e,t,this.#l,this.#i,this.#c,this.#a,this.#o,this.#u,r,this.#p);return this.#o.onCdpTargetCreated(a),this.#s.onCdpTargetCreated(a),this.#d.onCdpTargetCreated(a),a}#b=new Map;#x(e,t,i){t.cdpClient.on(`Runtime.executionContextCreated`,a=>{let{uniqueId:o,id:s,origin:c}=a.context,l=new r.WorkerRealm(t.cdpClient,this.#i,s,this.#p,(0,n.serializeOrigin)(c),i?[i]:[],o,this.#l,e);this.#b.set(t.cdpSessionId,l)})}#S({sessionId:e,targetId:t}){t&&this.#c.find({targetId:t}).map(e=>{e.dispose(t)});let n=this.#a.findContextBySession(e);if(n){n.dispose(!0);return}let r=this.#b.get(e);r&&this.#l.deleteRealms({cdpSessionId:r.cdpClient.sessionId})}#C(e){let t=this.#a.findContext(e.targetInfo.targetId);t&&t.onTargetInfoChanged(e)}#w(e){let t=this.#l.findRealms({cdpSessionId:e.sessionId});for(let e of t)e.dispose()}}})),an=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.BrowsingContextStorage=void 0;let t=z(),n=nt();e.BrowsingContextStorage=class{#e=new Map;#t=new n.EventEmitter;getTopLevelContexts(){return this.getAllContexts().filter(e=>e.isTopLevelContext())}getAllContexts(){return Array.from(this.#e.values())}deleteContextById(e){this.#e.delete(e)}deleteContext(e){this.#e.delete(e.id)}addContext(e){this.#e.set(e.id,e),this.#t.emit(`added`,{browsingContext:e})}waitForContext(e){return this.#e.has(e)?Promise.resolve(this.getContext(e)):new Promise(t=>{let n=r=>{r.browsingContext.id===e&&(this.#t.off(`added`,n),t(r.browsingContext))};this.#t.on(`added`,n)})}hasContext(e){return this.#e.has(e)}findContext(e){return this.#e.get(e)}findTopLevelContextId(e){if(e===null)return null;let t=this.findContext(e);if(!t)return null;let n=t.parentId??null;return n===null?e:this.findTopLevelContextId(n)}findContextBySession(e){for(let t of this.#e.values())if(t.cdpTarget.cdpSessionId===e)return t}getContext(e){let n=this.findContext(e);if(n===void 0)throw new t.NoSuchFrameException(`Context ${e} not found`);return n}verifyTopLevelContextsList(e){let n=new Set;if(!e)return n;for(let r of e){let e=this.getContext(r);if(e.isTopLevelContext())n.add(e);else throw new t.InvalidArgumentException(`Non top-level context '${r}' given.`)}return n}verifyContextsList(e){if(e.length)for(let t of e)this.getContext(t)}}})),on=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.PreloadScriptStorage=void 0;let t=R();e.PreloadScriptStorage=class{#e=new Set;find(e){return e?[...this.#e].filter(t=>!!(t.contexts===void 0&&t.userContexts===void 0||e.targetId!==void 0&&t.targetIds.has(e.targetId))):[...this.#e]}add(e){this.#e.add(e)}remove(e){let n=[...this.#e].find(t=>t.id===e);if(n===void 0)throw new t.NoSuchScriptException(`No preload script with id '${e}'`);this.#e.delete(n)}getPreloadScript(e){let n=[...this.#e].find(t=>t.id===e);if(n===void 0)throw new t.NoSuchScriptException(`No preload script with id '${e}'`);return n}onCdpTargetCreated(e,t){let n=[...this.#e].filter(e=>!e.userContexts&&!e.contexts?!0:e.userContexts?.includes(t));for(let t of n)t.targetIds.add(e)}}})),sn=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.RealmStorage=void 0;let t=z(),n=Gt();e.RealmStorage=class{#e=new Map;#t=new Map;hiddenSandboxes=new Set;get knownHandlesToRealmMap(){return this.#e}addRealm(e){this.#t.set(e.realmId,e)}findRealms(e){let t=e.sandbox===null?void 0:e.sandbox;return Array.from(this.#t.values()).filter(r=>!(e.realmId!==void 0&&e.realmId!==r.realmId||e.browsingContextId!==void 0&&!r.associatedBrowsingContexts.map(e=>e.id).includes(e.browsingContextId)||e.sandbox!==void 0&&(!(r instanceof n.WindowRealm)||t!==r.sandbox)||e.executionContextId!==void 0&&e.executionContextId!==r.executionContextId||e.origin!==void 0&&e.origin!==r.origin||e.type!==void 0&&e.type!==r.realmType||e.cdpSessionId!==void 0&&e.cdpSessionId!==r.cdpClient.sessionId||e.isHidden!==void 0&&e.isHidden!==r.isHidden()))}findRealm(e){return this.findRealms(e)[0]}getRealm(e){let n=this.findRealm(e);if(n===void 0)throw new t.NoSuchFrameException(`Realm ${JSON.stringify(e)} not found`);return n}deleteRealms(e){this.findRealms(e).map(e=>{e.dispose(),this.#t.delete(e.realmId),Array.from(this.knownHandlesToRealmMap.entries()).filter(([,t])=>t===e.realmId).map(([e])=>this.knownHandlesToRealmMap.delete(e))})}}})),cn=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.Buffer=void 0,e.Buffer=class{#e;#t=[];#n;constructor(e,t){this.#e=e,this.#n=t}get(){return this.#t}add(e){for(this.#t.push(e);this.#t.length>this.#e;){let e=this.#t.shift();e!==void 0&&this.#n?.(e)}}}})),ln=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.IdWrapper=void 0,e.IdWrapper=class e{static#e=0;#t;constructor(){this.#t=++e.#e}get id(){return this.#t}}})),un=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.isCdpEvent=n,e.assertSupportedEvent=r;let t=z();function n(e){return e.split(`.`).at(0)?.startsWith(t.ChromiumBidi.BiDiModule.Cdp)??!1}function r(e){if(!t.ChromiumBidi.EVENT_NAMES.has(e)&&!n(e))throw new t.InvalidArgumentException(`Unknown event: ${e}`)}})),dn=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SubscriptionManager=void 0,e.cartesianProduct=r,e.unrollEvents=i,e.difference=o;let t=z(),n=V();function r(...e){return e.reduce((e,t)=>e.flatMap(e=>t.map(t=>[e,t].flat())))}function i(e){let n=new Set;function r(e){for(let t of e)n.add(t)}for(let i of e)switch(i){case t.ChromiumBidi.BiDiModule.Bluetooth:r(Object.values(t.ChromiumBidi.Bluetooth.EventNames));break;case t.ChromiumBidi.BiDiModule.BrowsingContext:r(Object.values(t.ChromiumBidi.BrowsingContext.EventNames));break;case t.ChromiumBidi.BiDiModule.Input:r(Object.values(t.ChromiumBidi.Input.EventNames));break;case t.ChromiumBidi.BiDiModule.Log:r(Object.values(t.ChromiumBidi.Log.EventNames));break;case t.ChromiumBidi.BiDiModule.Network:r(Object.values(t.ChromiumBidi.Network.EventNames));break;case t.ChromiumBidi.BiDiModule.Script:r(Object.values(t.ChromiumBidi.Script.EventNames));break;case t.ChromiumBidi.BiDiModule.Speculation:r(Object.values(t.ChromiumBidi.Speculation.EventNames));break;default:n.add(i)}return n.values()}e.SubscriptionManager=class{#e=[];#t=new Set;#n;constructor(e){this.#n=e}getGoogChannelsSubscribedToEvent(e,t){let n=new Set;for(let r of this.#e)this.#r(r,e,t)&&n.add(r.googChannel);return Array.from(n)}getGoogChannelsSubscribedToEventGlobally(e){let t=new Set;for(let n of this.#e)this.#r(n,e)&&t.add(n.googChannel);return Array.from(t)}#r(e,t,n){let r=!1;for(let n of e.eventNames)if(n===t||n===t.split(`.`).at(0)||n.split(`.`).at(0)===t){r=!0;break}if(!r)return!1;if(e.userContextIds.size!==0){if(!n)return!1;let t=this.#n.findContext(n);return t?e.userContextIds.has(t.userContext):!1}if(e.topLevelTraversableIds.size!==0){if(!n)return!1;let t=this.#n.findTopLevelContextId(n);return t!==null&&e.topLevelTraversableIds.has(t)}return!0}isSubscribedTo(e,t){for(let n of this.#e)if(this.#r(n,e,t))return!0;return!1}subscribe(e,r,a,o){let s={id:(0,n.uuidv4)(),eventNames:new Set(i(e)),topLevelTraversableIds:new Set(r.map(e=>{let n=this.#n.findTopLevelContextId(e);if(!n)throw new t.NoSuchFrameException(`Top-level navigable not found for context id ${e}`);return n})),userContextIds:new Set(a),googChannel:o};return this.#e.push(s),this.#t.add(s.id),s}unsubscribe(e,n){let r=new Set(i(e)),o=[],c=new Set;for(let e of this.#e){if(e.googChannel!==n){o.push(e);continue}if(e.userContextIds.size!==0){o.push(e);continue}if(a(e.eventNames,r).size===0){o.push(e);continue}if(e.topLevelTraversableIds.size!==0){o.push(e);continue}let t=new Set(e.eventNames);for(let e of r)t.has(e)&&(c.add(e),t.delete(e));t.size!==0&&o.push({...e,eventNames:t})}if(!s(c,r))throw new t.InvalidArgumentException(`No subscription found`);this.#e=o}unsubscribeById(e){let n=new Set(e);if(o(n,this.#t).size!==0)throw new t.InvalidArgumentException(`No subscription found`);this.#e=this.#e.filter(e=>!n.has(e.id)),this.#t=o(this.#t,n)}};function a(e,t){let n=new Set;for(let r of e)t.has(r)&&n.add(r);return n}function o(e,t){let n=new Set;for(let r of e)t.has(r)||n.add(r);return n}function s(e,t){if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;return!0}})),fn=f((e=>{var t;Object.defineProperty(e,`__esModule`,{value:!0}),e.EventManager=void 0;let n=z(),r=cn(),i=$t(),a=nt(),o=ln(),s=Pt(),c=un(),l=dn();var u=class{#e=new o.IdWrapper;#t;#n;constructor(e,t){this.#n=e,this.#t=t}get id(){return this.#e.id}get contextId(){return this.#t}get event(){return this.#n}};let d=new Map([[n.ChromiumBidi.Log.EventNames.LogEntryAdded,100]]);var f=class extends a.EventEmitter{#e=new i.DefaultMap(()=>new Set);#t=new Map;#n=new Map;#r;#i;#a;#o;constructor(e,t){super(),this.#i=e,this.#o=t,this.#r=new l.SubscriptionManager(e),this.#a=new i.DefaultMap(()=>[])}get subscriptionManager(){return this.#r}static#s(e,t){return JSON.stringify({eventName:e,browsingContext:t})}addSubscribeHook(e,t){this.#a.get(e).push(t)}registerEvent(e,t){this.registerPromiseEvent(Promise.resolve({kind:`success`,value:e}),t,e.method)}registerGlobalEvent(e){this.registerGlobalPromiseEvent(Promise.resolve({kind:`success`,value:e}),e.method)}registerPromiseEvent(e,t,n){let r=new u(e,t),i=this.#r.getGoogChannelsSubscribedToEvent(n,t);this.#c(r,n);for(let t of i)this.emit(`event`,{message:s.OutgoingMessage.createFromPromise(e,t),event:n}),this.#l(r,t,n)}registerGlobalPromiseEvent(e,t){let n=new u(e,null),r=this.#r.getGoogChannelsSubscribedToEventGlobally(t);this.#c(n,t);for(let i of r)this.emit(`event`,{message:s.OutgoingMessage.createFromPromise(e,i),event:t}),this.#l(n,i,t)}async subscribe(e,t,r,i){for(let t of e)(0,c.assertSupportedEvent)(t);if(r.length&&t.length)throw new n.InvalidArgumentException(`Both userContexts and contexts cannot be specified.`);this.#i.verifyContextsList(t),await this.#o.verifyUserContextIdList(r);let a=new Set((0,l.unrollEvents)(e)),o=new Map,u=new Set(t.length?t.map(e=>{let t=this.#i.findTopLevelContextId(e);if(!t)throw new n.InvalidArgumentException(`Invalid context id`);return t}):this.#i.getTopLevelContexts().map(e=>e.id));for(let e of a){let t=new Set(this.#i.getTopLevelContexts().map(e=>e.id).filter(t=>this.#r.isSubscribedTo(e,t)));o.set(e,(0,l.difference)(u,t))}let d=this.#r.subscribe(e,t,r,i);for(let e of d.eventNames)for(let t of u)for(let n of this.#u(e,t,i))this.emit(`event`,{message:s.OutgoingMessage.createFromPromise(n.event,i),event:e}),this.#l(n,i,e);for(let[e,t]of o)for(let n of t)this.#a.get(e).forEach(e=>e(n));return await this.toggleModulesIfNeeded(),d.id}async unsubscribe(e,t){for(let t of e)(0,c.assertSupportedEvent)(t);this.#r.unsubscribe(e,t),await this.toggleModulesIfNeeded()}async unsubscribeByIds(e){this.#r.unsubscribeById(e),await this.toggleModulesIfNeeded()}async toggleModulesIfNeeded(){await Promise.all(this.#i.getAllContexts().map(async e=>await e.toggleModulesIfNeeded()))}clearBufferedEvents(e){for(let n of d.keys()){let r=t.#s(n,e);this.#t.delete(r)}}#c(e,n){if(!d.has(n))return;let i=t.#s(n,e.contextId);this.#t.has(i)||this.#t.set(i,new r.Buffer(d.get(n))),this.#t.get(i).add(e),this.#e.get(n).add(e.contextId)}#l(e,n,r){if(!d.has(r))return;let i=t.#s(r,e.contextId),a=Math.max(this.#n.get(i)?.get(n)??0,e.id),o=this.#n.get(i);o?o.set(n,a):this.#n.set(i,new Map([[n,a]]))}#u(e,n,r){let i=t.#s(e,n),a=this.#n.get(i)?.get(r)??-1/0,o=this.#t.get(i)?.get().filter(e=>e.id>a)??[];return n===null&&Array.from(this.#e.get(e).keys()).filter(e=>e!==null&&this.#i.hasContext(e)).map(t=>this.#u(e,t,r)).forEach(e=>o.push(...e)),o.sort((e,t)=>e.id-t.id)}};e.EventManager=f,t=f})),pn=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.SpeculationProcessor=void 0;let t=L();e.SpeculationProcessor=class{#e;#t;constructor(e,t){this.#e=e,this.#t=t}onCdpTargetCreated(e){e.cdpClient.on(`Preload.prefetchStatusUpdated`,n=>{let r;switch(n.status){case`Running`:r=`pending`;break;case`Ready`:r=`ready`;break;case`Success`:r=`success`;break;case`Failure`:r=`failure`;break;default:this.#t?.(t.LogType.debugWarn,`Unknown prefetch status: ${n.status}`);return}this.#e.registerEvent({type:`event`,method:`speculation.prefetchStatusUpdated`,params:{context:n.initiatingFrameId,url:n.prefetchUrl,status:r}},e.id)})}}})),mn=f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.BidiServer=void 0;let t=nt(),n=L(),r=rt(),i=Ft(),a=It(),o=Rt(),s=zt(),c=rn(),l=an(),u=tn(),d=on(),f=sn(),p=fn(),m=pn();e.BidiServer=class e extends t.EventEmitter{#e;#t;#n;#r;#i=new l.BrowsingContextStorage;#a=new f.RealmStorage;#o=new d.PreloadScriptStorage;#s;#c;#l;#u=e=>{this.#n.processCommand(e).catch(e=>{this.#l?.(n.LogType.debugError,e)})};#d=async e=>{let t=e.message;e.googChannel!==null&&(t[`goog:channel`]=e.googChannel),await this.#t.sendMessage(t)};constructor(e,t,n,l,d,f,h){super(),this.#l=h,this.#e=new r.ProcessingQueue(this.#d,this.#l),this.#t=e,this.#t.setOnMessage(this.#u);let g=new o.ContextConfigStorage,_=new s.UserContextStorage(n);this.#r=new p.EventManager(this.#i,_);let v=new u.NetworkStorage(this.#r,this.#i,n,h);this.#s=new a.BluetoothProcessor(this.#r,this.#i),this.#c=new m.SpeculationProcessor(this.#r,this.#l),this.#n=new i.CommandProcessor(t,n,this.#r,this.#i,this.#a,this.#o,v,g,this.#s,_,f,async e=>{await n.sendCommand(`Security.setIgnoreCertificateErrors`,{ignore:e.acceptInsecureCerts??!1}),g.updateGlobalConfig({acceptInsecureCerts:e.acceptInsecureCerts??!1,userPromptHandler:e.unhandledPromptBehavior,prerenderingDisabled:e?.[`goog:prerenderingDisabled`]??!1,disableNetworkDurableMessages:e?.[`goog:disableNetworkDurableMessages`]}),new c.CdpTargetManager(t,n,l,this.#r,this.#i,this.#a,v,g,this.#s,this.#c,this.#o,d,h),await n.sendCommand(`Target.setDiscoverTargets`,{discover:!0}),await n.sendCommand(`Target.setAutoAttach`,{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0,filter:[{type:`page`,exclude:!0},{}]}),await this.#f()},this.#l),this.#r.on(`event`,({message:e,event:t})=>{this.emitOutgoingMessage(e,t)}),this.#n.on(`response`,({message:e,event:t})=>{this.emitOutgoingMessage(e,t)})}static async createAndStart(t,n,r,i,a,o){let[{browserContextIds:s},{targetInfos:c}]=await Promise.all([r.sendCommand(`Target.getBrowserContexts`),r.sendCommand(`Target.getTargets`),r.sendCommand(`Browser.setDownloadBehavior`,{behavior:`default`,eventsEnabled:!0})]),l=`default`;for(let e of c)if(e.browserContextId&&!s.includes(e.browserContextId)){l=e.browserContextId;break}return new e(t,n,r,i,l,a,o)}emitOutgoingMessage(e,t){this.#e.add(e,t)}close(){this.#t.close()}async#f(){await Promise.all(this.#i.getTopLevelContexts().map(e=>e.lifecycleLoaded()))}}})),hn=i(f((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.OutgoingMessage=e.EventEmitter=e.BidiServer=void 0;var t=mn();Object.defineProperty(e,`BidiServer`,{enumerable:!0,get:function(){return t.BidiServer}});var n=nt();Object.defineProperty(e,`EventEmitter`,{enumerable:!0,get:function(){return n.EventEmitter}});var r=Pt();Object.defineProperty(e,`OutgoingMessage`,{enumerable:!0,get:function(){return r.OutgoingMessage}})}))(),1),gn=class e extends le{static sessions=new Map;#e=!1;#t;#n=v.create();frame;constructor(t,n){if(super(),this.frame=t,!this.frame.page().browser().cdpSupported)return;let r=this.frame.page().browser().connection;this.#t=r,n?(this.#n.resolve(n),e.sessions.set(n,this)):(async()=>{try{let{result:n}=await r.send(`goog:cdp.getSession`,{context:t._id});this.#n.resolve(n.session),e.sessions.set(n.session,this)}catch(e){this.#n.reject(e)}})(),e.sessions.set(this.#n.value(),this)}connection(){}get detached(){return this.#e}async send(e,t,n){if(this.#t===void 0)throw new P(`CDP support is required for this feature. The current browser does not support CDP.`);if(this.#e)throw new ye(`Protocol error (${e}): Session closed. Most likely the page has been closed.`);let r=await this.#n.valueOrThrow(),{result:i}=await this.#t.send(`goog:cdp.sendCommand`,{method:e,params:t,session:r},n?.timeout);return i.result}async detach(){if(!(this.#t===void 0||this.#t.closed||this.#e))try{await this.frame.client.send(`Target.detachFromTarget`,{sessionId:this.id()})}finally{this.onClose()}}onClose=()=>{e.sessions.delete(this.id()),this.#e=!0};id(){let e=this.#n.value();return typeof e==`string`?e:``}};
/**
* @license
* Copyright 2017 Google Inc.
* SPDX-License-Identifier: Apache-2.0
*/
const _n=Te(`puppeteer:webDriverBiDi:SEND ‚ñ∫`),vn=Te(`puppeteer:webDriverBiDi:RECV ‚óÄ`);var yn=class extends j{#e;#t;#n;#r=0;#i=!1;#a;#o=[];constructor(e,t,n,r=0,i){super(),this.#e=e,this.#n=r,this.#r=i??18e4,this.#a=new Ae(n),this.#t=t,this.#t.onmessage=this.onMessage.bind(this),this.#t.onclose=this.unbind.bind(this)}get closed(){return this.#i}get url(){return this.#e}pipeTo(e){this.#o.push(e)}#s(e){for(let t in e)t.startsWith(`goog:`)?delete e[t]:typeof e[t]==`object`&&e[t]!==null&&this.#s(e[t])}emit(e,t){process.env.PUPPETEER_WEBDRIVER_BIDI_ONLY===`true`&&this.#s(t);for(let n of this.#o)n.emit(e,t);return super.emit(e,t)}send(e,t,n){return this.#i?Promise.reject(new je(`Connection closed.`)):this.#a.create(e,n??this.#r,n=>{let r=JSON.stringify({id:n,method:e,params:t});_n(r),this.#t.send(r)})}async onMessage(e){this.#n&&await new Promise(e=>setTimeout(e,this.#n)),vn(e);let t=JSON.parse(e);if(`type`in t)switch(t.type){case`success`:this.#a.resolve(t.id,t);return;case`error`:if(t.id===null)break;this.#a.reject(t.id,bn(t),`${t.error}: ${t.message}`);return;case`event`:if(xn(t)){gn.sessions.get(t.params.session)?.emit(t.params.event,t.params.params);return}this.emit(t.method,t.params);return}`id`in t&&this.#a.reject(t.id,`Protocol Error. Message is not in BiDi protocol format: '${e}'`,t.message),k(t)}unbind(){this.#i||(this.#i=!0,this.#t.onmessage=()=>{},this.#t.onclose=()=>{},this.#a.clear())}dispose(){this.unbind(),this.#t.close()}getPendingProtocolErrors(){return this.#a.getPendingProtocolErrors()}};function bn(e){let t=`${e.error} ${e.message}`;return e.stacktrace&&(t+=` ${e.stacktrace}`),t}function xn(e){return e.method.startsWith(`goog:cdp.`)}
/**
* @license
* Copyright 2023 Google Inc.
* SPDX-License-Identifier: Apache-2.0
*/
const Sn=(e,...t)=>{Te(`bidi:${e}`)(t)};async function Cn(e){let t=new En,n=new wn(e),r={send(e){t.emitMessage(JSON.parse(e))},close(){a.close(),n.close(),e.dispose()},onmessage(e){}};t.on(`bidiResponse`,e=>{r.onmessage(JSON.stringify(e))});let i=new yn(e.url(),r,e._idGenerator,e.delay,e.timeout),a=await hn.BidiServer.createAndStart(t,n,n.browserClient(),``,void 0,Sn);return i}var wn=class{#e;#t=new Map;#n;constructor(e){this.#e=e,this.#n=new Tn(e)}browserClient(){return this.#n}getCdpClient(e){let t=this.#e.session(e);if(!t)throw Error(`Unknown CDP session with id ${e}`);if(!this.#t.has(t)){let n=new Tn(t,e,this.#n);return this.#t.set(t,n),n}return this.#t.get(t)}close(){this.#n.close();for(let e of this.#t.values())e.close()}},Tn=class extends hn.EventEmitter{#e=!1;#t;sessionId=void 0;#n;constructor(e,t,n){super(),this.#t=e,this.sessionId=t,this.#n=n,this.#t.on(`*`,this.#r)}browserClient(){return this.#n}#r=(e,t)=>{this.emit(e,t)};async sendCommand(e,...t){if(!this.#e)try{return await this.#t.send(e,...t)}catch(e){if(this.#e)return;throw e}}close(){this.#t.off(`*`,this.#r),this.#e=!0}isCloseError(e){return e instanceof ye}},En=class extends hn.EventEmitter{#e=async e=>{};emitMessage(e){this.#e(e)}setOnMessage(e){this.#e=e}async sendMessage(e){this.emit(`bidiResponse`,e)}close(){this.#e=async e=>{}}},Dn=function(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0},On=function(e,t,n,r,i,a){function o(e){if(e!==void 0&&typeof e!=`function`)throw TypeError(`Function expected`);return e}for(var s=r.kind,c=s===`getter`?`get`:s===`setter`?`set`:`value`,l=!t&&e?r.static?e:e.prototype:null,u=t||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d,f=!1,p=n.length-1;p>=0;p--){var m={};for(var h in r)m[h]=h===`access`?{}:r[h];for(var h in r.access)m.access[h]=r.access[h];m.addInitializer=function(e){if(f)throw TypeError(`Cannot add initializers after decoration has completed`);a.push(o(e||null))};var g=(0,n[p])(s===`accessor`?{get:u.get,set:u.set}:u[c],m);if(s===`accessor`){if(g===void 0)continue;if(typeof g!=`object`||!g)throw TypeError(`Object expected`);(d=o(g.get))&&(u.get=d),(d=o(g.set))&&(u.set=d),(d=o(g.init))&&i.unshift(d)}else (d=o(g))&&(s===`field`?i.unshift(d):u[c]=d)}l&&Object.defineProperty(l,r.name,u),f=!0};let kn=(()=>{let e=j,t=[],n;return class r extends e{static{let r=typeof Symbol==`function`&&Symbol.metadata?Object.create(e[Symbol.metadata]??null):void 0;On(this,null,n,{kind:`method`,name:`dispose`,static:!1,private:!1,access:{has:e=>`dispose`in e,get:e=>e.dispose},metadata:r},null,t),r&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:r})}static from(e){let t=new r(e);return t.#a(),t}#e=Dn(this,t);#t;#n;#r=new I;#i;constructor(e){super(),this.#n=e}#a(){let e=this.#r.use(new j(this.#n));e.once(`closed`,()=>{this.emit(`failed`,{url:this.#n.url,timestamp:new Date}),this.dispose()}),e.on(`request`,({request:e})=>{e.navigation===void 0||!this.#o(e.navigation)||(this.#e=e,this.emit(`request`,e),this.#r.use(new j(this.#e)).on(`redirect`,e=>{this.#e=e}))});let t=this.#r.use(new j(this.#s));t.on(`browsingContext.navigationStarted`,e=>{e.context!==this.#n.id||this.#t!==void 0||(this.#t=r.from(this.#n))});for(let e of[`browsingContext.domContentLoaded`,`browsingContext.load`])t.on(e,e=>{e.context!==this.#n.id||e.navigation===null||!this.#o(e.navigation)||this.dispose()});for(let[e,n]of[[`browsingContext.fragmentNavigated`,`fragment`],[`browsingContext.navigationFailed`,`failed`],[`browsingContext.navigationAborted`,`aborted`]])t.on(e,e=>{e.context!==this.#n.id||!this.#o(e.navigation)||(this.emit(n,{url:e.url,timestamp:new Date(e.timestamp)}),this.dispose())})}#o(e){return this.#t!==void 0&&!this.#t.disposed?!1:this.#i===void 0?(this.#i=e,!0):this.#i===e}get#s(){return this.#n.userContext.browser.session}get disposed(){return this.#r.disposed}get request(){return this.#e}get navigation(){return this.#t}dispose(){this[O]()}[(n=[C],O)](){this.#r.dispose(),super[O]()}}})();
/**
* @license
* Copyright 2024 Google Inc.
* SPDX-License-Identifier: Apache-2.0
*/
var An=function(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0},H=function(e,t,n,r,i,a){function o(e){if(e!==void 0&&typeof e!=`function`)throw TypeError(`Function expected`);return e}for(var s=r.kind,c=s===`getter`?`get`:s===`setter`?`set`:`value`,l=!t&&e?r.static?e:e.prototype:null,u=t||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d,f=!1,p=n.length-1;p>=0;p--){var m={};for(var h in r)m[h]=h===`access`?{}:r[h];for(var h in r.access)m.access[h]=r.access[h];m.addInitializer=function(e){if(f)throw TypeError(`Cannot add initializers after decoration has completed`);a.push(o(e||null))};var g=(0,n[p])(s===`accessor`?{get:u.get,set:u.set}:u[c],m);if(s===`accessor`){if(g===void 0)continue;if(typeof g!=`object`||!g)throw TypeError(`Object expected`);(d=o(g.get))&&(u.get=d),(d=o(g.set))&&(u.set=d),(d=o(g.init))&&i.unshift(d)}else (d=o(g))&&(s===`field`?i.unshift(d):u[c]=d)}l&&Object.defineProperty(l,r.name,u),f=!0},jn;let Mn=(()=>{let e=j,t=[],n,r,i,a,o;return class extends e{static{let s=typeof Symbol==`function`&&Symbol.metadata?Object.create(e[Symbol.metadata]??null):void 0;H(this,null,n,{kind:`method`,name:`dispose`,static:!1,private:!1,access:{has:e=>`dispose`in e,get:e=>e.dispose},metadata:s},null,t),H(this,null,r,{kind:`method`,name:`disown`,static:!1,private:!1,access:{has:e=>`disown`in e,get:e=>e.disown},metadata:s},null,t),H(this,null,i,{kind:`method`,name:`callFunction`,static:!1,private:!1,access:{has:e=>`callFunction`in e,get:e=>e.callFunction},metadata:s},null,t),H(this,null,a,{kind:`method`,name:`evaluate`,static:!1,private:!1,access:{has:e=>`evaluate`in e,get:e=>e.evaluate},metadata:s},null,t),H(this,null,o,{kind:`method`,name:`resolveExecutionContextId`,static:!1,private:!1,access:{has:e=>`resolveExecutionContextId`in e,get:e=>e.resolveExecutionContextId},metadata:s},null,t),s&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s})}#e=An(this,t);disposables=new I;id;origin;executionContextId;constructor(e,t){super(),this.id=e,this.origin=t}get disposed(){return this.#e!==void 0}get target(){return{realm:this.id}}dispose(e){this.#e=e,this[O]()}async disown(e){await this.session.send(`script.disown`,{target:this.target,handles:e})}async callFunction(e,t,n={}){let{result:r}=await this.session.send(`script.callFunction`,{functionDeclaration:e,awaitPromise:t,target:this.target,...n});return r}async evaluate(e,t,n={}){let{result:r}=await this.session.send(`script.evaluate`,{expression:e,awaitPromise:t,target:this.target,...n});return r}async resolveExecutionContextId(){if(!this.executionContextId){let{result:e}=await this.session.connection.send(`goog:cdp.resolveRealm`,{realm:this.id});this.executionContextId=e.executionContextId}return this.executionContextId}[(n=[C],r=[d(e=>e.#e)],i=[d(e=>e.#e)],a=[d(e=>e.#e)],o=[d(e=>e.#e)],O)](){this.#e??=`Realm already destroyed, probably because all associated browsing contexts closed.`,this.emit(`destroyed`,{reason:this.#e}),this.disposables.dispose(),super[O]()}}})();var Nn=class e extends Mn{static from(t,n){let r=new e(t,n);return r.#t(),r}browsingContext;sandbox;#e=new Map;constructor(e,t){super(``,``),this.browsingContext=e,this.sandbox=t}#t(){this.disposables.use(new j(this.browsingContext)).on(`closed`,({reason:e})=>{this.dispose(e)});let e=this.disposables.use(new j(this.session));e.on(`script.realmCreated`,e=>{e.type!==`window`||e.context!==this.browsingContext.id||e.sandbox!==this.sandbox||(this.id=e.realm,this.origin=e.origin,this.executionContextId=void 0,this.emit(`updated`,this))}),e.on(`script.realmCreated`,e=>{if(e.type!==`dedicated-worker`||!e.owners.includes(this.id))return;let t=Pn.from(this,e.realm,e.origin);this.#e.set(t.id,t);let n=this.disposables.use(new j(t));n.once(`destroyed`,()=>{n.removeAllListeners(),this.#e.delete(t.id)}),this.emit(`worker`,t)})}get session(){return this.browsingContext.userContext.browser.session}get target(){return{context:this.browsingContext.id,sandbox:this.sandbox}}},Pn=class extends Mn{static from(e,t,n){let r=new jn(e,t,n);return r.#t(),r}#e=new Map;owners;constructor(e,t,n){super(t,n),this.owners=new Set([e])}#t(){let e=this.disposables.use(new j(this.session));e.on(`script.realmDestroyed`,e=>{e.realm===this.id&&this.dispose(`Realm already destroyed.`)}),e.on(`script.realmCreated`,e=>{if(e.type!==`dedicated-worker`||!e.owners.includes(this.id))return;let t=jn.from(this,e.realm,e.origin);this.#e.set(t.id,t),this.disposables.use(new j(t)).once(`destroyed`,()=>{this.#e.delete(t.id)}),this.emit(`worker`,t)})}get session(){return this.owners.values().next().value.session}};jn=Pn;var Fn=class e extends Mn{static from(t,n,r){let i=new e(t,n,r);return i.#t(),i}#e=new Map;browser;constructor(e,t,n){super(t,n),this.browser=e}#t(){let e=this.disposables.use(new j(this.session));e.on(`script.realmDestroyed`,e=>{e.realm===this.id&&this.dispose(`Realm already destroyed.`)}),e.on(`script.realmCreated`,e=>{if(e.type!==`dedicated-worker`||!e.owners.includes(this.id))return;let t=Pn.from(this,e.realm,e.origin);this.#e.set(t.id,t),this.disposables.use(new j(t)).once(`destroyed`,()=>{this.#e.delete(t.id)}),this.emit(`worker`,t)})}get session(){return this.browser.session}},In=function(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0},Ln=function(e,t,n,r,i,a){function o(e){if(e!==void 0&&typeof e!=`function`)throw TypeError(`Function expected`);return e}for(var s=r.kind,c=s===`getter`?`get`:s===`setter`?`set`:`value`,l=!t&&e?r.static?e:e.prototype:null,u=t||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d,f=!1,p=n.length-1;p>=0;p--){var m={};for(var h in r)m[h]=h===`access`?{}:r[h];for(var h in r.access)m.access[h]=r.access[h];m.addInitializer=function(e){if(f)throw TypeError(`Cannot add initializers after decoration has completed`);a.push(o(e||null))};var g=(0,n[p])(s===`accessor`?{get:u.get,set:u.set}:u[c],m);if(s===`accessor`){if(g===void 0)continue;if(typeof g!=`object`||!g)throw TypeError(`Object expected`);(d=o(g.get))&&(u.get=d),(d=o(g.set))&&(u.set=d),(d=o(g.init))&&i.unshift(d)}else (d=o(g))&&(s===`field`?i.unshift(d):u[c]=d)}l&&Object.defineProperty(l,r.name,u),f=!0};let Rn=(()=>{let e=j,t=[],n;return class r extends e{static{let r=typeof Symbol==`function`&&Symbol.metadata?Object.create(e[Symbol.metadata]??null):void 0;Ln(this,null,n,{kind:`method`,name:`dispose`,static:!1,private:!1,access:{has:e=>`dispose`in e,get:e=>e.dispose},metadata:r},null,t),r&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:r})}static from(e,t){let n=new r(e,t);return n.#c(),n}#e=(In(this,t),null);#t=null;#n;#r;#i;#a;#o=new I;#s;constructor(e,t){super(),this.#a=e,this.#s=t}#c(){this.#o.use(new j(this.#a)).once(`closed`,({reason:e})=>{this.#n=e,this.emit(`error`,this.#n),this.dispose()});let e=this.#o.use(new j(this.#l));e.on(`network.beforeRequestSent`,e=>{if(e.context!==this.#a.id||e.request.request!==this.id)return;let t=this.#s.request.headers.find(e=>e.name.toLowerCase()===`authorization`),n=e.request.headers.find(e=>e.name.toLowerCase()===`authorization`)&&!t;e.redirectCount!==this.#s.redirectCount+1&&!n||(this.#r=r.from(this.#a,e),this.emit(`redirect`,this.#r),this.dispose())}),e.on(`network.authRequired`,e=>{e.context!==this.#a.id||e.request.request!==this.id||!e.isBlocked||this.emit(`authenticate`,void 0)}),e.on(`network.fetchError`,e=>{e.context!==this.#a.id||e.request.request!==this.id||this.#s.redirectCount!==e.redirectCount||(this.#n=e.errorText,this.emit(`error`,this.#n),this.dispose())}),e.on(`network.responseCompleted`,e=>{e.context!==this.#a.id||e.request.request!==this.id||this.#s.redirectCount!==e.redirectCount||(this.#i=e.response,this.#s.request.timings=e.request.timings,this.emit(`success`,this.#i),!(this.#i.status>=300&&this.#i.status<400)&&this.dispose())})}get#l(){return this.#a.userContext.browser.session}get disposed(){return this.#o.disposed}get error(){return this.#n}get headers(){return this.#s.request.headers}get id(){return this.#s.request.request}get initiator(){return{...this.#s.initiator,url:this.#s.request[`goog:resourceInitiator`]?.url,stack:this.#s.request[`goog:resourceInitiator`]?.stack}}get method(){return this.#s.request.method}get navigation(){return this.#s.navigation??void 0}get redirect(){return this.#r}get lastRedirect(){let e=this.#r;for(;e;){if(e&&!e.#r)return e;e=e.#r}return e}get response(){return this.#i}get url(){return this.#s.request.url}get isBlocked(){return this.#s.isBlocked}get resourceType(){return this.#s.request[`goog:resourceType`]??void 0}get postData(){return this.#s.request[`goog:postData`]??void 0}get hasPostData(){return(this.#s.request.bodySize??0)>0}async continueRequest({url:e,method:t,headers:n,cookies:r,body:i}){await this.#l.send(`network.continueRequest`,{request:this.id,url:e,method:t,headers:n,body:i,cookies:r})}async failRequest(){await this.#l.send(`network.failRequest`,{request:this.id})}async provideResponse({statusCode:e,reasonPhrase:t,headers:n,body:r}){await this.#l.send(`network.provideResponse`,{request:this.id,statusCode:e,reasonPhrase:t,headers:n,body:r})}async fetchPostData(){if(this.hasPostData)return this.#t||=(async()=>{let e=await this.#l.send(`network.getData`,{dataType:`request`,request:this.id});if(e.result.bytes.type===`string`)return e.result.bytes.value;throw new P(`Collected request body data of type ${e.result.bytes.type} is not supported`)})(),await this.#t}async getResponseContent(){return this.#e||=(async()=>{try{let e=await this.#l.send(`network.getData`,{dataType:`response`,request:this.id});return pe(e.result.bytes.value,e.result.bytes.type===`base64`)}catch(e){throw e instanceof We&&e.originalMessage.includes(`No resource with given identifier found`)?new We(`Could not load response body for this request. This might happen if the request is a preflight request.`):e}})(),await this.#e}async continueWithAuth(e){e.action===`provideCredentials`?await this.#l.send(`network.continueWithAuth`,{request:this.id,action:e.action,credentials:e.credentials}):await this.#l.send(`network.continueWithAuth`,{request:this.id,action:e.action})}dispose(){this[O]()}[(n=[C],O)](){this.#o.dispose(),super[O]()}timing(){return this.#s.request.timings}}})();
/**
* @license
* Copyright 2024 Google Inc.
* SPDX-License-Identifier: Apache-2.0
*/
var zn=function(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0},Bn=function(e,t,n,r,i,a){function o(e){if(e!==void 0&&typeof e!=`function`)throw TypeError(`Function expected`);return e}for(var s=r.kind,c=s===`getter`?`get`:s===`setter`?`set`:`value`,l=!t&&e?r.static?e:e.prototype:null,u=t||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d,f=!1,p=n.length-1;p>=0;p--){var m={};for(var h in r)m[h]=h===`access`?{}:r[h];for(var h in r.access)m.access[h]=r.access[h];m.addInitializer=function(e){if(f)throw TypeError(`Cannot add initializers after decoration has completed`);a.push(o(e||null))};var g=(0,n[p])(s===`accessor`?{get:u.get,set:u.set}:u[c],m);if(s===`accessor`){if(g===void 0)continue;if(typeof g!=`object`||!g)throw TypeError(`Object expected`);(d=o(g.get))&&(u.get=d),(d=o(g.set))&&(u.set=d),(d=o(g.init))&&i.unshift(d)}else (d=o(g))&&(s===`field`?i.unshift(d):u[c]=d)}l&&Object.defineProperty(l,r.name,u),f=!0};let Vn=(()=>{let e=j,t=[],n,r;return class i extends e{static{let i=typeof Symbol==`function`&&Symbol.metadata?Object.create(e[Symbol.metadata]??null):void 0;Bn(this,null,n,{kind:`method`,name:`dispose`,static:!1,private:!1,access:{has:e=>`dispose`in e,get:e=>e.dispose},metadata:i},null,t),Bn(this,null,r,{kind:`method`,name:`handle`,static:!1,private:!1,access:{has:e=>`handle`in e,get:e=>e.handle},metadata:i},null,t),i&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:i})}static from(e,t){let n=new i(e,t);return n.#r(),n}#e=zn(this,t);#t;#n=new I;browsingContext;info;constructor(e,t){super(),this.browsingContext=e,this.info=t}#r(){this.#n.use(new j(this.browsingContext)).once(`closed`,({reason:e})=>{this.dispose(`User prompt already closed: ${e}`)}),this.#n.use(new j(this.#i)).on(`browsingContext.userPromptClosed`,e=>{e.context===this.browsingContext.id&&(this.#t=e,this.emit(`handled`,e),this.dispose(`User prompt already handled.`))})}get#i(){return this.browsingContext.userContext.browser.session}get closed(){return this.#e!==void 0}get disposed(){return this.closed}get handled(){return this.info.handler===`accept`||this.info.handler===`dismiss`?!0:this.#t!==void 0}get result(){return this.#t}dispose(e){this.#e=e,this[O]()}async handle(e={}){return await this.#i.send(`browsingContext.handleUserPrompt`,{...e,context:this.info.context}),this.#t}[(n=[C],r=[d(e=>e.#e)],O)](){this.#e??=`User prompt already closed, probably because the associated browsing context was destroyed.`,this.emit(`closed`,{reason:this.#e}),this.#n.dispose(),super[O]()}}})();
/**
* @license
* Copyright 2024 Google Inc.
* SPDX-License-Identifier: Apache-2.0
*/
var Hn=function(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0},U=function(e,t,n,r,i,a){function o(e){if(e!==void 0&&typeof e!=`function`)throw TypeError(`Function expected`);return e}for(var s=r.kind,c=s===`getter`?`get`:s===`setter`?`set`:`value`,l=!t&&e?r.static?e:e.prototype:null,u=t||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d,f=!1,p=n.length-1;p>=0;p--){var m={};for(var h in r)m[h]=h===`access`?{}:r[h];for(var h in r.access)m.access[h]=r.access[h];m.addInitializer=function(e){if(f)throw TypeError(`Cannot add initializers after decoration has completed`);a.push(o(e||null))};var g=(0,n[p])(s===`accessor`?{get:u.get,set:u.set}:u[c],m);if(s===`accessor`){if(g===void 0)continue;if(typeof g!=`object`||!g)throw TypeError(`Object expected`);(d=o(g.get))&&(u.get=d),(d=o(g.set))&&(u.set=d),(d=o(g.init))&&i.unshift(d)}else (d=o(g))&&(s===`field`?i.unshift(d):u[c]=d)}l&&Object.defineProperty(l,r.name,u),f=!0};let Un=(()=>{let e=j,t=[],n,r,i,a,o,s,c,l,u,f,p,m,h,g,_,v,y,b,x,S,w,T,E,ee,D,te,ne;return class re extends e{static{let C=typeof Symbol==`function`&&Symbol.metadata?Object.create(e[Symbol.metadata]??null):void 0;te=[d(e=>e.#t)],ne=[d(e=>e.#t)],U(this,null,n,{kind:`method`,name:`dispose`,static:!1,private:!1,access:{has:e=>`dispose`in e,get:e=>e.dispose},metadata:C},null,t),U(this,null,r,{kind:`method`,name:`activate`,static:!1,private:!1,access:{has:e=>`activate`in e,get:e=>e.activate},metadata:C},null,t),U(this,null,i,{kind:`method`,name:`captureScreenshot`,static:!1,private:!1,access:{has:e=>`captureScreenshot`in e,get:e=>e.captureScreenshot},metadata:C},null,t),U(this,null,a,{kind:`method`,name:`close`,static:!1,private:!1,access:{has:e=>`close`in e,get:e=>e.close},metadata:C},null,t),U(this,null,o,{kind:`method`,name:`traverseHistory`,static:!1,private:!1,access:{has:e=>`traverseHistory`in e,get:e=>e.traverseHistory},metadata:C},null,t),U(this,null,s,{kind:`method`,name:`navigate`,static:!1,private:!1,access:{has:e=>`navigate`in e,get:e=>e.navigate},metadata:C},null,t),U(this,null,c,{kind:`method`,name:`reload`,static:!1,private:!1,access:{has:e=>`reload`in e,get:e=>e.reload},metadata:C},null,t),U(this,null,l,{kind:`method`,name:`setCacheBehavior`,static:!1,private:!1,access:{has:e=>`setCacheBehavior`in e,get:e=>e.setCacheBehavior},metadata:C},null,t),U(this,null,u,{kind:`method`,name:`print`,static:!1,private:!1,access:{has:e=>`print`in e,get:e=>e.print},metadata:C},null,t),U(this,null,f,{kind:`method`,name:`handleUserPrompt`,static:!1,private:!1,access:{has:e=>`handleUserPrompt`in e,get:e=>e.handleUserPrompt},metadata:C},null,t),U(this,null,p,{kind:`method`,name:`setViewport`,static:!1,private:!1,access:{has:e=>`setViewport`in e,get:e=>e.setViewport},metadata:C},null,t),U(this,null,m,{kind:`method`,name:`performActions`,static:!1,private:!1,access:{has:e=>`performActions`in e,get:e=>e.performActions},metadata:C},null,t),U(this,null,h,{kind:`method`,name:`releaseActions`,static:!1,private:!1,access:{has:e=>`releaseActions`in e,get:e=>e.releaseActions},metadata:C},null,t),U(this,null,g,{kind:`method`,name:`createWindowRealm`,static:!1,private:!1,access:{has:e=>`createWindowRealm`in e,get:e=>e.createWindowRealm},metadata:C},null,t),U(this,null,_,{kind:`method`,name:`addPreloadScript`,static:!1,private:!1,access:{has:e=>`addPreloadScript`in e,get:e=>e.addPreloadScript},metadata:C},null,t),U(this,null,v,{kind:`method`,name:`addIntercept`,static:!1,private:!1,access:{has:e=>`addIntercept`in e,get:e=>e.addIntercept},metadata:C},null,t),U(this,null,y,{kind:`method`,name:`removePreloadScript`,static:!1,private:!1,access:{has:e=>`removePreloadScript`in e,get:e=>e.removePreloadScript},metadata:C},null,t),U(this,null,b,{kind:`method`,name:`setGeolocationOverride`,static:!1,private:!1,access:{has:e=>`setGeolocationOverride`in e,get:e=>e.setGeolocationOverride},metadata:C},null,t),U(this,null,x,{kind:`method`,name:`setTimezoneOverride`,static:!1,private:!1,access:{has:e=>`setTimezoneOverride`in e,get:e=>e.setTimezoneOverride},metadata:C},null,t),U(this,null,S,{kind:`method`,name:`setScreenOrientationOverride`,static:!1,private:!1,access:{has:e=>`setScreenOrientationOverride`in e,get:e=>e.setScreenOrientationOverride},metadata:C},null,t),U(this,null,w,{kind:`method`,name:`getCookies`,static:!1,private:!1,access:{has:e=>`getCookies`in e,get:e=>e.getCookies},metadata:C},null,t),U(this,null,T,{kind:`method`,name:`setCookie`,static:!1,private:!1,access:{has:e=>`setCookie`in e,get:e=>e.setCookie},metadata:C},null,t),U(this,null,E,{kind:`method`,name:`setFiles`,static:!1,private:!1,access:{has:e=>`setFiles`in e,get:e=>e.setFiles},metadata:C},null,t),U(this,null,ee,{kind:`method`,name:`subscribe`,static:!1,private:!1,access:{has:e=>`subscribe`in e,get:e=>e.subscribe},metadata:C},null,t),U(this,null,D,{kind:`method`,name:`addInterception`,static:!1,private:!1,access:{has:e=>`addInterception`in e,get:e=>e.addInterception},metadata:C},null,t),U(this,null,te,{kind:`method`,name:`deleteCookie`,static:!1,private:!1,access:{has:e=>`deleteCookie`in e,get:e=>e.deleteCookie},metadata:C},null,t),U(this,null,ne,{kind:`method`,name:`locateNodes`,static:!1,private:!1,access:{has:e=>`locateNodes`in e,get:e=>e.locateNodes},metadata:C},null,t),C&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:C})}static from(e,t,n,r,i){let a=new re(e,t,n,r,i);return a.#c(),a}#e=Hn(this,t);#t;#n;#r=new Map;#i=new I;#a=new Map;#o=new Map;defaultRealm;id;parent;userContext;originalOpener;#s={javaScriptEnabled:!0};constructor(e,t,n,r,i){super(),this.#n=r,this.id=n,this.parent=t,this.userContext=e,this.originalOpener=i,this.defaultRealm=this.#u()}#c(){this.#i.use(new j(this.userContext)).once(`closed`,({reason:e})=>{this.dispose(`Browsing context already closed: ${e}`)});let e=this.#i.use(new j(this.#l));e.on(`input.fileDialogOpened`,e=>{this.id===e.context&&this.emit(`filedialogopened`,e)}),e.on(`browsingContext.contextCreated`,e=>{if(e.parent!==this.id)return;let t=re.from(this.userContext,this,e.context,e.url,e.originalOpener);this.#r.set(e.context,t);let n=this.#i.use(new j(t));n.once(`closed`,()=>{n.removeAllListeners(),this.#r.delete(t.id)}),this.emit(`browsingcontext`,{browsingContext:t})}),e.on(`browsingContext.contextDestroyed`,e=>{e.context===this.id&&this.dispose(`Browsing context already closed.`)}),e.on(`browsingContext.historyUpdated`,e=>{e.context===this.id&&(this.#n=e.url,this.emit(`historyUpdated`,void 0))}),e.on(`browsingContext.domContentLoaded`,e=>{e.context===this.id&&(this.#n=e.url,this.emit(`DOMContentLoaded`,void 0))}),e.on(`browsingContext.load`,e=>{e.context===this.id&&(this.#n=e.url,this.emit(`load`,void 0))}),e.on(`browsingContext.navigationStarted`,e=>{if(e.context!==this.id)return;for(let[e,t]of this.#o)t.disposed&&this.#o.delete(e);if(this.#e!==void 0&&!this.#e.disposed)return;this.#e=kn.from(this);let t=this.#i.use(new j(this.#e));for(let e of[`fragment`,`failed`,`aborted`])t.once(e,({url:e})=>{t[O](),this.#n=e});this.emit(`navigation`,{navigation:this.#e})}),e.on(`network.beforeRequestSent`,e=>{if(e.context!==this.id||this.#o.has(e.request.request))return;let t=Rn.from(this,e);this.#o.set(t.id,t),this.emit(`request`,{request:t})}),e.on(`log.entryAdded`,e=>{e.source.context===this.id&&this.emit(`log`,{entry:e})}),e.on(`browsingContext.userPromptOpened`,e=>{if(e.context!==this.id)return;let t=Vn.from(this,e);this.emit(`userprompt`,{userPrompt:t})})}get#l(){return this.userContext.browser.session}get children(){return this.#r.values()}get closed(){return this.#t!==void 0}get disposed(){return this.closed}get realms(){let e=this;return(function*(){yield e.defaultRealm,yield*e.#a.values()})()}get top(){let e=this;for(let{parent:t}=e;t;{parent:t}=e)e=t;return e}get url(){return this.#n}#u(e){let t=Nn.from(this,e);return t.on(`worker`,e=>{this.emit(`worker`,{realm:e})}),t}dispose(e){this.#t=e;for(let e of this.#r.values())e.dispose(`Parent browsing context was disposed`);this[O]()}async activate(){await this.#l.send(`browsingContext.activate`,{context:this.id})}async captureScreenshot(e={}){let{result:{data:t}}=await this.#l.send(`browsingContext.captureScreenshot`,{context:this.id,...e});return t}async close(e){await Promise.all([...this.#r.values()].map(async t=>{await t.close(e)})),await this.#l.send(`browsingContext.close`,{context:this.id,promptUnload:e})}async traverseHistory(e){await this.#l.send(`browsingContext.traverseHistory`,{context:this.id,delta:e})}async navigate(e,t){await this.#l.send(`browsingContext.navigate`,{context:this.id,url:e,wait:t})}async reload(e={}){await this.#l.send(`browsingContext.reload`,{context:this.id,...e})}async setCacheBehavior(e){await this.#l.send(`network.setCacheBehavior`,{contexts:[this.id],cacheBehavior:e})}async print(e={}){let{result:{data:t}}=await this.#l.send(`browsingContext.print`,{context:this.id,...e});return t}async handleUserPrompt(e={}){await this.#l.send(`browsingContext.handleUserPrompt`,{context:this.id,...e})}async setViewport(e={}){await this.#l.send(`browsingContext.setViewport`,{context:this.id,...e})}async performActions(e){await this.#l.send(`input.performActions`,{context:this.id,actions:e})}async releaseActions(){await this.#l.send(`input.releaseActions`,{context:this.id})}createWindowRealm(e){return this.#u(e)}async addPreloadScript(e,t={}){return await this.userContext.browser.addPreloadScript(e,{...t,contexts:[this]})}async addIntercept(e){let{result:{intercept:t}}=await this.userContext.browser.session.send(`network.addIntercept`,{...e,contexts:[this.id]});return t}async removePreloadScript(e){await this.userContext.browser.removePreloadScript(e)}async setGeolocationOverride(e){if(!(`coordinates`in e))throw Error(`Missing coordinates`);await this.userContext.browser.session.send(`emulation.setGeolocationOverride`,{coordinates:e.coordinates,contexts:[this.id]})}async setTimezoneOverride(e){e?.startsWith(`GMT`)&&(e=e?.replace(`GMT`,``)),await this.userContext.browser.session.send(`emulation.setTimezoneOverride`,{timezone:e??null,contexts:[this.id]})}async setScreenOrientationOverride(e){await this.#l.send(`emulation.setScreenOrientationOverride`,{screenOrientation:e,contexts:[this.id]})}async getCookies(e={}){let{result:{cookies:t}}=await this.#l.send(`storage.getCookies`,{...e,partition:{type:`context`,context:this.id}});return t}async setCookie(e){await this.#l.send(`storage.setCookie`,{cookie:e,partition:{type:`context`,context:this.id}})}async setFiles(e,t){await this.#l.send(`input.setFiles`,{context:this.id,element:e,files:t})}async subscribe(e){await this.#l.subscribe(e,[this.id])}async addInterception(e){await this.#l.subscribe(e,[this.id])}[(n=[C],r=[d(e=>e.#t)],i=[d(e=>e.#t)],a=[d(e=>e.#t)],o=[d(e=>e.#t)],s=[d(e=>e.#t)],c=[d(e=>e.#t)],l=[d(e=>e.#t)],u=[d(e=>e.#t)],f=[d(e=>e.#t)],p=[d(e=>e.#t)],m=[d(e=>e.#t)],h=[d(e=>e.#t)],g=[d(e=>e.#t)],_=[d(e=>e.#t)],v=[d(e=>e.#t)],y=[d(e=>e.#t)],b=[d(e=>e.#t)],x=[d(e=>e.#t)],S=[d(e=>e.#t)],w=[d(e=>e.#t)],T=[d(e=>e.#t)],E=[d(e=>e.#t)],ee=[d(e=>e.#t)],D=[d(e=>e.#t)],O)](){this.#t??=`Browsing context already closed, probably because the user context closed.`,this.emit(`closed`,{reason:this.#t}),this.#i.dispose(),super[O]()}async deleteCookie(...e){await Promise.all(e.map(async e=>{await this.#l.send(`storage.deleteCookies`,{filter:e,partition:{type:`context`,context:this.id}})}))}async locateNodes(e,t){return(await this.#l.send(`browsingContext.locateNodes`,{context:this.id,locator:e,startNodes:t.length?t:void 0})).result.nodes}async setJavaScriptEnabled(e){await this.userContext.browser.session.send(`emulation.setScriptingEnabled`,{enabled:e?null:!1,contexts:[this.id]}),this.#s.javaScriptEnabled=e}isJavaScriptEnabled(){return this.#s.javaScriptEnabled}}})();
/**
* @license
* Copyright 2024 Google Inc.
* SPDX-License-Identifier: Apache-2.0
*/
var Wn=function(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0},W=function(e,t,n,r,i,a){function o(e){if(e!==void 0&&typeof e!=`function`)throw TypeError(`Function expected`);return e}for(var s=r.kind,c=s===`getter`?`get`:s===`setter`?`set`:`value`,l=!t&&e?r.static?e:e.prototype:null,u=t||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d,f=!1,p=n.length-1;p>=0;p--){var m={};for(var h in r)m[h]=h===`access`?{}:r[h];for(var h in r.access)m.access[h]=r.access[h];m.addInitializer=function(e){if(f)throw TypeError(`Cannot add initializers after decoration has completed`);a.push(o(e||null))};var g=(0,n[p])(s===`accessor`?{get:u.get,set:u.set}:u[c],m);if(s===`accessor`){if(g===void 0)continue;if(typeof g!=`object`||!g)throw TypeError(`Object expected`);(d=o(g.get))&&(u.get=d),(d=o(g.set))&&(u.set=d),(d=o(g.init))&&i.unshift(d)}else (d=o(g))&&(s===`field`?i.unshift(d):u[c]=d)}l&&Object.defineProperty(l,r.name,u),f=!0};let Gn=(()=>{let e=j,t=[],n,r,i,a,o,s;return class c extends e{static{let c=typeof Symbol==`function`&&Symbol.metadata?Object.create(e[Symbol.metadata]??null):void 0;W(this,null,n,{kind:`method`,name:`dispose`,static:!1,private:!1,access:{has:e=>`dispose`in e,get:e=>e.dispose},metadata:c},null,t),W(this,null,r,{kind:`method`,name:`createBrowsingContext`,static:!1,private:!1,access:{has:e=>`createBrowsingContext`in e,get:e=>e.createBrowsingContext},metadata:c},null,t),W(this,null,i,{kind:`method`,name:`remove`,static:!1,private:!1,access:{has:e=>`remove`in e,get:e=>e.remove},metadata:c},null,t),W(this,null,a,{kind:`method`,name:`getCookies`,static:!1,private:!1,access:{has:e=>`getCookies`in e,get:e=>e.getCookies},metadata:c},null,t),W(this,null,o,{kind:`method`,name:`setCookie`,static:!1,private:!1,access:{has:e=>`setCookie`in e,get:e=>e.setCookie},metadata:c},null,t),W(this,null,s,{kind:`method`,name:`setPermissions`,static:!1,private:!1,access:{has:e=>`setPermissions`in e,get:e=>e.setPermissions},metadata:c},null,t),c&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:c})}static DEFAULT=`default`;static create(e,t){let n=new c(e,t);return n.#i(),n}#e=Wn(this,t);#t=new Map;#n=new I;#r;browser;constructor(e,t){super(),this.#r=t,this.browser=e}#i(){let e=this.#n.use(new j(this.browser));e.once(`closed`,({reason:e})=>{this.dispose(`User context was closed: ${e}`)}),e.once(`disconnected`,({reason:e})=>{this.dispose(`User context was closed: ${e}`)}),this.#n.use(new j(this.#a)).on(`browsingContext.contextCreated`,e=>{if(e.parent||e.userContext!==this.#r)return;let t=Un.from(this,void 0,e.context,e.url,e.originalOpener);this.#t.set(t.id,t);let n=this.#n.use(new j(t));n.on(`closed`,()=>{n.removeAllListeners(),this.#t.delete(t.id)}),this.emit(`browsingcontext`,{browsingContext:t})})}get#a(){return this.browser.session}get browsingContexts(){return this.#t.values()}get closed(){return this.#e!==void 0}get disposed(){return this.closed}get id(){return this.#r}dispose(e){this.#e=e,this[O]()}async createBrowsingContext(e,t={}){let{result:{context:n}}=await this.#a.send(`browsingContext.create`,{type:e,...t,referenceContext:t.referenceContext?.id,userContext:this.#r}),r=this.#t.get(n);return F(r,`The WebDriver BiDi implementation is failing to create a browsing context correctly.`),r}async remove(){try{await this.#a.send(`browser.removeUserContext`,{userContext:this.#r})}finally{this.dispose(`User context already closed.`)}}async getCookies(e={},t=void 0){let{result:{cookies:n}}=await this.#a.send(`storage.getCookies`,{...e,partition:{type:`storageKey`,userContext:this.#r,sourceOrigin:t}});return n}async setCookie(e,t){await this.#a.send(`storage.setCookie`,{cookie:e,partition:{type:`storageKey`,sourceOrigin:t,userContext:this.id}})}async setPermissions(e,t,n){await this.#a.send(`permissions.setPermission`,{origin:e,descriptor:t,state:n,userContext:this.#r})}[(n=[C],r=[d(e=>e.#e)],i=[d(e=>e.#e)],a=[d(e=>e.#e)],o=[d(e=>e.#e)],s=[d(e=>e.#e)],O)](){this.#e??=`User context already closed, probably because the browser disconnected/closed.`,this.emit(`closed`,{reason:this.#e}),this.#n.dispose(),super[O]()}}})();
/**
* @license
* Copyright 2023 Google Inc.
* SPDX-License-Identifier: Apache-2.0
*/
var Kn=class{static deserialize(e){if(!e){k(`Service did not produce a result.`);return}switch(e.type){case`array`:return e.value?.map(e=>this.deserialize(e));case`set`:return e.value?.reduce((e,t)=>e.add(this.deserialize(t)),new Set);case`object`:return e.value?.reduce((e,t)=>{let{key:n,value:r}=this.#t(t);return e[n]=r,e},{});case`map`:return e.value?.reduce((e,t)=>{let{key:n,value:r}=this.#t(t);return e.set(n,r)},new Map);case`promise`:return{};case`regexp`:return new RegExp(e.value.pattern,e.value.flags);case`date`:return new Date(e.value);case`undefined`:return;case`null`:return null;case`number`:return this.#e(e.value);case`bigint`:return BigInt(e.value);case`boolean`:return!!e.value;case`string`:return e.value}k(`Deserialization of type ${e.type} not supported.`)}static#e(e){switch(e){case`-0`:return-0;case`NaN`:return NaN;case`Infinity`:return 1/0;case`-Infinity`:return-1/0;default:return e}}static#t([e,t]){return{key:typeof e==`string`?e:this.deserialize(e),value:this.deserialize(t)}}},G=class e extends De{static from(t,n){return new e(t,n)}#e;realm;#t=!1;constructor(e,t){super(),this.#e=e,this.realm=t}get disposed(){return this.#t}async jsonValue(){return await this.evaluate(e=>e)}asElement(){return null}async dispose(){this.#t||(this.#t=!0,await this.realm.destroyHandles([this]))}get isPrimitiveValue(){switch(this.#e.type){case`string`:case`number`:case`bigint`:case`boolean`:case`undefined`:case`null`:return!0;default:return!1}}toString(){return this.isPrimitiveValue?`JSHandle:`+Kn.deserialize(this.#e):`JSHandle@`+this.#e.type}get id(){return`handle`in this.#e?this.#e.handle:void 0}remoteValue(){return this.#e}remoteObject(){throw new P(`Not available in WebDriver BiDi`)}},qn=function(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0},Jn=function(e,t,n,r,i,a){function o(e){if(e!==void 0&&typeof e!=`function`)throw TypeError(`Function expected`);return e}for(var s=r.kind,c=s===`getter`?`get`:s===`setter`?`set`:`value`,l=!t&&e?r.static?e:e.prototype:null,u=t||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d,f=!1,p=n.length-1;p>=0;p--){var m={};for(var h in r)m[h]=h===`access`?{}:r[h];for(var h in r.access)m.access[h]=r.access[h];m.addInitializer=function(e){if(f)throw TypeError(`Cannot add initializers after decoration has completed`);a.push(o(e||null))};var g=(0,n[p])(s===`accessor`?{get:u.get,set:u.set}:u[c],m);if(s===`accessor`){if(g===void 0)continue;if(typeof g!=`object`||!g)throw TypeError(`Object expected`);(d=o(g.get))&&(u.get=d),(d=o(g.set))&&(u.set=d),(d=o(g.init))&&i.unshift(d)}else (d=o(g))&&(s===`field`?i.unshift(d):u[c]=d)}l&&Object.defineProperty(l,r.name,u),f=!0},Yn=function(e,t,n){if(t!=null){if(typeof t!=`object`&&typeof t!=`function`)throw TypeError(`Object expected.`);var r,i;if(n){if(!Symbol.asyncDispose)throw TypeError(`Symbol.asyncDispose is not defined.`);r=t[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw TypeError(`Symbol.dispose is not defined.`);r=t[Symbol.dispose],n&&(i=r)}if(typeof r!=`function`)throw TypeError(`Object not disposable.`);i&&(r=function(){try{i.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:r,async:n})}else n&&e.stack.push({async:!0});return t},Xn=(function(e){return function(t){function n(n){t.error=t.hasError?new e(n,t.error,`An error was suppressed during disposal.`):n,t.hasError=!0}var r,i=0;function a(){for(;r=t.stack.pop();)try{if(!r.async&&i===1)return i=0,t.stack.push(r),Promise.resolve().then(a);if(r.dispose){var e=r.dispose.call(r.value);if(r.async)return i|=2,Promise.resolve(e).then(a,function(e){return n(e),a()})}else i|=1}catch(e){n(e)}if(i===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return a()}})(typeof SuppressedError==`function`?SuppressedError:function(e,t,n){var r=Error(n);return r.name=`SuppressedError`,r.error=e,r.suppressed=t,r});let K=(()=>{let e=Oe,n=[],r,i;return class a extends e{static{let a=typeof Symbol==`function`&&Symbol.metadata?Object.create(e[Symbol.metadata]??null):void 0;r=[d()],i=[d(),t],Jn(this,null,r,{kind:`method`,name:`autofill`,static:!1,private:!1,access:{has:e=>`autofill`in e,get:e=>e.autofill},metadata:a},null,n),Jn(this,null,i,{kind:`method`,name:`contentFrame`,static:!1,private:!1,access:{has:e=>`contentFrame`in e,get:e=>e.contentFrame},metadata:a},null,n),a&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a})}#e=qn(this,n);static from(e,t){return new a(e,t)}constructor(e,t){super(G.from(e,t))}get realm(){return this.handle.realm}get frame(){return this.realm.environment}remoteValue(){return this.handle.remoteValue()}async autofill(e){let t=this.frame.client,n=(await t.send(`DOM.describeNode`,{objectId:this.handle.id})).node.backendNodeId,r=this.frame._id;await t.send(`Autofill.trigger`,{fieldId:n,frameId:r,card:e.creditCard})}async contentFrame(){let e={stack:[],error:void 0,hasError:!1};try{let t=Yn(e,await this.evaluateHandle(e=>{if(e instanceof HTMLIFrameElement||e instanceof HTMLFrameElement)return e.contentWindow}),!1).remoteValue();return t.type===`window`?this.frame.page().frames().find(e=>e._id===t.value.context)??null:null}catch(t){e.error=t,e.hasError=!0}finally{Xn(e)}}async uploadFile(...e){let t=Xe.value.path;t&&(e=e.map(e=>t.win32.isAbsolute(e)||t.posix.isAbsolute(e)?e:t.resolve(e))),await this.frame.setFiles(this,e)}async*queryAXTree(e,t){let n=await this.frame.locateNodes(this,{type:`accessibility`,value:{role:t,name:e}});return yield*m.map(n,e=>Promise.resolve(a.from(e,this.realm)))}async backendNodeId(){if(!this.frame.page().browser().cdpSupported)throw new P;if(this.#e)return this.#e;let{node:e}=await this.frame.client.send(`DOM.describeNode`,{objectId:this.handle.id});return this.#e=e.backendNodeId,this.#e}}})();
/**
* @license
* Copyright 2017 Google Inc.
* SPDX-License-Identifier: Apache-2.0
*/
var Zn=class e extends se{static from(t){return new e(t)}#e;constructor(e){super(e.info.type,e.info.message,e.info.defaultValue),this.#e=e,this.handled=e.handled}async handle(e){await this.#e.handle({accept:e.accept,userText:e.text})}},Qn=function(e,t,n){if(t!=null){if(typeof t!=`object`&&typeof t!=`function`)throw TypeError(`Object expected.`);var r,i;if(n){if(!Symbol.asyncDispose)throw TypeError(`Symbol.asyncDispose is not defined.`);r=t[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw TypeError(`Symbol.dispose is not defined.`);r=t[Symbol.dispose],n&&(i=r)}if(typeof r!=`function`)throw TypeError(`Object not disposable.`);i&&(r=function(){try{i.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:r,async:n})}else n&&e.stack.push({async:!0});return t},$n=(function(e){return function(t){function n(n){t.error=t.hasError?new e(n,t.error,`An error was suppressed during disposal.`):n,t.hasError=!0}var r,i=0;function a(){for(;r=t.stack.pop();)try{if(!r.async&&i===1)return i=0,t.stack.push(r),Promise.resolve().then(a);if(r.dispose){var e=r.dispose.call(r.value);if(r.async)return i|=2,Promise.resolve(e).then(a,function(e){return n(e),a()})}else i|=1}catch(e){n(e)}if(i===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return a()}})(typeof SuppressedError==`function`?SuppressedError:function(e,t,n){var r=Error(n);return r.name=`SuppressedError`,r.error=e,r.suppressed=t,r}),er=class e{static async from(t,n,r,i=!1){let a=new e(t,n,r,i);return await a.#o(),a}#e;name;#t;#n;#r;#i=[];#a=new I;constructor(e,t,n,r=!1){this.#e=e,this.name=t,this.#t=n,this.#n=r,this.#r=`__puppeteer__${this.#e._id}_page_exposeFunction_${this.name}`}async#o(){let e=this.#s,t={type:`channel`,value:{channel:this.#r,ownership:`root`}};this.#a.use(new j(e)).on(`script.message`,this.#c);let n=r(Ze(e=>{Object.assign(globalThis,{[PLACEHOLDER(`name`)]:function(...t){return new Promise((n,r)=>{e([n,r,t])})}})},{name:JSON.stringify(this.name)})),i=[this.#e];for(let e of i)i.push(...e.childFrames());await Promise.all(i.map(async e=>{let r=this.#n?e.isolatedRealm():e.mainRealm();try{let[i]=await Promise.all([e.browsingContext.addPreloadScript(n,{arguments:[t],sandbox:r.sandbox}),r.realm.callFunction(n,!1,{arguments:[t]})]);this.#i.push([e,i])}catch(e){k(e)}}))}get#s(){return this.#e.page().browser().connection}#c=async e=>{let t={stack:[],error:void 0,hasError:!1};try{if(e.channel!==this.#r)return;let n=this.#l(e.source);if(!n)return;let r=Qn(t,G.from(e.data,n),!1),i=Qn(t,new I,!1),a=[],o;try{let e={stack:[],error:void 0,hasError:!1};try{let t=Qn(e,await r.evaluateHandle(([,,e])=>e),!1);for(let[e,n]of await t.getProperties()){if(i.use(n),n instanceof K){a[+e]=n,i.use(n);continue}a[+e]=n.jsonValue()}o=await this.#t(...await Promise.all(a))}catch(t){e.error=t,e.hasError=!0}finally{$n(e)}}catch(e){try{e instanceof Error?await r.evaluate(([,e],t,n,r)=>{let i=Error(n);i.name=t,r&&(i.stack=r),e(i)},e.name,e.message,e.stack):await r.evaluate(([,e],t)=>{e(t)},e)}catch(e){k(e)}return}try{await r.evaluate(([e],t)=>{e(t)},o)}catch(e){k(e)}}catch(e){t.error=e,t.hasError=!0}finally{$n(t)}};#l(e){let t=this.#u(e.context);if(t)return t.realm(e.realm)}#u(e){let t=[this.#e];for(let n of t){if(n._id===e)return n;t.push(...n.childFrames())}}[Symbol.dispose](){this[Symbol.asyncDispose]().catch(k)}async[Symbol.asyncDispose](){this.#a.dispose(),await Promise.all(this.#i.map(async([e,t])=>{let n=this.#n?e.isolatedRealm():e.mainRealm();try{await Promise.all([n.evaluate(e=>{delete globalThis[e]},this.name),...e.childFrames().map(e=>e.evaluate(e=>{delete globalThis[e]},this.name)),e.browsingContext.removePreloadScript(t)])}catch(e){k(e)}}))}},tr=function(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0},nr=function(e,t,n,r,i,a){function o(e){if(e!==void 0&&typeof e!=`function`)throw TypeError(`Function expected`);return e}for(var s=r.kind,c=s===`getter`?`get`:s===`setter`?`set`:`value`,l=!t&&e?r.static?e:e.prototype:null,u=t||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d,f=!1,p=n.length-1;p>=0;p--){var m={};for(var h in r)m[h]=h===`access`?{}:r[h];for(var h in r.access)m.access[h]=r.access[h];m.addInitializer=function(e){if(f)throw TypeError(`Cannot add initializers after decoration has completed`);a.push(o(e||null))};var g=(0,n[p])(s===`accessor`?{get:u.get,set:u.set}:u[c],m);if(s===`accessor`){if(g===void 0)continue;if(typeof g!=`object`||!g)throw TypeError(`Object expected`);(d=o(g.get))&&(u.get=d),(d=o(g.set))&&(u.set=d),(d=o(g.init))&&i.unshift(d)}else (d=o(g))&&(s===`field`?i.unshift(d):u[c]=d)}l&&Object.defineProperty(l,r.name,u),f=!0};let rr=(()=>{let e=ie,t=[],n;return class r extends e{static{let r=typeof Symbol==`function`&&Symbol.metadata?Object.create(e[Symbol.metadata]??null):void 0;n=[ee],nr(this,null,n,{kind:`method`,name:`remoteAddress`,static:!1,private:!1,access:{has:e=>`remoteAddress`in e,get:e=>e.remoteAddress},metadata:r},null,t),r&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:r})}static from(e,t,n){let i=new r(e,t,n);return i.#i(),i}#e=tr(this,t);#t;#n;#r=!1;constructor(e,t,n){super(),this.#e=e,this.#t=t,this.#r=n;let r=e[`goog:securityDetails`];n&&r&&(this.#n=new Pe(r))}#i(){this.#e.fromCache&&(this.#t._fromMemoryCache=!0,this.#t.frame()?.page().trustedEmitter.emit(`requestservedfromcache`,this.#t)),this.#t.frame()?.page().trustedEmitter.emit(`response`,this)}remoteAddress(){return{ip:``,port:-1}}url(){return this.#e.url}status(){return this.#e.status}statusText(){return this.#e.statusText}headers(){let e={};for(let t of this.#e.headers)t.value.type===`string`&&(e[t.name.toLowerCase()]=t.value.value);return e}request(){return this.#t}fromCache(){return this.#e.fromCache}timing(){let e=this.#t.timing();return{requestTime:e.requestTime,proxyStart:-1,proxyEnd:-1,dnsStart:e.dnsStart,dnsEnd:e.dnsEnd,connectStart:e.connectStart,connectEnd:e.connectEnd,sslStart:e.tlsStart,sslEnd:-1,workerStart:-1,workerReady:-1,workerFetchStart:-1,workerRespondWithSettled:-1,workerRouterEvaluationStart:-1,workerCacheLookupStart:-1,sendStart:e.requestStart,sendEnd:-1,pushStart:-1,pushEnd:-1,receiveHeadersStart:e.responseStart,receiveHeadersEnd:e.responseEnd}}frame(){return this.#t.frame()}fromServiceWorker(){return!1}securityDetails(){if(!this.#r)throw new P;return this.#n??null}async content(){return await this.#t.getResponseContent()}}})();var ir;const ar=new WeakMap;var or=class extends a{static from(e,t,n,r){let i=new ir(e,t,n,r);return i.#i(),i}#e;#t=null;id;#n;#r;constructor(e,t,n,r){super(),ar.set(e,this),this.interception.enabled=n,this.#r=e,this.#n=t,this.#e=r?r.#e:[],this.id=e.id}get client(){return this.#n.client}#i(){this.#r.on(`redirect`,e=>{let t=ir.from(e,this.#n,this.interception.enabled,this);this.#e.push(this),e.once(`success`,()=>{this.#n.page().trustedEmitter.emit(`requestfinished`,t)}),e.once(`error`,()=>{this.#n.page().trustedEmitter.emit(`requestfailed`,t)}),t.finalizeInterceptions()}),this.#r.once(`success`,e=>{this.#t=rr.from(e,this,this.#n.page().browser().cdpSupported)}),this.#r.on(`authenticate`,this.#l),this.#n.page().trustedEmitter.emit(`request`,this),this.#a&&this.interception.handlers.push(async()=>{await this.continue({headers:this.headers()},0)})}canBeIntercepted(){return this.#r.isBlocked}interceptResolutionState(){return this.#r.isBlocked?super.interceptResolutionState():{action:Ke.Disabled}}url(){return this.#r.url}resourceType(){if(!this.#n.page().browser().cdpSupported)throw new P;return(this.#r.resourceType||`other`).toLowerCase()}method(){return this.#r.method}postData(){if(!this.#n.page().browser().cdpSupported)throw new P;return this.#r.postData}hasPostData(){return this.#r.hasPostData}async fetchPostData(){return await this.#r.fetchPostData()}get#a(){return!!(Object.keys(this.#o).length||Object.keys(this.#s).length)}get#o(){return this.#n?.page()._extraHTTPHeaders??{}}get#s(){return this.#n?.page()._userAgentHeaders??{}}headers(){let e={};for(let t of this.#r.headers)e[t.name.toLowerCase()]=t.value.value;return{...e,...this.#o,...this.#s}}response(){return this.#t}failure(){return this.#r.error===void 0?null:{errorText:this.#r.error}}isNavigationRequest(){return this.#r.navigation!==void 0}initiator(){return{...this.#r.initiator,type:this.#r.initiator?.type??`other`}}redirectChain(){return this.#e.slice()}frame(){return this.#n}async continue(e,t){return await super.continue({headers:this.#a?this.headers():void 0,...e},t)}async _continue(e={}){let t=sr(e.headers);return this.interception.handled=!0,await this.#r.continueRequest({url:e.url,method:e.method,body:e.postData?{type:`base64`,value:Ce(e.postData)}:void 0,headers:t.length>0?t:void 0}).catch(e=>(this.interception.handled=!1,l(e)))}async _abort(){return this.interception.handled=!0,await this.#r.failRequest().catch(e=>{throw this.interception.handled=!1,e})}async _respond(e,t){this.interception.handled=!0;let n;e.body&&(n=a.getResponse(e.body));let r=sr(e.headers),i=r.some(e=>e.name===`content-length`);e.contentType&&r.push({name:`content-type`,value:{type:`string`,value:e.contentType}}),n?.contentLength&&!i&&r.push({name:`content-length`,value:{type:`string`,value:String(n.contentLength)}});let o=e.status||200;return await this.#r.provideResponse({statusCode:o,headers:r.length>0?r:void 0,reasonPhrase:ae[o],body:n?.base64?{type:`base64`,value:n?.base64}:void 0}).catch(e=>{throw this.interception.handled=!1,e})}#c=!1;#l=async()=>{if(!this.#n)return;let e=this.#n.page()._credentials;e&&!this.#c?(this.#c=!0,this.#r.continueWithAuth({action:`provideCredentials`,credentials:{type:`password`,username:e.username,password:e.password}})):this.#r.continueWithAuth({action:`cancel`})};timing(){return this.#r.timing()}getResponseContent(){return this.#r.getResponseContent()}};ir=or;function sr(e){let t=[];for(let[n,r]of Object.entries(e??[]))if(!Object.is(r,void 0)){let e=Array.isArray(r)?r:[r];for(let r of e)t.push({name:n.toLowerCase(),value:{type:`string`,value:String(r)}})}return t}
/**
* @license
* Copyright 2023 Google Inc.
* SPDX-License-Identifier: Apache-2.0
*/
var cr=class extends Error{},lr=class{static serialize(e){switch(typeof e){case`symbol`:case`function`:throw new cr(`Unable to serializable ${typeof e}`);case`object`:return this.#t(e);case`undefined`:return{type:`undefined`};case`number`:return this.#e(e);case`bigint`:return{type:`bigint`,value:e.toString()};case`string`:return{type:`string`,value:e};case`boolean`:return{type:`boolean`,value:e}}}static#e(e){let t;return t=Object.is(e,-0)?`-0`:Object.is(e,1/0)?`Infinity`:Object.is(e,-1/0)?`-Infinity`:Object.is(e,NaN)?`NaN`:e,{type:`number`,value:t}}static#t(e){if(e===null)return{type:`null`};if(Array.isArray(e))return{type:`array`,value:e.map(e=>this.serialize(e))};if(Ee(e)){try{JSON.stringify(e)}catch(e){throw e instanceof TypeError&&e.message.startsWith(`Converting circular structure to JSON`)&&(e.message+=` Recursive objects are not allowed.`),e}let t=[];for(let n in e)t.push([this.serialize(n),this.serialize(e[n])]);return{type:`object`,value:t}}else if(he(e))return{type:`regexp`,value:{pattern:e.source,flags:e.flags}};else if(ze(e))return{type:`date`,value:e.toISOString()};throw new cr(`Custom object serialization not possible. Use plain objects instead.`)}};
/**
* @license
* Copyright 2023 Google Inc.
* SPDX-License-Identifier: Apache-2.0
*/
function ur(e){if(e.exception.type!==`error`)return Kn.deserialize(e.exception);let[t=``,...n]=e.text.split(`: `),r=n.join(`: `),i=Error(r);i.name=t;let a=[];if(e.stackTrace&&a.length<Error.stackTraceLimit)for(let t of e.stackTrace.callFrames.reverse()){if(de.isPuppeteerURL(t.url)&&t.url!==de.INTERNAL_URL){let e=de.parse(t.url);a.unshift(`    at ${t.functionName||e.functionName} (${e.functionName} at ${e.siteString}, <anonymous>:${t.lineNumber}:${t.columnNumber})`)}else a.push(`    at ${t.functionName||`<anonymous>`} (${t.url}:${t.lineNumber}:${t.columnNumber})`);if(a.length>=Error.stackTraceLimit)break}return i.stack=[e.text,...a].join(`
`),i}function dr(e,t){return n=>{throw n instanceof We?n.message+=` at ${e}`:n instanceof xe&&(n.message=`Navigation timeout of ${t} ms exceeded`),n}}var fr=function(e,t,n){if(t!=null){if(typeof t!=`object`&&typeof t!=`function`)throw TypeError(`Object expected.`);var r,i;if(n){if(!Symbol.asyncDispose)throw TypeError(`Symbol.asyncDispose is not defined.`);r=t[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw TypeError(`Symbol.dispose is not defined.`);r=t[Symbol.dispose],n&&(i=r)}if(typeof r!=`function`)throw TypeError(`Object not disposable.`);i&&(r=function(){try{i.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:r,async:n})}else n&&e.stack.push({async:!0});return t},pr=(function(e){return function(t){function n(n){t.error=t.hasError?new e(n,t.error,`An error was suppressed during disposal.`):n,t.hasError=!0}var r,i=0;function a(){for(;r=t.stack.pop();)try{if(!r.async&&i===1)return i=0,t.stack.push(r),Promise.resolve().then(a);if(r.dispose){var e=r.dispose.call(r.value);if(r.async)return i|=2,Promise.resolve(e).then(a,function(e){return n(e),a()})}else i|=1}catch(e){n(e)}if(i===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return a()}})(typeof SuppressedError==`function`?SuppressedError:function(e,t,n){var r=Error(n);return r.name=`SuppressedError`,r.error=e,r.suppressed=t,r}),mr=class extends Se{realm;constructor(e,t){super(t),this.realm=e}initialize(){this.realm.on(`destroyed`,({reason:e})=>{this.taskManager.terminateAll(Error(e)),this.dispose()}),this.realm.on(`updated`,()=>{this.internalPuppeteerUtil=void 0,this.taskManager.rerunAll()})}internalPuppeteerUtil;get puppeteerUtil(){let e=Promise.resolve();return h.inject(t=>{this.internalPuppeteerUtil&&this.internalPuppeteerUtil.then(e=>{e.dispose()}),this.internalPuppeteerUtil=e.then(()=>this.evaluateHandle(t))},!this.internalPuppeteerUtil),this.internalPuppeteerUtil}async evaluateHandle(e,...t){return await this.#e(!1,e,...t)}async evaluate(e,...t){return await this.#e(!0,e,...t)}async#e(e,t,...n){let i=Ne(He(t)?.toString()??de.INTERNAL_URL),a,o=e?`none`:`root`,s=e?{}:{maxObjectDepth:0,maxDomDepth:0};if(Fe(t)){let e=ue.test(t)?t:`${t}\n${i}\n`;a=this.realm.evaluate(e,!0,{resultOwnership:o,userActivation:!0,serializationOptions:s})}else{let e=r(t);e=ue.test(e)?e:`${e}\n${i}\n`,a=this.realm.callFunction(e,!0,{arguments:n.some(e=>e instanceof ne)?await Promise.all(n.map(e=>this.serializeAsync(e))):n.map(e=>this.serialize(e)),resultOwnership:o,userActivation:!0,serializationOptions:s})}let c=await a;if(`type`in c&&c.type===`exception`)throw ur(c.exceptionDetails);return e?Kn.deserialize(c.result):this.createHandle(c.result)}createHandle(e){return(e.type===`node`||e.type===`window`)&&this instanceof q?K.from(e,this):G.from(e,this)}async serializeAsync(e){return e instanceof ne&&(e=await e.get(this)),this.serialize(e)}serialize(e){if(e instanceof G||e instanceof K){if(e.realm!==this){if(!(e.realm instanceof q)||!(this instanceof q))throw Error(`Trying to evaluate JSHandle from different global types. Usually this means you're using a handle from a worker in a page or vice versa.`);if(e.realm.environment!==this.environment)throw Error(`Trying to evaluate JSHandle from different frames. Usually this means you're using a handle from a page on a different page.`)}if(e.disposed)throw Error(`JSHandle is disposed!`);return e.remoteValue()}return lr.serialize(e)}async destroyHandles(e){if(this.disposed)return;let t=e.map(({id:e})=>e).filter(e=>e!==void 0);t.length!==0&&await this.realm.disown(t).catch(e=>{k(e)})}async adoptHandle(e){return await this.evaluateHandle(e=>e,e)}async transferHandle(e){if(e.realm===this)return e;let t=this.adoptHandle(e);return await e.dispose(),await t}},q=class e extends mr{static from(t,n){let r=new e(t,n);return r.#t(),r}#e;constructor(e,t){super(e,t.timeoutSettings),this.#e=t}#t(){super.initialize(),this.realm.on(`updated`,()=>{this.environment.clearDocumentHandle(),this.#n=!1})}#n=!1;get puppeteerUtil(){let e=Promise.resolve();return this.#n||=(e=Promise.all([er.from(this.environment,`__ariaQuerySelector`,y.queryOne,!!this.sandbox),er.from(this.environment,`__ariaQuerySelectorAll`,async(e,t)=>{let n=y.queryAll(e,t);return await e.realm.evaluateHandle((...e)=>e,...await m.collect(n))},!!this.sandbox)]),!0),e.then(()=>super.puppeteerUtil)}get sandbox(){return this.realm.sandbox}get environment(){return this.#e}async adoptBackendNode(e){let t={stack:[],error:void 0,hasError:!1};try{let{object:n}=await this.#e.client.send(`DOM.resolveNode`,{backendNodeId:e,executionContextId:await this.realm.resolveExecutionContextId()});return await fr(t,K.from({handle:n.objectId,type:`node`},this),!1).evaluateHandle(e=>e)}catch(e){t.error=e,t.hasError=!0}finally{pr(t)}}},hr=class e extends mr{static from(t,n){let r=new e(t,n);return r.initialize(),r}#e;constructor(e,t){super(e,t.timeoutSettings),this.#e=t}get environment(){return this.#e}async adoptBackendNode(){throw Error(`Cannot adopt DOM nodes into a worker.`)}},gr=class e extends Ie{static from(t,n){return new e(t,n)}#e;#t;constructor(e,t){super(t.origin),this.#e=e,this.#t=hr.from(t,this)}get frame(){return this.#e}mainRealm(){return this.#t}get client(){throw new P}},_r=function(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0},J=function(e,t,n,r,i,a){function o(e){if(e!==void 0&&typeof e!=`function`)throw TypeError(`Function expected`);return e}for(var s=r.kind,c=s===`getter`?`get`:s===`setter`?`set`:`value`,l=!t&&e?r.static?e:e.prototype:null,u=t||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d,f=!1,p=n.length-1;p>=0;p--){var m={};for(var h in r)m[h]=h===`access`?{}:r[h];for(var h in r.access)m.access[h]=r.access[h];m.addInitializer=function(e){if(f)throw TypeError(`Cannot add initializers after decoration has completed`);a.push(o(e||null))};var g=(0,n[p])(s===`accessor`?{get:u.get,set:u.set}:u[c],m);if(s===`accessor`){if(g===void 0)continue;if(typeof g!=`object`||!g)throw TypeError(`Object expected`);(d=o(g.get))&&(u.get=d),(d=o(g.set))&&(u.set=d),(d=o(g.init))&&i.unshift(d)}else (d=o(g))&&(s===`field`?i.unshift(d):u[c]=d)}l&&Object.defineProperty(l,r.name,u),f=!0},vr=function(e,t,n){return typeof t==`symbol`&&(t=t.description?`[${t.description}]`:``),Object.defineProperty(e,`name`,{configurable:!0,value:n?`${n} ${t}`:t})};function yr(e){switch(e){case`group`:return`startGroup`;case`groupCollapsed`:return`startGroupCollapsed`;case`groupEnd`:return`endGroup`;default:return e}}let br=(()=>{let t=s,r=[],i,a,l,d,f,p,m,h,g;return class s extends t{static{let e=typeof Symbol==`function`&&Symbol.metadata?Object.create(t[Symbol.metadata]??null):void 0;i=[T],a=[T],l=[T],d=[T],p=[T],h=[T],g=[T],J(this,null,i,{kind:`method`,name:`goto`,static:!1,private:!1,access:{has:e=>`goto`in e,get:e=>e.goto},metadata:e},null,r),J(this,null,a,{kind:`method`,name:`setContent`,static:!1,private:!1,access:{has:e=>`setContent`in e,get:e=>e.setContent},metadata:e},null,r),J(this,null,l,{kind:`method`,name:`waitForNavigation`,static:!1,private:!1,access:{has:e=>`waitForNavigation`in e,get:e=>e.waitForNavigation},metadata:e},null,r),J(this,f={value:vr(function(e={}){let{waitUntil:t=`load`}=e,{timeout:r=this.timeoutSettings.navigationTimeout()}=e;Array.isArray(t)||(t=[t]);let i=new Set;for(let e of t)switch(e){case`load`:i.add(`load`);break;case`domcontentloaded`:i.add(`DOMContentLoaded`);break}return i.size===0?N(void 0):o([...i].map(e=>M(this.browsingContext,e))).pipe(n(()=>{}),c(),w(_e(r),this.#i().pipe(n(()=>{throw Error(`Frame detached.`)}))))},`#waitForLoad$`)},d,{kind:`method`,name:`#waitForLoad$`,static:!1,private:!0,access:{has:e=>#o in e,get:e=>e.#o},metadata:e},null,r),J(this,m={value:vr(function(e={}){let{waitUntil:t=`load`}=e;Array.isArray(t)||(t=[t]);let n=1/0;for(let e of t)switch(e){case`networkidle0`:n=Math.min(0,n);break;case`networkidle2`:n=Math.min(2,n);break}return n===1/0?N(void 0):this.page().waitForNetworkIdle$({idleTime:500,timeout:e.timeout??this.timeoutSettings.timeout(),concurrency:n})},`#waitForNetworkIdle$`)},p,{kind:`method`,name:`#waitForNetworkIdle$`,static:!1,private:!0,access:{has:e=>#s in e,get:e=>e.#s},metadata:e},null,r),J(this,null,h,{kind:`method`,name:`setFiles`,static:!1,private:!1,access:{has:e=>`setFiles`in e,get:e=>e.setFiles},metadata:e},null,r),J(this,null,g,{kind:`method`,name:`locateNodes`,static:!1,private:!1,access:{has:e=>`locateNodes`in e,get:e=>e.locateNodes},metadata:e},null,r),e&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:e})}static from(e,t){let n=new s(e,t);return n.#n(),n}#e=_r(this,r);browsingContext;#t=new WeakMap;realms;_id;client;accessibility;constructor(e,t){super(),this.#e=e,this.browsingContext=t,this._id=t.id,this.client=new gn(this),this.realms={default:q.from(this.browsingContext.defaultRealm,this),internal:q.from(this.browsingContext.createWindowRealm(`__puppeteer_internal_${Math.ceil(Math.random()*1e4)}`),this)},this.accessibility=new be(this.realms.default,this._id)}#n(){for(let e of this.browsingContext.children)this.#r(e);this.browsingContext.on(`browsingcontext`,({browsingContext:e})=>{this.#r(e)}),this.browsingContext.on(`closed`,()=>{for(let e of gn.sessions.values())e.frame===this&&e.onClose();this.page().trustedEmitter.emit(`framedetached`,this)}),this.browsingContext.on(`request`,({request:e})=>{let t=or.from(e,this,this.page().isNetworkInterceptionEnabled);e.once(`success`,()=>{this.page().trustedEmitter.emit(`requestfinished`,t)}),e.once(`error`,()=>{this.page().trustedEmitter.emit(`requestfailed`,t)}),t.finalizeInterceptions()}),this.browsingContext.on(`navigation`,({navigation:e})=>{e.once(`fragment`,()=>{this.page().trustedEmitter.emit(`framenavigated`,this)})}),this.browsingContext.on(`load`,()=>{this.page().trustedEmitter.emit(`load`,void 0)}),this.browsingContext.on(`DOMContentLoaded`,()=>{this._hasStartedLoading=!0,this.page().trustedEmitter.emit(`domcontentloaded`,void 0),this.page().trustedEmitter.emit(`framenavigated`,this)}),this.browsingContext.on(`userprompt`,({userPrompt:e})=>{this.page().trustedEmitter.emit(`dialog`,Zn.from(e))}),this.browsingContext.on(`log`,({entry:e})=>{if(this._id===e.source.context)if(xr(e)){let t=e.args.map(e=>this.mainRealm().createHandle(e)),n=t.reduce((e,t)=>`${e} ${t instanceof G&&t.isPrimitiveValue?Kn.deserialize(t.remoteValue()):t.toString()}`,``).slice(1);this.page().trustedEmitter.emit(`console`,new ve(yr(e.method),n,t,Cr(e.stackTrace),this))}else if(Sr(e)){let t=Error(e.text??``),n=t.message.split(`
`).length,r=t.stack.split(`
`).splice(0,n),i=[];if(e.stackTrace){for(let t of e.stackTrace.callFrames)if(i.push(`    at ${t.functionName||`<anonymous>`} (${t.url}:${t.lineNumber+1}:${t.columnNumber+1})`),i.length>=Error.stackTraceLimit)break}t.stack=[...r,...i].join(`
`),this.page().trustedEmitter.emit(`pageerror`,t)}else k(`Unhandled LogEntry with type "${e.type}", text "${e.text}" and level "${e.level}"`)}),this.browsingContext.on(`worker`,({realm:e})=>{let t=gr.from(this,e);e.on(`destroyed`,()=>{this.page().trustedEmitter.emit(`workerdestroyed`,t)}),this.page().trustedEmitter.emit(`workercreated`,t)})}#r(e){let t=s.from(this,e);return this.#t.set(e,t),this.page().trustedEmitter.emit(`frameattached`,t),e.on(`closed`,()=>{this.#t.delete(e)}),t}get timeoutSettings(){return this.page()._timeoutSettings}mainRealm(){return this.realms.default}isolatedRealm(){return this.realms.internal}realm(e){for(let t of Object.values(this.realms))if(t.realm.id===e)return t}page(){let e=this.#e;for(;e instanceof s;)e=e.#e;return e}url(){return this.browsingContext.url}parentFrame(){return this.#e instanceof s?this.#e:null}childFrames(){return[...this.browsingContext.children].map(e=>this.#t.get(e))}#i(){return qe(()=>this.detached?N(this):M(this.page().trustedEmitter,`framedetached`).pipe(u(e=>e===this)))}async goto(e,t={}){let[n]=await Promise.all([this.waitForNavigation(t),this.browsingContext.navigate(e,`interactive`).catch(e=>{if(!(ce(e)&&e.message.includes(`net::ERR_HTTP_RESPONSE_CODE_FAILURE`))&&!e.message.includes(`navigation canceled`)&&!e.message.includes(`Navigation was aborted by another navigation`))throw e})]).catch(dr(e,t.timeout??this.timeoutSettings.navigationTimeout()));return n}async setContent(e,t={}){await Promise.all([this.setFrameContent(e),E(o([this.#o(t),this.#s(t)]))])}async waitForNavigation(t={}){let{timeout:r=this.timeoutSettings.navigationTimeout(),signal:i}=t,a=this.childFrames().map(e=>e.#i());return await E(o([S(M(this.browsingContext,`navigation`),M(this.browsingContext,`historyUpdated`).pipe(n(()=>({navigation:null})))).pipe(c()).pipe(D(({navigation:e})=>e===null?N(null):this.#o(t).pipe(oe(()=>a.length===0?N(void 0):o(a)),w(M(e,`fragment`),M(e,`failed`),M(e,`aborted`)),D(()=>{if(e.request){function t(n){return e===null?N(null):n.response||n.error?N(e):n.redirect?t(n.redirect):M(n,`success`).pipe(w(M(n,`error`)),w(M(n,`redirect`))).pipe(D(()=>t(n)))}return t(e.request)}return N(e)})))),this.#s(t)]).pipe(n(([e])=>{if(!e)return null;let t=e.request;if(!t)return null;let n=t.lastRedirect??t;return ar.get(n).response()}),w(_e(r),e(i),this.#i().pipe(n(()=>{throw new ye(`Frame detached.`)})))))}waitForDevicePrompt(){throw new P}get detached(){return this.browsingContext.closed}#a=new Map;async exposeFunction(e,t){if(this.#a.has(e))throw Error(`Failed to add page binding with name ${e}: globalThis['${e}'] already exists!`);let n=await er.from(this,e,t);this.#a.set(e,n)}async removeExposedFunction(e){let t=this.#a.get(e);if(!t)throw Error(`Failed to remove page binding with name ${e}: window['${e}'] does not exists!`);this.#a.delete(e),await t[Symbol.asyncDispose]()}async createCDPSession(){if(!this.page().browser().cdpSupported)throw new P;return await this.page().browser().cdpConnection._createSession({targetId:this._id})}get#o(){return f.value}get#s(){return m.value}async setFiles(e,t){await this.browsingContext.setFiles(e.remoteValue(),t)}async locateNodes(e,t){return await this.browsingContext.locateNodes(t,[e.remoteValue()])}}})();function xr(e){return e.type===`console`}function Sr(e){return e.type===`javascript`}function Cr(e){let t=[];if(e)for(let n of e.callFrames)t.push({url:n.url,lineNumber:n.lineNumber,columnNumber:n.columnNumber});return t}
/**
* @license
* Copyright 2017 Google Inc.
* SPDX-License-Identifier: Apache-2.0
*/
var Y;(function(e){e.None=`none`,e.Key=`key`,e.Pointer=`pointer`,e.Wheel=`wheel`})(Y||={});var X;(function(e){e.Pause=`pause`,e.KeyDown=`keyDown`,e.KeyUp=`keyUp`,e.PointerUp=`pointerUp`,e.PointerDown=`pointerDown`,e.PointerMove=`pointerMove`,e.Scroll=`scroll`})(X||={});const Z=e=>{switch(e){case`\r`:case`
`:e=`Enter`;break}if([...e].length===1)return e;switch(e){case`Cancel`:return`ÓÄÅ`;case`Help`:return`ÓÄÇ`;case`Backspace`:return`ÓÄÉ`;case`Tab`:return`ÓÄÑ`;case`Clear`:return`ÓÄÖ`;case`Enter`:return`ÓÄá`;case`Shift`:case`ShiftLeft`:return`ÓÄà`;case`Control`:case`ControlLeft`:return`ÓÄâ`;case`Alt`:case`AltLeft`:return`ÓÄä`;case`Pause`:return`ÓÄã`;case`Escape`:return`ÓÄå`;case`PageUp`:return`ÓÄé`;case`PageDown`:return`ÓÄè`;case`End`:return`ÓÄê`;case`Home`:return`ÓÄë`;case`ArrowLeft`:return`ÓÄí`;case`ArrowUp`:return`ÓÄì`;case`ArrowRight`:return`ÓÄî`;case`ArrowDown`:return`ÓÄï`;case`Insert`:return`ÓÄñ`;case`Delete`:return`ÓÄó`;case`NumpadEqual`:return`ÓÄô`;case`Numpad0`:return`ÓÄö`;case`Numpad1`:return`ÓÄõ`;case`Numpad2`:return`ÓÄú`;case`Numpad3`:return`ÓÄù`;case`Numpad4`:return`ÓÄû`;case`Numpad5`:return`ÓÄü`;case`Numpad6`:return`ÓÄ†`;case`Numpad7`:return`ÓÄ°`;case`Numpad8`:return`ÓÄ¢`;case`Numpad9`:return`ÓÄ£`;case`NumpadMultiply`:return`ÓÄ§`;case`NumpadAdd`:return`ÓÄ•`;case`NumpadSubtract`:return`ÓÄß`;case`NumpadDecimal`:return`ÓÄ®`;case`NumpadDivide`:return`ÓÄ©`;case`F1`:return`ÓÄ±`;case`F2`:return`ÓÄ≤`;case`F3`:return`ÓÄ≥`;case`F4`:return`ÓÄ¥`;case`F5`:return`ÓÄµ`;case`F6`:return`ÓÄ∂`;case`F7`:return`ÓÄ∑`;case`F8`:return`ÓÄ∏`;case`F9`:return`ÓÄπ`;case`F10`:return`ÓÄ∫`;case`F11`:return`ÓÄª`;case`F12`:return`ÓÄº`;case`Meta`:case`MetaLeft`:return`ÓÄΩ`;case`ShiftRight`:return`ÓÅê`;case`ControlRight`:return`ÓÅë`;case`AltRight`:return`ÓÅí`;case`MetaRight`:return`ÓÅì`;case`Digit0`:return`0`;case`Digit1`:return`1`;case`Digit2`:return`2`;case`Digit3`:return`3`;case`Digit4`:return`4`;case`Digit5`:return`5`;case`Digit6`:return`6`;case`Digit7`:return`7`;case`Digit8`:return`8`;case`Digit9`:return`9`;case`KeyA`:return`a`;case`KeyB`:return`b`;case`KeyC`:return`c`;case`KeyD`:return`d`;case`KeyE`:return`e`;case`KeyF`:return`f`;case`KeyG`:return`g`;case`KeyH`:return`h`;case`KeyI`:return`i`;case`KeyJ`:return`j`;case`KeyK`:return`k`;case`KeyL`:return`l`;case`KeyM`:return`m`;case`KeyN`:return`n`;case`KeyO`:return`o`;case`KeyP`:return`p`;case`KeyQ`:return`q`;case`KeyR`:return`r`;case`KeyS`:return`s`;case`KeyT`:return`t`;case`KeyU`:return`u`;case`KeyV`:return`v`;case`KeyW`:return`w`;case`KeyX`:return`x`;case`KeyY`:return`y`;case`KeyZ`:return`z`;case`Semicolon`:return`;`;case`Equal`:return`=`;case`Comma`:return`,`;case`Minus`:return`-`;case`Period`:return`.`;case`Slash`:return`/`;case`Backquote`:return"`";case`BracketLeft`:return`[`;case`Backslash`:return`\\`;case`BracketRight`:return`]`;case`Quote`:return`"`;default:throw Error(`Unknown key: "${e}"`)}};var wr=class extends Ge{#e;constructor(e){super(),this.#e=e}async down(e,t){await this.#e.mainFrame().browsingContext.performActions([{type:Y.Key,id:`__puppeteer_keyboard`,actions:[{type:X.KeyDown,value:Z(e)}]}])}async up(e){await this.#e.mainFrame().browsingContext.performActions([{type:Y.Key,id:`__puppeteer_keyboard`,actions:[{type:X.KeyUp,value:Z(e)}]}])}async press(e,t={}){let{delay:n=0}=t,r=[{type:X.KeyDown,value:Z(e)}];n>0&&r.push({type:X.Pause,duration:n}),r.push({type:X.KeyUp,value:Z(e)}),await this.#e.mainFrame().browsingContext.performActions([{type:Y.Key,id:`__puppeteer_keyboard`,actions:r}])}async type(e,t={}){let{delay:n=0}=t,r=[...e].map(Z),i=[];if(n<=0)for(let e of r)i.push({type:X.KeyDown,value:e},{type:X.KeyUp,value:e});else for(let e of r)i.push({type:X.KeyDown,value:e},{type:X.Pause,duration:n},{type:X.KeyUp,value:e});await this.#e.mainFrame().browsingContext.performActions([{type:Y.Key,id:`__puppeteer_keyboard`,actions:i}])}async sendCharacter(e){if([...e].length>1)throw Error(`Cannot send more than 1 character.`);await(await this.#e.focusedFrame()).isolatedRealm().evaluate(async e=>{document.execCommand(`insertText`,!1,e)},e)}};const Tr=e=>{switch(e){case A.Left:return 0;case A.Middle:return 1;case A.Right:return 2;case A.Back:return 3;case A.Forward:return 4}};var Er=class extends Ye{#e;#t={x:0,y:0};constructor(e){super(),this.#e=e}async reset(){this.#t={x:0,y:0},await this.#e.mainFrame().browsingContext.releaseActions()}async move(e,t,n={}){let r=this.#t,i={x:Math.round(e),y:Math.round(t)},a=[],o=n.steps??0;for(let e=0;e<o;++e)a.push({type:X.PointerMove,x:r.x+(i.x-r.x)*(e/o),y:r.y+(i.y-r.y)*(e/o),origin:n.origin});a.push({type:X.PointerMove,...i,origin:n.origin}),this.#t=i,await this.#e.mainFrame().browsingContext.performActions([{type:Y.Pointer,id:`__puppeteer_mouse`,actions:a}])}async down(e={}){await this.#e.mainFrame().browsingContext.performActions([{type:Y.Pointer,id:`__puppeteer_mouse`,actions:[{type:X.PointerDown,button:Tr(e.button??A.Left)}]}])}async up(e={}){await this.#e.mainFrame().browsingContext.performActions([{type:Y.Pointer,id:`__puppeteer_mouse`,actions:[{type:X.PointerUp,button:Tr(e.button??A.Left)}]}])}async click(e,t,n={}){let r=[{type:X.PointerMove,x:Math.round(e),y:Math.round(t),origin:n.origin}],i={type:X.PointerDown,button:Tr(n.button??A.Left)},a={type:X.PointerUp,button:i.button};for(let e=1;e<(n.count??1);++e)r.push(i,a);r.push(i),n.delay&&r.push({type:X.Pause,duration:n.delay}),r.push(a),await this.#e.mainFrame().browsingContext.performActions([{type:Y.Pointer,id:`__puppeteer_mouse`,actions:r}])}async wheel(e={}){await this.#e.mainFrame().browsingContext.performActions([{type:Y.Wheel,id:`__puppeteer_wheel`,actions:[{type:X.Scroll,...this.#t??{x:0,y:0},deltaX:e.deltaX??0,deltaY:e.deltaY??0}]}])}drag(){throw new P}dragOver(){throw new P}dragEnter(){throw new P}drop(){throw new P}dragAndDrop(){throw new P}},Dr=class{#e=!1;#t;#n;#r;#i;#a;#o;constructor(e,t,n,r,i,a){this.#i=e,this.#a=t,this.#t=Math.round(r),this.#n=Math.round(i),this.#o=a,this.#r=`__puppeteer_finger_${n}`}async start(e={}){if(this.#e)throw new Le(`Touch has already started`);await this.#i.mainFrame().browsingContext.performActions([{type:Y.Pointer,id:this.#r,parameters:{pointerType:`touch`},actions:[{type:X.PointerMove,x:this.#t,y:this.#n,origin:e.origin},{...this.#o,type:X.PointerDown,button:0}]}]),this.#e=!0}move(e,t){let n=Math.round(e),r=Math.round(t);return this.#i.mainFrame().browsingContext.performActions([{type:Y.Pointer,id:this.#r,parameters:{pointerType:`touch`},actions:[{...this.#o,type:X.PointerMove,x:n,y:r}]}])}async end(){await this.#i.mainFrame().browsingContext.performActions([{type:Y.Pointer,id:this.#r,parameters:{pointerType:`touch`},actions:[{type:X.PointerUp,button:0}]}]),this.#a.removeHandle(this)}},Or=class extends Je{#e;constructor(e){super(),this.#e=e}async touchStart(e,t,n={}){let r=this.idGenerator(),i={width:.5*2,height:.5*2,pressure:.5,altitudeAngle:Math.PI/2},a=new Dr(this.#e,this,r,e,t,i);return await a.start(n),this.touches.push(a),a}},kr=function(e,t,n,r,i,a){function o(e){if(e!==void 0&&typeof e!=`function`)throw TypeError(`Function expected`);return e}for(var s=r.kind,c=s===`getter`?`get`:s===`setter`?`set`:`value`,l=!t&&e?r.static?e:e.prototype:null,u=t||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d,f=!1,p=n.length-1;p>=0;p--){var m={};for(var h in r)m[h]=h===`access`?{}:r[h];for(var h in r.access)m.access[h]=r.access[h];m.addInitializer=function(e){if(f)throw TypeError(`Cannot add initializers after decoration has completed`);a.push(o(e||null))};var g=(0,n[p])(s===`accessor`?{get:u.get,set:u.set}:u[c],m);if(s===`accessor`){if(g===void 0)continue;if(typeof g!=`object`||!g)throw TypeError(`Object expected`);(d=o(g.get))&&(u.get=d),(d=o(g.set))&&(u.set=d),(d=o(g.init))&&i.unshift(d)}else (d=o(g))&&(s===`field`?i.unshift(d):u[c]=d)}l&&Object.defineProperty(l,r.name,u),f=!0},Ar=function(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0},jr=function(e,t,n){if(t!=null){if(typeof t!=`object`&&typeof t!=`function`)throw TypeError(`Object expected.`);var r,i;if(n){if(!Symbol.asyncDispose)throw TypeError(`Symbol.asyncDispose is not defined.`);r=t[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw TypeError(`Symbol.dispose is not defined.`);r=t[Symbol.dispose],n&&(i=r)}if(typeof r!=`function`)throw TypeError(`Object not disposable.`);i&&(r=function(){try{i.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:r,async:n})}else n&&e.stack.push({async:!0});return t},Mr=(function(e){return function(t){function n(n){t.error=t.hasError?new e(n,t.error,`An error was suppressed during disposal.`):n,t.hasError=!0}var r,i=0;function a(){for(;r=t.stack.pop();)try{if(!r.async&&i===1)return i=0,t.stack.push(r),Promise.resolve().then(a);if(r.dispose){var e=r.dispose.call(r.value);if(r.async)return i|=2,Promise.resolve(e).then(a,function(e){return n(e),a()})}else i|=1}catch(e){n(e)}if(i===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return a()}})(typeof SuppressedError==`function`?SuppressedError:function(e,t,n){var r=Error(n);return r.name=`SuppressedError`,r.error=e,r.suppressed=t,r});let Nr=(()=>{let e=fe,t,n=[],r=[];return class i extends e{static{let i=typeof Symbol==`function`&&Symbol.metadata?Object.create(e[Symbol.metadata]??null):void 0;t=[x()],kr(this,null,t,{kind:`accessor`,name:`trustedEmitter`,static:!1,private:!1,access:{has:e=>`trustedEmitter`in e,get:e=>e.trustedEmitter,set:(e,t)=>{e.trustedEmitter=t}},metadata:i},n,r),i&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:i})}static from(e,t){let n=new i(e,t);return n.#c(),n}#e=Ar(this,n,new j);get trustedEmitter(){return this.#e}set trustedEmitter(e){this.#e=e}#t=Ar(this,r);#n;#r=null;#i=new Set;keyboard;mouse;touchscreen;tracing;coverage;#a;#o;#s=new Set;_client(){return this.#n.client}constructor(e,t){super(),this.#t=e,this.#n=br.from(this,t),this.#a=new Be(this.#n.client),this.tracing=new me(this.#n.client),this.coverage=new ge(this.#n.client),this.keyboard=new wr(this),this.mouse=new Er(this),this.touchscreen=new Or(this)}#c(){this.#n.browsingContext.on(`closed`,()=>{this.trustedEmitter.emit(`close`,void 0),this.trustedEmitter.removeAllListeners()}),this.trustedEmitter.on(`workercreated`,e=>{this.#i.add(e)}),this.trustedEmitter.on(`workerdestroyed`,e=>{this.#i.delete(e)})}_userAgentHeaders={};#l;#u;async setUserAgent(e,t){let n,r,i;if(typeof e==`string`?(n=e,r=t):(n=e.userAgent??await this.#t.browser().userAgent(),r=e.userAgentMetadata,i=e.platform),!this.#t.browser().cdpSupported&&(r||i))throw new P("Current Browser does not support `userAgentMetadata` or `platform`");if(this.#t.browser().cdpSupported&&(r||i))return await this._client().send(`Network.setUserAgentOverride`,{userAgent:n,userAgentMetadata:r,platform:i});let a=n!==``;n??=await this.#t.browser().userAgent(),this._userAgentHeaders=a?{"User-Agent":n}:{},this.#l=await this.#m([`beforeRequestSent`],this.#l,a);let o=(e,t)=>{Object.defineProperty(navigator,`userAgent`,{value:e,configurable:!0}),t&&Object.defineProperty(navigator,`platform`,{value:t,configurable:!0})},s=[this.#n];for(let e of s)s.push(...e.childFrames());this.#u&&await this.removeScriptToEvaluateOnNewDocument(this.#u);let[c]=await Promise.all([a?this.evaluateOnNewDocument(o,n,i||void 0):void 0,...s.map(e=>e.evaluate(o,n,i||void 0))]);this.#u=c?.identifier}async setBypassCSP(e){await this._client().send(`Page.setBypassCSP`,{enabled:e})}async queryObjects(e){F(!e.disposed,`Prototype JSHandle is disposed!`),F(e.id,`Prototype JSHandle must not be referencing primitive value`);let t=await this.#n.client.send(`Runtime.queryObjects`,{prototypeObjectId:e.id});return this.#n.mainRealm().createHandle({type:`array`,handle:t.objects.objectId})}browser(){return this.browserContext().browser()}browserContext(){return this.#t}mainFrame(){return this.#n}resize(e){throw Error(`Method not implemented for WebDriver BiDi yet.`)}openDevTools(){throw Error(`Method not implemented for WebDriver BiDi yet.`)}async focusedFrame(){let e={stack:[],error:void 0,hasError:!1};try{let t=jr(e,await this.mainFrame().isolatedRealm().evaluateHandle(()=>{let e=window;for(;(e.document.activeElement instanceof e.HTMLIFrameElement||e.document.activeElement instanceof e.HTMLFrameElement)&&e.document.activeElement.contentWindow!==null;)e=e.document.activeElement.contentWindow;return e}),!1).remoteValue();F(t.type===`window`);let n=this.frames().find(e=>e._id===t.value.context);return F(n),n}catch(t){e.error=t,e.hasError=!0}finally{Mr(e)}}frames(){let e=[this.#n];for(let t of e)e.push(...t.childFrames());return e}isClosed(){return this.#n.detached}async close(e){let t={stack:[],error:void 0,hasError:!1};try{jr(t,await this.#t.waitForScreenshotOperations(),!1);try{await this.#n.browsingContext.close(e?.runBeforeUnload)}catch{return}}catch(e){t.error=e,t.hasError=!0}finally{Mr(t)}}async reload(e={}){let[t]=await Promise.all([this.#n.waitForNavigation(e),this.#n.browsingContext.reload({ignoreCache:e.ignoreCache?!0:void 0})]).catch(dr(this.url(),e.timeout??this._timeoutSettings.navigationTimeout()));return t}setDefaultNavigationTimeout(e){this._timeoutSettings.setDefaultNavigationTimeout(e)}setDefaultTimeout(e){this._timeoutSettings.setDefaultTimeout(e)}getDefaultTimeout(){return this._timeoutSettings.timeout()}getDefaultNavigationTimeout(){return this._timeoutSettings.navigationTimeout()}isJavaScriptEnabled(){return this.#n.browsingContext.isJavaScriptEnabled()}async setGeolocation(e){let{longitude:t,latitude:n,accuracy:r=0}=e;if(t<-180||t>180)throw Error(`Invalid longitude "${t}": precondition -180 <= LONGITUDE <= 180 failed.`);if(n<-90||n>90)throw Error(`Invalid latitude "${n}": precondition -90 <= LATITUDE <= 90 failed.`);if(r<0)throw Error(`Invalid accuracy "${r}": precondition 0 <= ACCURACY failed.`);return await this.#n.browsingContext.setGeolocationOverride({coordinates:{latitude:e.latitude,longitude:e.longitude,accuracy:e.accuracy}})}async setJavaScriptEnabled(e){return await this.#n.browsingContext.setJavaScriptEnabled(e)}async emulateMediaType(e){return await this.#a.emulateMediaType(e)}async emulateCPUThrottling(e){return await this.#a.emulateCPUThrottling(e)}async emulateMediaFeatures(e){return await this.#a.emulateMediaFeatures(e)}async emulateTimezone(e){return await this.#n.browsingContext.setTimezoneOverride(e)}async emulateIdleState(e){return await this.#a.emulateIdleState(e)}async emulateVisionDeficiency(e){return await this.#a.emulateVisionDeficiency(e)}async setViewport(e){if(!this.browser().cdpSupported){let t=e?.width&&e?.height?{width:e.width,height:e.height}:null,n=e?.deviceScaleFactor?e.deviceScaleFactor:null,r=e?e.isLandscape?{natural:`landscape`,type:`landscape-primary`}:{natural:`portrait`,type:`portrait-primary`}:null;await Promise.all([this.#n.browsingContext.setViewport({viewport:t,devicePixelRatio:n}),this.#n.browsingContext.setScreenOrientationOverride(r)]),this.#r=e;return}let t=await this.#a.emulateViewport(e);this.#r=e,t&&await this.reload()}viewport(){return this.#r}async pdf(e={}){let{timeout:t=this._timeoutSettings.timeout(),path:n=void 0}=e,{printBackground:r,margin:i,landscape:a,width:o,height:s,pageRanges:c,scale:l,preferCSSPageSize:u}=Ve(e,`cm`),d=c?c.split(`, `):[];await E(ke(this.mainFrame().isolatedRealm().evaluate(()=>document.fonts.ready)).pipe(w(_e(t))));let f=pe(await E(ke(this.#n.browsingContext.print({background:r,margin:i,orientation:a?`landscape`:`portrait`,page:{width:o,height:s},pageRanges:d,scale:l,shrinkToFit:!u})).pipe(w(_e(t)))),!0);return await this._maybeWriteTypedArrayToFile(n,f),f}async createPDFStream(e){let t=await this.pdf(e);return new ReadableStream({start(e){e.enqueue(t),e.close()}})}async _screenshot(e){let{clip:t,type:n,captureBeyondViewport:r,quality:i}=e;if(e.omitBackground!==void 0&&e.omitBackground)throw new P(`BiDi does not support 'omitBackground'.`);if(e.optimizeForSpeed!==void 0&&e.optimizeForSpeed)throw new P(`BiDi does not support 'optimizeForSpeed'.`);if(e.fromSurface!==void 0&&!e.fromSurface)throw new P(`BiDi does not support 'fromSurface'.`);if(t!==void 0&&t.scale!==void 0&&t.scale!==1)throw new P(`BiDi does not support 'scale' in 'clip'.`);let a;if(t)if(r)a=t;else{let[e,n]=await this.evaluate(()=>{if(!window.visualViewport)throw Error(`window.visualViewport is not supported.`);return[window.visualViewport.pageLeft,window.visualViewport.pageTop]});a={...t,x:t.x-e,y:t.y-n}}return await this.#n.browsingContext.captureScreenshot({origin:r?`document`:`viewport`,format:{type:`image/${n}`,...i===void 0?{}:{quality:i/100}},...a?{clip:{type:`box`,...a}}:{}})}async createCDPSession(){return await this.#n.createCDPSession()}async bringToFront(){await this.#n.browsingContext.activate()}async evaluateOnNewDocument(e,...t){let n=Pr(e,...t);return{identifier:await this.#n.browsingContext.addPreloadScript(n)}}async removeScriptToEvaluateOnNewDocument(e){await this.#n.browsingContext.removePreloadScript(e)}async exposeFunction(e,t){return await this.mainFrame().exposeFunction(e,`default`in t?t.default:t)}isDragInterceptionEnabled(){return!1}async setCacheEnabled(e){if(!this.#t.browser().cdpSupported){await this.#n.browsingContext.setCacheBehavior(e?`default`:`bypass`);return}await this._client().send(`Network.setCacheDisabled`,{cacheDisabled:!e})}async cookies(...e){let t=(e.length?e:[this.url()]).map(e=>new URL(e));return(await this.#n.browsingContext.getCookies()).map(e=>Rr(e)).filter(e=>t.some(t=>Lr(e,t)))}isServiceWorkerBypassed(){throw new P}target(){throw new P}async waitForFileChooser(e={}){let{timeout:t=this._timeoutSettings.timeout()}=e,n=v.create({message:`Waiting for \`FileChooser\` failed: ${t}ms exceeded`,timeout:t});this.#s.add(n),e.signal&&e.signal.addEventListener(`abort`,()=>{n.reject(e.signal?.reason)},{once:!0}),this.#n.browsingContext.once(`filedialogopened`,e=>{if(!e.element)return;let t=new Ue(K.from({sharedId:e.element.sharedId,handle:e.element.handle,type:`node`},this.#n.mainRealm()),e.multiple);for(let e of this.#s)e.resolve(t),this.#s.delete(e)});try{return await n.valueOrThrow()}catch(e){throw this.#s.delete(n),e}}workers(){return[...this.#i]}get isNetworkInterceptionEnabled(){return!!this.#d||!!this.#f||!!this.#p||!!this.#l}#d;async setRequestInterception(e){this.#d=await this.#m([`beforeRequestSent`],this.#d,e)}_extraHTTPHeaders={};#f;async setExtraHTTPHeaders(e){let t={};for(let[n,r]of Object.entries(e))F(Fe(r),`Expected value of header "${n}" to be String, but "${typeof r}" is found.`),t[n.toLowerCase()]=r;this._extraHTTPHeaders=t,this.#f=await this.#m([`beforeRequestSent`],this.#f,!!Object.keys(this._extraHTTPHeaders).length)}_credentials=null;#p;async authenticate(e){this.#p=await this.#m([`authRequired`],this.#p,!!e),this._credentials=e}async#m(e,t,n){if(n&&!t)return await this.#n.browsingContext.addIntercept({phases:e});if(!n&&t){await this.#n.browsingContext.userContext.browser.removeIntercept(t);return}return t}setDragInterception(){throw new P}setBypassServiceWorker(){throw new P}async setOfflineMode(e){if(!this.#t.browser().cdpSupported)throw new P;return this.#o||={offline:!1,upload:-1,download:-1,latency:0},this.#o.offline=e,await this.#h()}async emulateNetworkConditions(e){if(!this.#t.browser().cdpSupported)throw new P;return this.#o||={offline:e?.offline??!1,upload:-1,download:-1,latency:0},this.#o.upload=e?e.upload:-1,this.#o.download=e?e.download:-1,this.#o.latency=e?e.latency:0,this.#o.offline=e?.offline??!1,await this.#h()}async#h(){this.#o&&await this._client().send(`Network.emulateNetworkConditions`,{offline:this.#o.offline,latency:this.#o.latency,uploadThroughput:this.#o.upload,downloadThroughput:this.#o.download})}async setCookie(...e){let t=this.url(),n=t.startsWith(`http`);for(let r of e){let e=r.url||``;!e&&n&&(e=t),F(e!==`about:blank`,`Blank page can not have cookie "${r.name}"`),F(!String.prototype.startsWith.call(e||``,`data:`),`Data URL page can not have cookie "${r.name}"`),F(r.partitionKey===void 0||typeof r.partitionKey==`string`,`BiDi only allows domain partition keys`);let i=URL.canParse(e)?new URL(e):void 0,a=r.domain??i?.hostname;F(a!==void 0,`At least one of the url and domain needs to be specified`);let o={domain:a,name:r.name,value:{type:`string`,value:r.value},...r.path===void 0?{}:{path:r.path},...r.httpOnly===void 0?{}:{httpOnly:r.httpOnly},...r.secure===void 0?{}:{secure:r.secure},...r.sameSite===void 0?{}:{sameSite:Ur(r.sameSite)},expiry:Wr(r.expires),...Vr(r,`sameParty`,`sourceScheme`,`priority`,`url`)};r.partitionKey===void 0?await this.#n.browsingContext.setCookie(o):await this.browserContext().userContext.setCookie(o,r.partitionKey)}}async deleteCookie(...e){await Promise.all(e.map(async e=>{let t=e.url??this.url(),n=URL.canParse(t)?new URL(t):void 0,r=e.domain??n?.hostname;F(r!==void 0,`At least one of the url and domain needs to be specified`);let i={domain:r,name:e.name,...e.path===void 0?{}:{path:e.path}};await this.#n.browsingContext.deleteCookie(i)}))}async removeExposedFunction(e){await this.#n.removeExposedFunction(e)}metrics(){throw new P}async goBack(e={}){return await this.#g(-1,e)}async goForward(e={}){return await this.#g(1,e)}async#g(e,t){let n=new AbortController;try{let[r]=await Promise.all([this.waitForNavigation({...t,signal:n.signal}),this.#n.browsingContext.traverseHistory(e)]);return r}catch(e){throw n.abort(),e}}waitForDevicePrompt(){throw new P}}})();function Pr(e,...t){return`() => {${te(e,...t)}}`}function Fr(e,t){let n=e.domain.toLowerCase(),r=t.hostname.toLowerCase();return n===r?!0:n.startsWith(`.`)&&r.endsWith(n)}function Ir(e,t){let n=t.pathname,r=e.path;return!!(n===r||n.startsWith(r)&&(r.endsWith(`/`)||n[r.length]===`/`))}function Lr(e,t){let n=new URL(t);return F(e!==void 0),Fr(e,n)?Ir(e,n):!1}function Rr(e,t=!1){let n=e[zr+`partitionKey`];function r(){return typeof n==`string`?{partitionKey:n}:typeof n==`object`&&n?t?{partitionKey:{sourceOrigin:n.topLevelSite,hasCrossSiteAncestor:n.hasCrossSiteAncestor??!1}}:{partitionKey:n.topLevelSite}:{}}return{name:e.name,value:e.value.value,domain:e.domain,path:e.path,size:e.size,httpOnly:e.httpOnly,secure:e.secure,sameSite:Hr(e.sameSite),expires:e.expiry??-1,session:e.expiry===void 0||e.expiry<=0,...Br(e,`sameParty`,`sourceScheme`,`partitionKeyOpaque`,`priority`),...r()}}const zr=`goog:`;function Br(e,...t){let n={};for(let r of t)e[zr+r]!==void 0&&(n[r]=e[zr+r]);return n}function Vr(e,...t){let n={};for(let r of t)e[r]!==void 0&&(n[zr+r]=e[r]);return n}function Hr(e){return e===`strict`?`Strict`:e===`lax`?`Lax`:`None`}function Ur(e){return e===`Strict`?`strict`:e===`Lax`?`lax`:`none`}function Wr(e){return[void 0,-1].includes(e)?void 0:e}function Gr(e){if(e===void 0||typeof e==`string`)return e;if(e.hasCrossSiteAncestor)throw new P("WebDriver BiDi does not support `hasCrossSiteAncestor` yet.");return e.sourceOrigin}
/**
* @license
* Copyright 2023 Google Inc.
* SPDX-License-Identifier: Apache-2.0
*/
var Kr=class extends Me{#e;constructor(e){super(),this.#e=e}asPage(){throw new P}url(){return``}createCDPSession(){throw new P}type(){return we.BROWSER}browser(){return this.#e}browserContext(){return this.#e.defaultBrowserContext()}opener(){throw new P}},qr=class extends Me{#e;constructor(e){super(),this.#e=e}async page(){return this.#e}async asPage(){return Nr.from(this.browserContext(),this.#e.mainFrame().browsingContext)}url(){return this.#e.url()}createCDPSession(){return this.#e.createCDPSession()}type(){return we.PAGE}browser(){return this.browserContext().browser()}browserContext(){return this.#e.browserContext()}opener(){throw new P}},Jr=class extends Me{#e;#t;constructor(e){super(),this.#e=e}async page(){return this.#t===void 0&&(this.#t=Nr.from(this.browserContext(),this.#e.browsingContext)),this.#t}async asPage(){return Nr.from(this.browserContext(),this.#e.browsingContext)}url(){return this.#e.url()}createCDPSession(){return this.#e.createCDPSession()}type(){return we.PAGE}browser(){return this.browserContext().browser()}browserContext(){return this.#e.page().browserContext()}opener(){throw new P}},Yr=class extends Me{#e;constructor(e){super(),this.#e=e}async page(){throw new P}async asPage(){throw new P}url(){return this.#e.url()}createCDPSession(){throw new P}type(){return we.OTHER}browser(){return this.browserContext().browser()}browserContext(){return this.#e.frame.page().browserContext()}opener(){throw new P}},Xr=function(e,t,n,r,i,a){function o(e){if(e!==void 0&&typeof e!=`function`)throw TypeError(`Function expected`);return e}for(var s=r.kind,c=s===`getter`?`get`:s===`setter`?`set`:`value`,l=!t&&e?r.static?e:e.prototype:null,u=t||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d,f=!1,p=n.length-1;p>=0;p--){var m={};for(var h in r)m[h]=h===`access`?{}:r[h];for(var h in r.access)m.access[h]=r.access[h];m.addInitializer=function(e){if(f)throw TypeError(`Cannot add initializers after decoration has completed`);a.push(o(e||null))};var g=(0,n[p])(s===`accessor`?{get:u.get,set:u.set}:u[c],m);if(s===`accessor`){if(g===void 0)continue;if(typeof g!=`object`||!g)throw TypeError(`Object expected`);(d=o(g.get))&&(u.get=d),(d=o(g.set))&&(u.set=d),(d=o(g.init))&&i.unshift(d)}else (d=o(g))&&(s===`field`?i.unshift(d):u[c]=d)}l&&Object.defineProperty(l,r.name,u),f=!0},Zr=function(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0},Qr=function(e,t,n){if(t!=null){if(typeof t!=`object`&&typeof t!=`function`)throw TypeError(`Object expected.`);var r,i;if(n){if(!Symbol.asyncDispose)throw TypeError(`Symbol.asyncDispose is not defined.`);r=t[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw TypeError(`Symbol.dispose is not defined.`);r=t[Symbol.dispose],n&&(i=r)}if(typeof r!=`function`)throw TypeError(`Object not disposable.`);i&&(r=function(){try{i.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:r,async:n})}else n&&e.stack.push({async:!0});return t},$r=(function(e){return function(t){function n(n){t.error=t.hasError?new e(n,t.error,`An error was suppressed during disposal.`):n,t.hasError=!0}var r,i=0;function a(){for(;r=t.stack.pop();)try{if(!r.async&&i===1)return i=0,t.stack.push(r),Promise.resolve().then(a);if(r.dispose){var e=r.dispose.call(r.value);if(r.async)return i|=2,Promise.resolve(e).then(a,function(e){return n(e),a()})}else i|=1}catch(e){n(e)}if(i===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return a()}})(typeof SuppressedError==`function`?SuppressedError:function(e,t,n){var r=Error(n);return r.name=`SuppressedError`,r.error=e,r.suppressed=t,r});let ei=(()=>{let e=p,t,n=[],r=[];return class i extends e{static{let i=typeof Symbol==`function`&&Symbol.metadata?Object.create(e[Symbol.metadata]??null):void 0;t=[x()],Xr(this,null,t,{kind:`accessor`,name:`trustedEmitter`,static:!1,private:!1,access:{has:e=>`trustedEmitter`in e,get:e=>e.trustedEmitter,set:(e,t)=>{e.trustedEmitter=t}},metadata:i},n,r),i&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:i})}static from(e,t,n){let r=new i(e,t,n);return r.#o(),r}#e=Zr(this,n,new j);get trustedEmitter(){return this.#e}set trustedEmitter(e){this.#e=e}#t=Zr(this,r);#n;userContext;#r=new WeakMap;#i=new Map;#a=[];constructor(e,t,n){super(),this.#t=e,this.userContext=t,this.#n=n.defaultViewport}#o(){for(let e of this.userContext.browsingContexts)this.#s(e);this.userContext.on(`browsingcontext`,({browsingContext:e})=>{let t=this.#s(e);if(e.originalOpener)for(let n of this.userContext.browsingContexts)n.id===e.originalOpener&&this.#r.get(n).trustedEmitter.emit(`popup`,t)}),this.userContext.on(`closed`,()=>{this.trustedEmitter.removeAllListeners()})}#s(e){let t=Nr.from(this,e);this.#r.set(e,t),t.trustedEmitter.on(`close`,()=>{this.#r.delete(e)});let n=new qr(t),r=new Map;return this.#i.set(t,[n,r]),t.trustedEmitter.on(`frameattached`,e=>{let t=e,n=new Jr(t);r.set(t,n),this.trustedEmitter.emit(`targetcreated`,n)}),t.trustedEmitter.on(`framenavigated`,e=>{let t=e,i=r.get(t);i===void 0?this.trustedEmitter.emit(`targetchanged`,n):this.trustedEmitter.emit(`targetchanged`,i)}),t.trustedEmitter.on(`framedetached`,e=>{let t=e,n=r.get(t);n!==void 0&&(r.delete(t),this.trustedEmitter.emit(`targetdestroyed`,n))}),t.trustedEmitter.on(`workercreated`,e=>{let t=e,n=new Yr(t);r.set(t,n),this.trustedEmitter.emit(`targetcreated`,n)}),t.trustedEmitter.on(`workerdestroyed`,e=>{let t=e,n=r.get(t);n!==void 0&&(r.delete(e),this.trustedEmitter.emit(`targetdestroyed`,n))}),t.trustedEmitter.on(`close`,()=>{this.#i.delete(t),this.trustedEmitter.emit(`targetdestroyed`,n)}),this.trustedEmitter.emit(`targetcreated`,n),t}targets(){return[...this.#i.values()].flatMap(([e,t])=>[e,...t.values()])}async newPage(e){let t={stack:[],error:void 0,hasError:!1};try{Qr(t,await this.waitForScreenshotOperations(),!1);let n=e?.type===`window`?`window`:`tab`,r=await this.userContext.createBrowsingContext(n),i=this.#r.get(r);if(!i)throw Error(`Page is not found`);if(this.#n)try{await i.setViewport(this.#n)}catch{}return i}catch(e){t.error=e,t.hasError=!0}finally{$r(t)}}async close(){F(this.userContext.id!==Gn.DEFAULT,`Default BrowserContext cannot be closed!`);try{await this.userContext.remove()}catch(e){k(e)}this.#i.clear()}browser(){return this.#t}async pages(e=!1){return[...this.userContext.browsingContexts].map(e=>this.#r.get(e))}async overridePermissions(e,t){let n=new Set(t.map(e=>{if(!_.get(e))throw Error(`Unknown permission: `+e);return e}));await Promise.all(Array.from(_.keys()).map(t=>{let r=this.userContext.setPermissions(e,{name:t},n.has(t)?`granted`:`denied`);return this.#a.push({origin:e,permission:t}),n.has(t)?r:r.catch(k)}))}async clearPermissionOverrides(){let e=this.#a.map(({permission:e,origin:t})=>this.userContext.setPermissions(t,{name:e},`prompt`).catch(k));this.#a=[],await Promise.all(e)}get id(){if(this.userContext.id!==Gn.DEFAULT)return this.userContext.id}async cookies(){return(await this.userContext.getCookies()).map(e=>Rr(e,!0))}async setCookie(...e){await Promise.all(e.map(async e=>{let t={domain:e.domain,name:e.name,value:{type:`string`,value:e.value},...e.path===void 0?{}:{path:e.path},...e.httpOnly===void 0?{}:{httpOnly:e.httpOnly},...e.secure===void 0?{}:{secure:e.secure},...e.sameSite===void 0?{}:{sameSite:Ur(e.sameSite)},expiry:Wr(e.expires),...Vr(e,`sameParty`,`sourceScheme`,`priority`,`url`)};return await this.userContext.setCookie(t,Gr(e.partitionKey))}))}}})();
/**
* @license
* Copyright 2024 Google Inc.
* SPDX-License-Identifier: Apache-2.0
*/
var ti=function(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0},Q=function(e,t,n,r,i,a){function o(e){if(e!==void 0&&typeof e!=`function`)throw TypeError(`Function expected`);return e}for(var s=r.kind,c=s===`getter`?`get`:s===`setter`?`set`:`value`,l=!t&&e?r.static?e:e.prototype:null,u=t||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d,f=!1,p=n.length-1;p>=0;p--){var m={};for(var h in r)m[h]=h===`access`?{}:r[h];for(var h in r.access)m.access[h]=r.access[h];m.addInitializer=function(e){if(f)throw TypeError(`Cannot add initializers after decoration has completed`);a.push(o(e||null))};var g=(0,n[p])(s===`accessor`?{get:u.get,set:u.set}:u[c],m);if(s===`accessor`){if(g===void 0)continue;if(typeof g!=`object`||!g)throw TypeError(`Object expected`);(d=o(g.get))&&(u.get=d),(d=o(g.set))&&(u.set=d),(d=o(g.init))&&i.unshift(d)}else (d=o(g))&&(s===`field`?i.unshift(d):u[c]=d)}l&&Object.defineProperty(l,r.name,u),f=!0},ni=function(e,t,n){if(t!=null){if(typeof t!=`object`&&typeof t!=`function`)throw TypeError(`Object expected.`);var r,i;if(n){if(!Symbol.asyncDispose)throw TypeError(`Symbol.asyncDispose is not defined.`);r=t[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw TypeError(`Symbol.dispose is not defined.`);r=t[Symbol.dispose],n&&(i=r)}if(typeof r!=`function`)throw TypeError(`Object not disposable.`);i&&(r=function(){try{i.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:r,async:n})}else n&&e.stack.push({async:!0});return t},ri=(function(e){return function(t){function n(n){t.error=t.hasError?new e(n,t.error,`An error was suppressed during disposal.`):n,t.hasError=!0}var r,i=0;function a(){for(;r=t.stack.pop();)try{if(!r.async&&i===1)return i=0,t.stack.push(r),Promise.resolve().then(a);if(r.dispose){var e=r.dispose.call(r.value);if(r.async)return i|=2,Promise.resolve(e).then(a,function(e){return n(e),a()})}else i|=1}catch(e){n(e)}if(i===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return a()}})(typeof SuppressedError==`function`?SuppressedError:function(e,t,n){var r=Error(n);return r.name=`SuppressedError`,r.error=e,r.suppressed=t,r});let ii=(()=>{let e=j,t=[],n,r,i,a,o,s,c,l;return class u extends e{static{let u=typeof Symbol==`function`&&Symbol.metadata?Object.create(e[Symbol.metadata]??null):void 0;Q(this,null,n,{kind:`method`,name:`dispose`,static:!1,private:!1,access:{has:e=>`dispose`in e,get:e=>e.dispose},metadata:u},null,t),Q(this,null,r,{kind:`method`,name:`close`,static:!1,private:!1,access:{has:e=>`close`in e,get:e=>e.close},metadata:u},null,t),Q(this,null,i,{kind:`method`,name:`addPreloadScript`,static:!1,private:!1,access:{has:e=>`addPreloadScript`in e,get:e=>e.addPreloadScript},metadata:u},null,t),Q(this,null,a,{kind:`method`,name:`removeIntercept`,static:!1,private:!1,access:{has:e=>`removeIntercept`in e,get:e=>e.removeIntercept},metadata:u},null,t),Q(this,null,o,{kind:`method`,name:`removePreloadScript`,static:!1,private:!1,access:{has:e=>`removePreloadScript`in e,get:e=>e.removePreloadScript},metadata:u},null,t),Q(this,null,s,{kind:`method`,name:`createUserContext`,static:!1,private:!1,access:{has:e=>`createUserContext`in e,get:e=>e.createUserContext},metadata:u},null,t),Q(this,null,c,{kind:`method`,name:`installExtension`,static:!1,private:!1,access:{has:e=>`installExtension`in e,get:e=>e.installExtension},metadata:u},null,t),Q(this,null,l,{kind:`method`,name:`uninstallExtension`,static:!1,private:!1,access:{has:e=>`uninstallExtension`in e,get:e=>e.uninstallExtension},metadata:u},null,t),u&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u})}static async from(e){let t=new u(e);return await t.#a(),t}#e=(ti(this,t),!1);#t;#n=new I;#r=new Map;session;#i=new Map;constructor(e){super(),this.session=e}async#a(){let e=this.#n.use(new j(this.session));e.once(`ended`,({reason:e})=>{this.dispose(e)}),e.on(`script.realmCreated`,e=>{e.type===`shared-worker`&&this.#i.set(e.realm,Fn.from(this,e.realm,e.origin))}),await this.#o(),await this.#s()}async#o(){let{result:{userContexts:e}}=await this.session.send(`browser.getUserContexts`,{});for(let t of e)this.#c(t.userContext)}async#s(){let e=new Set,t;{let n={stack:[],error:void 0,hasError:!1};try{ni(n,new j(this.session),!1).on(`browsingContext.contextCreated`,t=>{e.add(t.context)});let{result:r}=await this.session.send(`browsingContext.getTree`,{});t=r.contexts}catch(e){n.error=e,n.hasError=!0}finally{ri(n)}}for(let n of t)e.has(n.context)||this.session.emit(`browsingContext.contextCreated`,n),n.children&&t.push(...n.children)}#c(e){let t=Gn.create(this,e);this.#r.set(t.id,t);let n=this.#n.use(new j(t));return n.once(`closed`,()=>{n.removeAllListeners(),this.#r.delete(t.id)}),t}get closed(){return this.#e}get defaultUserContext(){return this.#r.get(Gn.DEFAULT)}get disconnected(){return this.#t!==void 0}get disposed(){return this.disconnected}get userContexts(){return this.#r.values()}dispose(e,t=!1){this.#e=t,this.#t=e,this[O]()}async close(){try{await this.session.send(`browser.close`,{})}finally{this.dispose(`Browser already closed.`,!0)}}async addPreloadScript(e,t={}){let{result:{script:n}}=await this.session.send(`script.addPreloadScript`,{functionDeclaration:e,...t,contexts:t.contexts?.map(e=>e.id)});return n}async removeIntercept(e){await this.session.send(`network.removeIntercept`,{intercept:e})}async removePreloadScript(e){await this.session.send(`script.removePreloadScript`,{script:e})}async createUserContext(e){let t=e.proxyServer===void 0?void 0:{proxyType:`manual`,httpProxy:e.proxyServer,sslProxy:e.proxyServer,noProxy:e.proxyBypassList},{result:{userContext:n}}=await this.session.send(`browser.createUserContext`,{proxy:t});if(e.downloadBehavior?.policy===`allowAndName`)throw new P("`allowAndName` is not supported in WebDriver BiDi");if(e.downloadBehavior?.policy===`allow`){if(e.downloadBehavior.downloadPath===void 0)throw new P("`downloadPath` is required in `allow` download behavior");await this.session.send(`browser.setDownloadBehavior`,{downloadBehavior:{type:`allowed`,destinationFolder:e.downloadBehavior.downloadPath},userContexts:[n]})}return e.downloadBehavior?.policy===`deny`&&await this.session.send(`browser.setDownloadBehavior`,{downloadBehavior:{type:`denied`},userContexts:[n]}),this.#c(n)}async installExtension(e){let{result:{extension:t}}=await this.session.send(`webExtension.install`,{extensionData:{type:`path`,path:e}});return t}async uninstallExtension(e){await this.session.send(`webExtension.uninstall`,{extension:e})}[(n=[C],r=[d(e=>e.#t)],i=[d(e=>e.#t)],a=[d(e=>e.#t)],o=[d(e=>e.#t)],s=[d(e=>e.#t)],c=[d(e=>e.#t)],l=[d(e=>e.#t)],O)](){this.#t??=`Browser was disconnected, probably because the session ended.`,this.closed&&this.emit(`closed`,{reason:this.#t}),this.emit(`disconnected`,{reason:this.#t}),this.#n.dispose(),super[O]()}}})();
/**
* @license
* Copyright 2024 Google Inc.
* SPDX-License-Identifier: Apache-2.0
*/
var ai=function(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0},$=function(e,t,n,r,i,a){function o(e){if(e!==void 0&&typeof e!=`function`)throw TypeError(`Function expected`);return e}for(var s=r.kind,c=s===`getter`?`get`:s===`setter`?`set`:`value`,l=!t&&e?r.static?e:e.prototype:null,u=t||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d,f=!1,p=n.length-1;p>=0;p--){var m={};for(var h in r)m[h]=h===`access`?{}:r[h];for(var h in r.access)m.access[h]=r.access[h];m.addInitializer=function(e){if(f)throw TypeError(`Cannot add initializers after decoration has completed`);a.push(o(e||null))};var g=(0,n[p])(s===`accessor`?{get:u.get,set:u.set}:u[c],m);if(s===`accessor`){if(g===void 0)continue;if(typeof g!=`object`||!g)throw TypeError(`Object expected`);(d=o(g.get))&&(u.get=d),(d=o(g.set))&&(u.set=d),(d=o(g.init))&&i.unshift(d)}else (d=o(g))&&(s===`field`?i.unshift(d):u[c]=d)}l&&Object.defineProperty(l,r.name,u),f=!0};let oi=(()=>{let e=j,t=[],n,r=[],i=[],a,o,s,c,l;return class u extends e{static{let u=typeof Symbol==`function`&&Symbol.metadata?Object.create(e[Symbol.metadata]??null):void 0;$(this,null,n,{kind:`accessor`,name:`connection`,static:!1,private:!1,access:{has:e=>`connection`in e,get:e=>e.connection,set:(e,t)=>{e.connection=t}},metadata:u},r,i),$(this,null,a,{kind:`method`,name:`dispose`,static:!1,private:!1,access:{has:e=>`dispose`in e,get:e=>e.dispose},metadata:u},null,t),$(this,null,o,{kind:`method`,name:`send`,static:!1,private:!1,access:{has:e=>`send`in e,get:e=>e.send},metadata:u},null,t),$(this,null,s,{kind:`method`,name:`subscribe`,static:!1,private:!1,access:{has:e=>`subscribe`in e,get:e=>e.subscribe},metadata:u},null,t),$(this,null,c,{kind:`method`,name:`addIntercepts`,static:!1,private:!1,access:{has:e=>`addIntercepts`in e,get:e=>e.addIntercepts},metadata:u},null,t),$(this,null,l,{kind:`method`,name:`end`,static:!1,private:!1,access:{has:e=>`end`in e,get:e=>e.end},metadata:u},null,t),u&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u})}static async from(e,t){let{result:n}=await e.send(`session.new`,{capabilities:t}),r=new u(e,n);return await r.#i(),r}#e=ai(this,t);#t=new I;#n;browser;#r=ai(this,r,void 0);get connection(){return this.#r}set connection(e){this.#r=e}constructor(e,t){super(),ai(this,i),this.#n=t,this.connection=e}async#i(){this.browser=await ii.from(this),this.#t.use(this.browser).once(`closed`,({reason:e})=>{this.dispose(e)});let e=new WeakSet;this.on(`browsingContext.fragmentNavigated`,t=>{e.has(t)||(e.add(t),this.emit(`browsingContext.navigationStarted`,t),this.emit(`browsingContext.fragmentNavigated`,t))})}get capabilities(){return this.#n.capabilities}get disposed(){return this.ended}get ended(){return this.#e!==void 0}get id(){return this.#n.sessionId}dispose(e){this.#e=e,this[O]()}async send(e,t){return await this.connection.send(e,t)}async subscribe(e,t){await this.send(`session.subscribe`,{events:e,contexts:t})}async addIntercepts(e,t){await this.send(`session.subscribe`,{events:e,contexts:t})}async end(){try{await this.send(`session.end`,{})}finally{this.dispose(`Session already ended.`)}}[(n=[x()],a=[C],o=[d(e=>e.#e)],s=[d(e=>e.#e)],c=[d(e=>e.#e)],l=[d(e=>e.#e)],O)](){this.#e??=`Session already destroyed, probably because the connection broke.`,this.emit(`ended`,{reason:this.#e}),this.#t.dispose(),super[O]()}}})();
/**
* @license
* Copyright 2022 Google Inc.
* SPDX-License-Identifier: Apache-2.0
*/
var si=function(e,t,n,r,i,a){function o(e){if(e!==void 0&&typeof e!=`function`)throw TypeError(`Function expected`);return e}for(var s=r.kind,c=s===`getter`?`get`:s===`setter`?`set`:`value`,l=!t&&e?r.static?e:e.prototype:null,u=t||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d,f=!1,p=n.length-1;p>=0;p--){var m={};for(var h in r)m[h]=h===`access`?{}:r[h];for(var h in r.access)m.access[h]=r.access[h];m.addInitializer=function(e){if(f)throw TypeError(`Cannot add initializers after decoration has completed`);a.push(o(e||null))};var g=(0,n[p])(s===`accessor`?{get:u.get,set:u.set}:u[c],m);if(s===`accessor`){if(g===void 0)continue;if(typeof g!=`object`||!g)throw TypeError(`Object expected`);(d=o(g.get))&&(u.get=d),(d=o(g.set))&&(u.set=d),(d=o(g.init))&&i.unshift(d)}else (d=o(g))&&(s===`field`?i.unshift(d):u[c]=d)}l&&Object.defineProperty(l,r.name,u),f=!0},ci=function(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0},li=function(e,t,n){return typeof t==`symbol`&&(t=t.description?`[${t.description}]`:``),Object.defineProperty(e,`name`,{configurable:!0,value:n?`${n} ${t}`:t})};let ui=(()=>{let e=Re,t,n=[],r=[],i;return class a extends e{static{let a=typeof Symbol==`function`&&Symbol.metadata?Object.create(e[Symbol.metadata]??null):void 0;t=[x()],si(this,i={get:li(function(){return this.#e},`#trustedEmitter`,`get`),set:li(function(e){this.#e=e},`#trustedEmitter`,`set`)},t,{kind:`accessor`,name:`#trustedEmitter`,static:!1,private:!0,access:{has:e=>#n in e,get:e=>e.#n,set:(e,t)=>{e.#n=t}},metadata:a},n,r),a&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a})}protocol=`webDriverBiDi`;static subscribeModules=[`browsingContext`,`network`,`log`,`script`,`input`];static subscribeCdpEvents=[`goog:cdp.Debugger.scriptParsed`,`goog:cdp.CSS.styleSheetAdded`,`goog:cdp.Runtime.executionContextsCleared`,`goog:cdp.Tracing.tracingComplete`,`goog:cdp.Network.requestWillBeSent`,`goog:cdp.Debugger.scriptParsed`,`goog:cdp.Page.screencastFrame`];static async create(e){let t=await oi.from(e.connection,{firstMatch:e.capabilities?.firstMatch,alwaysMatch:{...e.capabilities?.alwaysMatch,acceptInsecureCerts:e.acceptInsecureCerts,unhandledPromptBehavior:{default:`ignore`},webSocketUrl:!0,"goog:prerenderingDisabled":!0,"goog:disableNetworkDurableMessages":!0}});await t.subscribe((e.cdpConnection?[...a.subscribeModules,...a.subscribeCdpEvents]:a.subscribeModules).filter(t=>e.networkEnabled?!0:t!==`network`&&t!==`goog:cdp.Network.requestWillBeSent`)),await Promise.all([`request`,`response`].map(async e=>{try{await t.send(`network.addDataCollector`,{dataTypes:[e],maxEncodedDataSize:2e7})}catch(e){if(e instanceof We)k(e);else throw e}}));let n=new a(t.browser,e);return n.#d(),n}#e=ci(this,n,new j);get#n(){return i.get.call(this)}set#n(e){return i.set.call(this,e)}#r=ci(this,r);#i;#a;#o;#s=new WeakMap;#c=new Kr(this);#l;#u;constructor(e,t){super(),this.#r=t.process,this.#i=t.closeCallback,this.#a=e,this.#o=t.defaultViewport,this.#l=t.cdpConnection,this.#u=t.networkEnabled}#d(){for(let e of this.#a.userContexts)this.#m(e);this.#a.once(`disconnected`,()=>{this.#n.emit(`disconnected`,void 0),this.#n.removeAllListeners()}),this.#r?.once(`close`,()=>{this.#a.dispose(`Browser process exited.`,!0),this.connection.dispose()})}get#f(){return this.#a.session.capabilities.browserName}get#p(){return this.#a.session.capabilities.browserVersion}get cdpSupported(){return this.#l!==void 0}get cdpConnection(){return this.#l}async userAgent(){return this.#a.session.capabilities.userAgent}#m(e){let t=ei.from(this,e,{defaultViewport:this.#o});return this.#s.set(e,t),t.trustedEmitter.on(`targetcreated`,e=>{this.#n.emit(`targetcreated`,e)}),t.trustedEmitter.on(`targetchanged`,e=>{this.#n.emit(`targetchanged`,e)}),t.trustedEmitter.on(`targetdestroyed`,e=>{this.#n.emit(`targetdestroyed`,e)}),t}get connection(){return this.#a.session.connection}wsEndpoint(){return this.connection.url}async close(){if(!this.connection.closed)try{await this.#a.close(),await this.#i?.call(null)}catch(e){k(e)}finally{this.connection.dispose()}}get connected(){return!this.#a.disconnected}process(){return this.#r??null}async createBrowserContext(e={}){let t=await this.#a.createUserContext(e);return this.#m(t)}async version(){return`${this.#f}/${this.#p}`}browserContexts(){return[...this.#a.userContexts].map(e=>this.#s.get(e))}defaultBrowserContext(){return this.#s.get(this.#a.defaultUserContext)}newPage(){return this.defaultBrowserContext().newPage()}installExtension(e){return this.#a.installExtension(e)}async uninstallExtension(e){await this.#a.uninstallExtension(e)}targets(){return[this.#c,...this.browserContexts().flatMap(e=>e.targets())]}target(){return this.#c}async disconnect(){try{await this.#a.session.end()}catch(e){k(e)}finally{this.connection.dispose()}}get debugInfo(){return{pendingProtocolErrors:this.connection.getPendingProtocolErrors()}}isNetworkEnabled(){return this.#u}}})();export{ui as BidiBrowser,yn as BidiConnection,Cn as connectBidiOverCdp};